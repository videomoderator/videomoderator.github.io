{"version":3,"sources":["submit.png","load.png","store/actions.ts","utils/logger.ts","components/VideoTracker/Comps/BaseDom.ts","components/VideoTracker/Comps/ProfileBox.ts","components/VideoTracker/Comps/TimelineRiver.ts","components/VideoTracker/Comps/CustomizableControlBar.ts","components/VideoTracker/Comps/RiskTimeline.ts","components/VideoTracker/index.tsx","components/FrameBrowser/dataProp.ts","components/FrameBrowser/frames/RadialBarFrame.tsx","components/FrameBrowser/frames/ScalableFrame.tsx","components/FrameBrowser/Scene.tsx","components/FrameBrowser/index.tsx","../alg/istoryline/src/js/utils/logger.js","../alg/istoryline/src/js/data/table.js","../alg/istoryline/src/js/utils/dataStruct.js","../alg/istoryline/src/js/utils/CONSTANTS.js","../alg/istoryline/src/js/order/greedySort.js","../alg/istoryline/src/js/align/greedyAlign.js","../alg/istoryline/src/js/compact/greedySlotCompact.js","../alg/istoryline/src/js/render/styleConfiger.js","../alg/istoryline/src/js/render/layoutRelaxer.js","../alg/istoryline/src/js/render/pathSmoother.js","../alg/istoryline/src/js/render/index.js","../alg/istoryline/src/js/render/smoothRender.js","../alg/istoryline/src/js/transform/freeTransform.js","../alg/istoryline/src/js/transform/circleTransform.js","../alg/istoryline/src/js/transform/index.js","../alg/istoryline/src/js/data/constraint.js","../alg/istoryline/src/js/data/graph.js","../alg/istoryline/src/js/utils/io.js","../alg/istoryline/src/js/data/story.js","../alg/istoryline/src/js/index.js","../alg/istoryline/src/js/order/index.js","../alg/istoryline/src/js/align/index.js","../alg/istoryline/src/js/compact/index.js","components/AudioStoryline/layout.ts","components/AudioStoryline/GroupShape.tsx","components/AudioStoryline/StorylinePath.tsx","components/AudioStoryline/StorylineBar.tsx","components/AudioStoryline/TimeTicks.tsx","components/AudioStoryline/index.tsx","App.tsx","serviceWorker.ts","store/reducers/videoState.ts","store/reducers/studyState.ts","store/reducers/index.ts","store/index.ts","index.tsx"],"names":["module","exports","initServer","createAction","action","msg","fetchDemoVideo","payload","fetchYoukuVideo","fetchStudyVideo","consoleInfo","createAsyncAction","console","info","consoleError","error","BaseDiv","player","opts","videojs","dom","emptyEl","el","createEl","className","css","styleStr","key","this","setAttribute","getComponent","ProfileBox","addClass","top","left","width","registerComponent","ProfileHead","ProfileFoot","setStyle","position","addChild","entity","score","color","appendContent","border","background","height","TimelineRiver","myChart","domDiv","undefined","echarts","init","updateEChartsOptions","option","grid","right","bottom","xAxis","show","boundaryGap","data","Object","keys","yAxis","series","name","type","smooth","areaStyle","showSymbol","values","lineStyle","setOption","CustomizableControlBar","ControlItems","display","RiskTimeline","riskData","risk","textData","text","divHeight","timeline","RiskDataTimeline","timeTicks","startTimeTicks","riskColors","riskValues","map","_val","riskValue","getRiskColorAvg","RiskDiv","flexDirection","forEach","idx","time","on","currentTime","play","flex","stat","endTimeTicks","length","i","len","_startTime","_endTime","_riskValue","getRiskAvg","getRiskMax","getRiskSum","push","startTime","endTime","riskSum","riskLabel","riskTS","Math","ceil","riskMax","riskAvg","count","textItem","start","sort","a","b","end","VideoTracker","props","videoTrackerWrapperRef","React","createRef","profileBoxes","state","videoRisk","videoText","playerWidth","playerHeight","videoWidth","videoHeight","defaultWidth","current","clientWidth","defaultHeight","clientHeight","scale","max","x0","y0","autoplay","controls","children","currentMileseconds","_profile","dispose","withinRangeAnnotations","videoAnnotations","filter","_annotation","duration","box","label","confidence","videoSrc","src","videoType","videoStartTime","style","ref","data-vjs-player","id","Component","RiskDataManager","rawRiskData","riskLabelTree","rawRiskLabels","aggregateArr","riskDataProtocV1","generateRiskLabelTree","tskv","tskeys","parseFloat","generateTimeTicks","includes","frameRiskLabelTree","riskType","hasOwnProperty","scene","sceneMaxRiskData","getFrameRiskTree","sceneMaxRiskDataTime","JSON","parse","stringify","frameRiskTree","maxRiskFrameIndex","maxRiskValue","sum","scenes","scenesMaxRiskData","getSceneMaxRiskData","scenesMaxRiskSum","sceneData","computeRiskSum","scenesData","j","t","tframe","trisk","scenesMaxRiskFrame","getFrameRiskSumMax","frameViewData","arr","reduce","accumulator","currentValue","riskLabelTags","split","tag","RadialBarGlyph","frame","riskLabels","riskStore","Map","_riskScore","_riskLabel","set","innerR","size","outerR","min","sceneH","sceneX","cx","cy","riskTypes","focusRiskLabel","frameSizeScale","riskColorMap","R_RATIO","riskEncode","svgW","svgH","G_RATIO","startAngle","PieSectors","endAngle","_outerR","proportion","get","PI","pathD","generatePieSectorPathD","focusPathD","riskTag","riskColor","onClick","callbackFn","onMouseEnter","setState","onMouseLeave","fill","stroke","strokeWidth","d","x","y","fillOpacity","rx","ry","toFixed","zIndex","borderRadius","six","cos","siy","sin","sox","soy","eox","eoy","eix","eiy","ScalableFrame","transform","frameScale","getFocusStyle","getDefaultStyle","getFrameStyle","Scene","thumbnail","frames","sceneRisk","sceneId","riskDataManager","sceneFrames","value","marginBottom","setFocusRiskLabel","FrameBrowser","containerDom","containerX","containerH","containerW","containerPadding","displayScenes","thumbnailRatio","DOM","containerLeft","containerBottom","containerRight","containerTop","getFrameViewData","Scenes","videoTime","setCurrentVideoTime","overflowY","nextProps","prevState","inputData","thumbnailWidth","thumbnailHeight","isInScenes","logConstraintError","warn","logGeneratorError","math","create","all","Table","_mat","matrix","row","col","subset","index","clone","mat","rowRange","colRange","_rowRange","_colRange","_translateRange","range","rows","cols","val","resize","_zeroMat","zeros","add","_zeroTable","isColumn","headRange","headTable","subtable","tailRange","tailTable","replace","DisjointSet","num","fatherSet","n","findFather","m","ans","isInSameSet","STYLE_LABELS","greedySort","story","constraints","sortTable","param","charaterinSession","initOrder","constrainedCrossingReduction","initOrderMat","order2mat","replaceIndex","lastTimeOrder","ordertime","thisTimeOrder","thisTimeOrderMat","runAlgorithms","storySessionTable","getTable","sessionMap","sessionHash","characterID","sessionID","has","constantSort","constraint","constraintAtAllTime","constraintAtThisTime","timeSpan","names","getCharacterID","getParam","setTable","order","ID","orderID","indexOf","list1","list2","list1Weight","sumWeight","element","getWeight","dealSetConstraints","mapSetArr","setInDegree","topoSort","indexA","indexB","allElementWeight","allElement","dealElementConstraints","mapElementArr","elementInDegree","elementOrder","session","inDegree","listWeight","minWeight","Number","MAX_SAFE_INTEGER","pos","list","setArr","first","second","firstSetId","getSetId","secondSetId","union","allElementInSet","listAllElement","greedyAlign","alignTable","rewardArr","characterIdInOrder","alignAns","longestCommonSubstring","idOrder","alignId","chaTable","sessionTable","constraintsAlign","constraintsBend","reward","cha","rewardInEachCha","chaInNextTime","id1","id2","isConstraint","solveReward","sessionId1","sessionId2","session1","findChaInSessionAtTime","session2","chaId","abs","sessionId","list1Length","list2Length","totalReward","direction","valueList","maxListArg","maxArg","alignList","leftHead","rightHead","maxValue","MIN_SAFE_INTEGER","greedySlotCompact","layoutTable","sessionInOrder","sessionAlignMaps","constraintsExpand","constraintsCompress","slots","sessionIdHasDealedMap","slotId","slot","lastTimeSessionId","thisTimeSessionId","sessionIds","Array","insert2Array","sessionIdNum","lastSessionId","lastSlotId","sessionIdTime2SlotId","slotsOfCharacter","slotsId","sessionId2CharactersInOrder","thisSlot","nextSlot","firstAlignCharacterNum","alignCharacterNumInNextTime","firstAlignCharacter","Id","alignCharacterId","loss","unshift","lastTime","lossnum","baseHeightArray","slotsOfCharacterId","calculateSlotHeight","baseHeight","charactersInThisSlot","characterI","characterId","idNum","isCompress","isExpand","some","getCharacterName","Height","sessionInOrderSet","Set","from","sessionAlignMap","beAlignedSession","alignSessionId","characterIdInOrderInThisTime","maxCharacterNum","characters","array","splice","StyleConfiger","genStyle","styleFlag","moveMark","styleY","_style","_styleFlag","_moveMark","_styleY","oConstraints","ctrsFilter","tstyle","newArray","getTableRows","getTableCols","tstyleFlag","tmoveMark","tstyleY","ctr","_changeStyle","_changeStyleY","octrs","tctrs","styleName","ret","timesteps","getTimeSteps","timestep","getStyleId","layout","avgY","tot","LayoutRelaxer","layoutRelax","origX","renderX","_origX","_renderX","timeStamp","startOrEnd","character","originX","time2origX","_getRenderX","oriY","ny","py","flag","z","st","ed","k","PathSmoother","styleConfiger","layoutRelaxer","charater","tpos","curFlags","linkLine","lineNodes","curFlag","linkGap","gapANodes","gapBNodes","cleanPositions","addPosition","nodes","styleId","zigzagLinker","waveLinker","bumpLinker","twineLinker","collideLinker","normalLinker","styles","flags","tmpNodes","bezierLinker","midNode","gapA","gapB","SAMPLERATE","p","calcBezier","sampleling","sketchN","shakeX","shakeY","endNodes","tmpLength","tmpHeight","random","smoothNodes","ctrlNode","sampleRate","storyRender","generator","pathSmoother","genPosition","smoothRender","genNewPosition","getBoundary","positions","minX","maxX","minY","maxY","node","genPath","cleanPaths","ctrs","reserveRatio","ratio","path","segment","pathStr","addPath","circleTransform","tPosition","upperPath","lowerPath","storySegment","rY","rX","sNode","eNode","pathTable","storyTransform","freeTransform","ConstraintStore","_constraints","Graph","_story","_storylines","_storylinePaths","characterTable","positionTable","segments","segmentPaths","positionId","_positions","pathId","_paths","tableName","timeStep","locations","parseXMLFile","xml","restore","storyNode","querySelector","querySelectorAll","getAttribute","_characters","spans","span","parseInt","_timeStamps","timeset","_tableMap","characterName","timeId","timeIdend","_maxSessionID","location","locationTable","locationName","_locations","locationId","sessionsInthislocation","rightSession","parseJSONFile","json","storyJson","Story","Locations","Characters","generateJSONFile","locationsJson","sessions","getLocationSessions","dumpJsonLocation","charactersJson","timeStamps","getCharacterTimeRange","spansJson","getSessionID","spanJson","Start","End","Session","dumpJsonCharacters","downloadFile","fileName","content","aLink","document","createElement","blob","Blob","download","href","URL","createObjectURL","body","appendChild","click","removeChild","fileUrl","fileSeps","fileType","d3Fetch","JSONFile","xml2js","Builder","buildObject","dumpXMLFile","dumpJSONFile","table","timeRange","tmpTimeSteps","timeSteps","l","r","maxTimeStamp","_character","_","getNewSessionID","changeCharacter","All","_id","deleteCharacter","addCharacter","isHardBoundary","addTimeStamp","_changeSessionSoft","locationID","getLocationID","getTimeStep","characterIDs","step","sessionIDs","iStoryline","pipeline","_pipeline","_constraintStore","load","_layout","loadJson","orderGenerator","storyOrder","alignGenerator","storyAlign","compactGenerator","storyCompact","renderGenerator","transformGenerator","dump","newSessionID","changeSession","deleteSession","changeLocation","intraSep","interSep","LayoutGenerator","storyScript","storylines","charactersRiskNum","riskGroupsList","graph","StorylineFactory","generateLayout","computeRiskGroupIndex","riskGroupLines","postProcessYScale","riskGroupsListInput","storylinesInput","storylinesOrigin","pointsNum","startX","endX","medianY","floor","connectWidth","linesGap","riskGroupGap","linesYSum","riskGroupYStart","audioScript","charactersData","sessionCount","lineCount","riskGroupLinesIndex","riskGroupSession","isFindGroup","characterSession","colorScheme","policy","pickColor","item","GroupShape","fillColor","strokeColor","rectRadius","riskGroup","w","h","additionY","additionY2","cidx","riskTypesMap","maxRiskType","tempCount","riskTypeNum","yStart","yGap","riskWord","textAnchor","dominantBaseline","fontSize","c","getRectColor","getRectData","texts","getTextData","circles","getCircleData","StorylinePath","generateSmoothSegment","storyline","storylineColor","storylineWidth","line","linesNum","StorylineBar","isFocusing","barScale","barRatio","gapRatio","defaultStrokeWidth","activateStrokeWidth","xInterval","c1x","c2x","barHeight","barStartY","textRatio","gapPathD","getGapPathD","barWidth","barStartX","opacity","storylineName","TimeTicks","minuteTickLength","minuteTickWidth","minuteTickStroke","smallSecondTickLength","smallSecondTickWidth","smallSecondTickStroke","largeSecondTickLength","largeSecondTickWidth","largeSecondTickStroke","sep","getStartPoint","startY","getEndPoint","endY","AnchorLine","x1","y1","x2","y2","MinutesTicks","generateArr","getTimePosition","posX","posY","LargeSecondsTicks","SmallSecondsTicks","tempArr","v","AudioStoryline","paddingT","paddingL","paddingB","paddingR","sessionIdx","StorylineBars","GroupShapes","layoutManager","riskGroups","riskNumMax","pickRiskColor","groupShapeTime","getGroupShapeTime","borderColor","AppHeader","styled","div","AppContent","CompContainer","CompHeader","CompWrapper","getTimeNow","Date","getTime","App","interface","userId","videoId","videoLabel","videoOrder","videoOrderIdx","isFinished","isWarning","startTimestamp","result","btnLabel","test","videoOrders","axios","post","then","res","resData","fetchStudy","catch","err","videoAlgJson","audioAlgJson","imageSrc","imageAlgJson","log","retKey","datastr","encodeURIComponent","downloadAnchorNode","remove","videoIds","fetchVideo","fetchLocalVideo","currentTimestamp","evidance","nextVideoId","downloadResult","riskLabelBtns","alignItems","margin","marginRight","justifyContent","changeLabelTest","fontWeight","AppTitle","borderLeft","borderTop","borderRight","borderBottom","require","marginLeft","VideoView","videoRiskTS","videoASRText","FrameView","videoFrames","changeVideoTime","AudioView","gutter","connect","videoState","participants","studyState","videoLabels","dispatch","fetchDemo","videoInfo","fetchYouku","Boolean","window","hostname","match","initialState","videoSize","videoFPS","getVideoRiskTS","isTSKV","TS","getVideoASRText","ASRText","timeStr","_text","newEndTime","getRiskLabelTree","getRiskColorMap","testUserOrder","generateParticipants","generateVideoOrders","combineReducers","express","e","createStore","rootReducer","ReactDOM","render","StrictMode","store","getElementById","navigator","serviceWorker","ready","registration","unregister","message"],"mappings":"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","file":"static/js/main.e44db24e.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,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\"","import { createAction, createAsyncAction } from \"typesafe-actions\";\nimport { VideoState, YoukuVideo, StudyVideo } from \"../types\";\n\n// api\nexport const initServer = createAction(\"INIT_SERVER\", (action) => {\n  return (msg: string) => action({ msg: msg });\n});\n\nexport const fetchDemoVideo = createAction(\"FETCH_DEMOVIDEO\", (action) => {\n  return (payload: VideoState) => action(payload);\n});\n\nexport const fetchYoukuVideo = createAction(\"FETCH_YOUKUVIDEO\", (action) => {\n  return (payload: YoukuVideo) => action(payload);\n});\n\nexport const fetchStudyVideo = createAction(\"FETCH_STUDYVIDEO\", (action) => {\n  return (payload: StudyVideo) => action(payload);\n})\n\nexport const fetchDemoVideoAsync = createAsyncAction(\n  \"FETCH_DEMOVIDEO_REQUEST\",\n  \"FETCH_DEMOVIDEO_SUCCESS\",\n  \"FETCH_DEMOVIDEO_FAILURE\"\n)<string, VideoState, Error>();\n","export const consoleInfo = (msg: any): void => {\n  console.info(msg);\n};\n\nexport const consoleError = (msg: any): void => {\n  console.error(msg);\n};\n","import videojs, { VideoJsPlayer } from \"video.js\";\nimport { IOptions, CSSStyle } from \"../type\";\n\nconst Component = videojs.getComponent(\"Component\");\n\nexport class BaseDiv extends Component {\n  constructor(player: VideoJsPlayer, opts?: IOptions) {\n    super(player, opts);\n    videojs.dom.emptyEl(this.el());\n  }\n\n  createEl(): Element {\n    return videojs.dom.createEl(\"div\", {\n      className: \"vjs-default-div\",\n    });\n  }\n\n  setStyle(css?: CSSStyle): void {\n    let styleStr = \"\";\n    if (css) {\n      for (const key in css) {\n        styleStr += `${key}:${css[key as keyof CSSStyle]};`;\n      }\n    }\n    this.setAttribute(\"style\", styleStr);\n  }\n}\n","import { BaseDiv } from \"./BaseDom\";\nimport videojs, { VideoJsPlayer } from \"video.js\";\nimport { IOptions } from \"../type\";\n\nexport default class ProfileBox extends BaseDiv {\n  constructor(player: VideoJsPlayer, opts?: IOptions) {\n    super(player);\n    this.addClass(\"vjs-profile-box\");\n    const top = opts?.top || 0;\n    const left = opts?.left || 0;\n    const width = opts?.width || 100;\n    videojs.registerComponent(\"ProfileHead\", ProfileHead);\n    videojs.registerComponent(\"ProfileFoot\", ProfileFoot);\n    this.setStyle({\n      top: `${top}px`,\n      left: `${left}px`,\n      width: `${width}px`,\n      position: \"absolute\",\n    });\n    this.addChild(\"ProfileHead\", opts);\n    this.addChild(\"ProfileFoot\", opts);\n  }\n}\n\nclass ProfileHead extends BaseDiv {\n  constructor(player: VideoJsPlayer, opts?: IOptions) {\n    super(player);\n    const entity = opts?.entity || \"未命名\";\n    const score = (opts?.score || 0) as number;\n    const color = (opts?.color || \"#000\") as string;\n    videojs.dom.appendContent(this.el(), `${entity}: ${score * 100}%`);\n    this.setStyle({\n      width: \"100%\",\n      border: `1px solid ${color}`,\n      background: color,\n      \"font-size\": \"20px\",\n      \"line-height\": \"20px\",\n      \"text-align\": \"center\",\n    });\n  }\n}\n\nclass ProfileFoot extends BaseDiv {\n  constructor(player: VideoJsPlayer, opts?: IOptions) {\n    super(player);\n    const color = opts?.color || \"#000\";\n    const height = opts?.height || 200;\n    this.setStyle({\n      width: \"100%\",\n      border: `1px solid ${color}`,\n      height: `${height}px`,\n    });\n  }\n}\n","import { BaseDiv } from \"./BaseDom\";\nimport { VideoJsPlayer } from \"video.js\";\nimport echarts, { ECharts } from \"echarts\";\nimport { IOptions } from \"../type\";\n\nexport default class TimelineRiver extends BaseDiv {\n  myChart: ECharts;\n  constructor(player: VideoJsPlayer, opts?: IOptions) {\n    super(player);\n    this.addClass(\"vjs-timeline-river\");\n    const domDiv = this.el() as HTMLDivElement;\n    const width = opts?.width === undefined ? \"100%\" : `${opts?.width}px`;\n    const height = opts?.height === undefined ? \"50px\" : `${opts?.height}px`;\n    this.setStyle({\n      position: \"absolute\",\n      top: \"0\",\n      width: width,\n      height: height,\n    });\n    this.myChart = echarts.init(domDiv);\n    this.updateEChartsOptions(opts);\n  }\n\n  updateEChartsOptions(opts?: IOptions): void {\n    const color = (opts?.color || \"rgba(255, 255, 255, 0.3)\") as string;\n    // const bgColor = (opts?.bgColor || \"rgba(0, 0, 0, 0.5)\") as string;\n    const dataKeys = opts?.data ? Object.keys(opts?.data) : [];\n    const dataVals = opts?.data ? Object.values(opts?.data) : [];\n    // 指定图表的配置项和数据\n    // NOTICE: the grid left and right must be equal to 10\n    const option = {\n      // backgroundColor: bgColor,\n      grid: {\n        left: 10,\n        right: 10,\n        bottom: 0,\n        top: 0,\n      },\n      xAxis: {\n        show: false,\n        boundaryGap: false,\n        data: dataKeys,\n      },\n      yAxis: {\n        show: false,\n      },\n      series: [\n        {\n          name: \"risk\",\n          type: \"line\",\n          smooth: 0.6,\n          areaStyle: {\n            color: color,\n          },\n          showSymbol: false,\n          data: dataVals,\n          lineStyle: {\n            width: 0,\n            color: color,\n          },\n        },\n      ],\n    };\n    this.myChart.setOption(option);\n  }\n}\n","import { BaseDiv } from \"./BaseDom\";\nimport videojs, { VideoJsPlayer } from \"video.js\";\nimport { IOptions } from \"../type\";\nimport TimelineRiver from \"./TimelineRiver\";\n\nexport default class CustomizableControlBar extends BaseDiv {\n  constructor(player: VideoJsPlayer, opts?: IOptions) {\n    super(player);\n    this.addClass(\"vjs-control-bar-river\");\n    const width = opts?.width === undefined ? \"100%\" : `${opts?.width}px`;\n    const height = opts?.height === undefined ? \"50px\" : `${opts?.height}px`;\n    this.setStyle({\n      position: \"absolute\",\n      bottom: 0,\n      width: width,\n      height: height,\n      // background: \"rgba(0, 0, 0, 0.3)\",\n      \"background-image\":\n        \"linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.4))\",\n    });\n    // unclickable control items\n    videojs.registerComponent(\"TimelineRiver\", TimelineRiver);\n    this.addChild(\"TimelineRiver\", opts);\n    // clickable control items\n    const progressControl = this.addChild(\"ProgressControl\");\n    progressControl.setAttribute(\n      \"style\",\n      `\n      margin-top: 10px;\n      width: 100%;\n      height: 2em;\n    `\n    );\n    videojs.registerComponent(\"ControlItems\", ControlItems);\n    this.addChild(\"ControlItems\");\n  }\n}\n\nclass ControlItems extends BaseDiv {\n  constructor(player: VideoJsPlayer) {\n    super(player);\n    this.addClass(\"vjs-control-items\");\n    this.setStyle({\n      display: \"flex\",\n      width: \"100%\",\n      height: \"3em\",\n    });\n    // 4em for each control item\n    this.addChild(\"PlayToggle\");\n    this.addChild(\"RemainingTimeDisplay\");\n    this.addChild(\"VolumePanel\");\n    const spacer = this.addChild(\"Spacer\");\n    spacer.setAttribute(\n      \"style\",\n      `\n      width: 60vw;\n    `\n    );\n    this.addChild(\"PictureInPictureToggle\");\n    this.addChild(\"FullscreenToggle\");\n  }\n}\n","import { BaseDiv } from \"./BaseDom\";\nimport videojs, { VideoJsPlayer } from \"video.js\";\nimport { IOptions, RiskData, TextData } from \"../type\";\n\nexport default class RiskTimeline extends BaseDiv {\n  constructor(player: VideoJsPlayer, opts?: IOptions) {\n    super(player);\n    this.addClass(\"vjs-risk-timeline\");\n    const riskData = opts?.risk || {};\n    const textData = (opts?.text || []) as [];\n    const divHeight = opts?.height || 30;\n    const timeline = new RiskDataTimeline(riskData, textData);\n    const timeTicks = timeline.startTimeTicks;\n    const riskValues = timeline.riskValues(\"avg\");\n    const riskColors = riskValues.map((_val) => getRiskColorAvg(_val));\n    videojs.registerComponent(\"RiskColorBlock\", RiskDiv);\n    this.setStyle({\n      position: \"absolute\",\n      bottom: `-${divHeight}px`,\n      display: \"flex\",\n      flexDirection: \"row\",\n      width: \"100%\",\n      height: `${divHeight}px`,\n    });\n    riskColors.forEach((color, idx) => {\n      this.addChild(\"RiskColorBlock\", { color: color, time: timeTicks[idx] });\n    });\n  }\n}\n\nclass RiskDiv extends BaseDiv {\n  constructor(player: VideoJsPlayer, opts?: IOptions) {\n    super(player);\n    const time = (opts?.time || 0) as number;\n    const color = opts?.color || \"#fff\";\n    // 同步视频时间轴\n    videojs.on(this.el(), \"click\", () => {\n      player.currentTime(time);\n      player.play();\n    });\n    this.setStyle({\n      flex: \"auto\",\n      border: \"1px #fff solid\",\n      background: `${color}`,\n    });\n  }\n}\n\n// Hard code\nfunction getRiskColorAvg(riskValue) {\n  if (riskValue < 0.01) {\n    // return \"#a1d99b\";\n    return \"#d9d9da\";\n  }\n  if (riskValue < 0.1) {\n    // return \"#fdbb84\";\n    return \"#fdb462\";\n  }\n  // return \"#e34a33\";\n  return \"#80b1d3\";\n}\n\nexport class RiskDataTimeline {\n  riskData: RiskData;\n  textData: TextData;\n  constructor(riskData: RiskData, textData: TextData) {\n    this.riskData = riskData;\n    this.textData = textData;\n  }\n\n  riskValues(stat = \"sum\"): number[] {\n    const riskValues = [];\n    const startTimeTicks = this.startTimeTicks;\n    const endTimeTicks = this.endTimeTicks;\n    if (startTimeTicks.length === endTimeTicks.length) {\n      for (let i = 0, len = startTimeTicks.length; i < len; i++) {\n        const _startTime = startTimeTicks[i];\n        const _endTime = endTimeTicks[i];\n        let _riskValue = 0;\n        switch (stat) {\n          case \"avg\":\n            _riskValue = this.getRiskAvg(_startTime, _endTime);\n            break;\n          case \"max\":\n            _riskValue = this.getRiskMax(_startTime, _endTime);\n            break;\n          default:\n            _riskValue = this.getRiskSum(_startTime, _endTime);\n            break;\n        }\n        riskValues.push(_riskValue);\n      }\n    }\n    return riskValues;\n  }\n\n  get startTimeTicks() {\n    const startTimeTicks = this.textData.map((textItem) => textItem.start);\n    if (startTimeTicks.length > 0) {\n      startTimeTicks.sort((a, b) => a - b);\n      startTimeTicks[0] = 0;\n    }\n    return startTimeTicks;\n  }\n\n  get endTimeTicks() {\n    const endTimeTicks = this.textData.map((textItem) => textItem.end);\n    if (endTimeTicks.length > 0) {\n      endTimeTicks.sort((a, b) => a - b);\n    }\n    return endTimeTicks;\n  }\n\n  getRiskSum(startTime, endTime) {\n    const { riskData } = this;\n    let riskSum = 0;\n    for (const riskLabel in riskData) {\n      const riskTS = riskData[riskLabel];\n      for (const time in riskTS) {\n        if (+time >= startTime && +time <= endTime) {\n          const riskValue = riskTS[time];\n          if (riskValue > 0) {\n            riskSum += riskValue;\n          }\n        }\n      }\n    }\n    return Math.ceil(riskSum);\n  }\n\n  getRiskMax(startTime, endTime) {\n    const { riskData } = this;\n    let riskMax = 0;\n    for (const riskLabel in riskData) {\n      const riskTS = riskData[riskLabel];\n      for (const time in riskTS) {\n        if (+time >= startTime && +time <= endTime) {\n          const riskValue = riskTS[time];\n          if (riskValue > riskMax) {\n            riskMax = riskValue;\n          }\n        }\n      }\n    }\n    return riskMax;\n  }\n\n  getRiskAvg(startTime, endTime) {\n    const { riskData } = this;\n    let riskAvg = 0,\n      count = 0;\n    for (const riskLabel in riskData) {\n      const riskTS = riskData[riskLabel];\n      for (const time in riskTS) {\n        if (+time >= startTime && +time <= endTime) {\n          const riskValue = riskTS[time];\n          if (riskValue > 0) {\n            riskAvg += riskValue;\n            count++;\n          }\n        }\n      }\n    }\n    return riskAvg > 0 ? riskAvg / count : riskAvg;\n  }\n}\n","// React\nimport React, { Component, RefObject } from \"react\";\nimport { VideoAnnotation, RiskData, TextData } from \"./type\";\n// VideoJS\nimport videojs, { VideoJsPlayer } from \"video.js\";\nimport \"video.js/dist/video-js.css\";\n\n// Components for video.js\nimport ProfileBox from \"./Comps/ProfileBox\";\nimport CustomizableControlBar from \"./Comps/CustomizableControlBar\";\nimport RiskTimeline from \"./Comps/RiskTimeline\";\n\ntype Props = {\n  videoSrc: string | null;\n  videoType: string | null;\n  videoWidth: number;\n  videoHeight: number;\n  videoAnnotations?: VideoAnnotation[];\n  videoRisk?: RiskData;\n  videoText?: TextData;\n  videoStartTime?: number;\n  playerWidth?: number;\n  playerHeight?: number;\n};\n\ntype State = {\n  videoRisk?: RiskData;\n  videoText?: TextData;\n};\n\nclass VideoTracker extends Component<Props, State> {\n  player: VideoJsPlayer | null = null;\n  videoTrackerWrapperRef: RefObject<HTMLDivElement> = React.createRef();\n  profileBoxes: ProfileBox[] = [];\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      videoRisk: {},\n      videoText: [],\n    };\n    videojs.registerComponent(\"ProfileBox\", ProfileBox);\n    videojs.registerComponent(\"CustomizableControlBar\", CustomizableControlBar);\n    videojs.registerComponent(\"RiskTimeline\", RiskTimeline);\n  }\n\n  componentDidMount(): void {\n    const { playerWidth, playerHeight, videoWidth, videoHeight } = this.props;\n    // By default, the palyer will fill up the parent container.\n    const defaultWidth = this.videoTrackerWrapperRef.current.clientWidth;\n    const defaultHeight = this.videoTrackerWrapperRef.current.clientHeight;\n    const width = playerWidth || defaultWidth || videoWidth;\n    const height = playerHeight || defaultHeight || videoHeight;\n    // Transform coordination\n    const scale = Math.max(videoWidth / width, videoHeight / height);\n    const x0 = (width - videoWidth / scale) / 2;\n    const y0 = (height - videoHeight / scale) / 2;\n    // Configure player after dom rendered\n    this.player = videojs(\"video-tracker\", {\n      autoplay: false,\n      controls: true,\n      width: width,\n      height: height,\n      children: [],\n    });\n    this.player.on(\"timeupdate\", () => {\n      const currentMileseconds = (this.player?.currentTime() || 0) * 1000;\n      // erase all boxes\n      this.profileBoxes.forEach((_profile) => {\n        _profile.dispose();\n      });\n      const withinRangeAnnotations = this.props.videoAnnotations?.filter(\n        (_annotation) => {\n          return (\n            _annotation.start <= currentMileseconds &&\n            _annotation.start + _annotation.duration > currentMileseconds\n          );\n        }\n      );\n      this.profileBoxes =\n        withinRangeAnnotations?.map((_annotation) => {\n          const left = _annotation.box[0] / scale + x0;\n          const top = _annotation.box[1] / scale + y0;\n          const width = _annotation.box[2] / scale + x0 - left;\n          const height = _annotation.box[3] / scale + y0 - top;\n          const entity = _annotation.label;\n          const score = _annotation.confidence;\n          return this.player?.addChild(\"ProfileBox\", {\n            top: top,\n            left: left,\n            width: width,\n            height: height,\n            entity: entity,\n            score: score,\n          }) as ProfileBox;\n        }) || [];\n    });\n    // set up UI components\n    this.player.addChild(\"CustomizableControlBar\", {\n      width: width,\n      height: 60,\n    });\n  }\n\n  componentDidUpdate(): void {\n    if (!this.player) return;\n    // update video source\n    if (this.props.videoSrc) {\n      this.player.src({\n        src: this.props.videoSrc,\n        type: this.props.videoType || \"video/mp4\",\n      });\n    }\n    // update player size\n    if (this.props.playerWidth) {\n      this.player.width(this.props.playerWidth);\n    }\n    if (this.props.playerHeight) {\n      this.player.height(this.props.playerHeight);\n    }\n    // update player time\n    if (this.props.videoStartTime) {\n      this.player.currentTime(this.props.videoStartTime);\n      this.player.play();\n    }\n    const { videoRisk, videoText } = this.props;\n    if (videoRisk && videoText) {\n      this.player.addChild(\"RiskTimeline\", {\n        risk: videoRisk,\n        text: videoText,\n      });\n    }\n  }\n\n  componentWillUnmount(): void {\n    // destroy player instance\n    if (this.player) {\n      this.player.dispose();\n    }\n  }\n\n  render(): JSX.Element {\n    const { playerWidth, playerHeight } = this.props;\n    const width = playerWidth ? `${playerWidth}px` : \"100%\";\n    const height = playerHeight ? `${playerHeight}px` : \"100%\";\n    return (\n      <div\n        className=\"video-tracker-wrapper\"\n        style={{ width: width, height: height }}\n        ref={this.videoTrackerWrapperRef}\n        data-vjs-player\n      >\n        <video id=\"video-tracker\" className=\"video-js\" />\n      </div>\n    );\n  }\n}\n\nexport default VideoTracker;\n","import { TSData, RiskLabelTree, Frame } from \"./type\";\n\nexport class RiskDataManager {\n  rawRiskData: TSData;\n  riskLabelTree: RiskLabelTree;\n  timeTicks: string[];\n  constructor(rawRiskData: TSData) {\n    this.rawRiskData = rawRiskData;\n    this.riskLabelTree = generateRiskLabelTree(rawRiskData);\n    this.timeTicks = generateTimeTicks(rawRiskData);\n  }\n\n  getFrameRiskTree(time: string) {\n    if (this.timeTicks.includes(time)) {\n      const frameRiskLabelTree = {};\n      for (const riskType in this.riskLabelTree) {\n        if (!frameRiskLabelTree.hasOwnProperty(riskType)) {\n          frameRiskLabelTree[riskType] = {};\n        }\n        for (const riskLabel in this.riskLabelTree[riskType]) {\n          const riskValue = this.riskLabelTree[riskType][riskLabel];\n          frameRiskLabelTree[riskType][riskLabel] = riskValue[time];\n        }\n      }\n      return frameRiskLabelTree;\n    }\n    return null;\n  }\n\n  getSceneMaxRiskData(scene: Frame[]) {\n    const sceneMaxRiskData = this.getFrameRiskTree(`${scene[0].time}`);\n    const sceneMaxRiskDataTime = JSON.parse(JSON.stringify(sceneMaxRiskData));\n    for (const riskType in sceneMaxRiskDataTime) {\n      for (const riskLabel in sceneMaxRiskDataTime[riskType]) {\n        sceneMaxRiskDataTime[riskType][riskLabel] = scene[0].time;\n      }\n    }\n    for (let i = 1; i < scene.length; i++) {\n      const frameRiskTree = this.getFrameRiskTree(`${scene[i].time}`);\n      for (const riskType in frameRiskTree) {\n        for (const riskLabel in frameRiskTree[riskType]) {\n          if (\n            frameRiskTree[riskType][riskLabel] >\n            sceneMaxRiskData[riskType][riskLabel]\n          ) {\n            sceneMaxRiskData[riskType][riskLabel] =\n              frameRiskTree[riskType][riskLabel];\n            sceneMaxRiskDataTime[riskType][riskLabel] = scene[i].time;\n          }\n        }\n      }\n    }\n    // console.log('wyh-test', sceneRiskMaxData, sceneRiskMaxDataTime);\n    return {\n      sceneMaxRiskData: sceneMaxRiskData,\n      sceneMaxRiskDataTime: sceneMaxRiskDataTime, // 这里的逻辑还没确定（目前交互是riskLabel层级的）\n    };\n  }\n\n  getFrameRiskMax(scene: Frame[]) {\n    let maxRiskFrameIndex = 0;\n    let maxRiskValue = 0;\n    for (let i = 0; i < scene.length; i++) {\n      const frameRiskTree = this.getFrameRiskTree(`${scene[i].time}`);\n      for (const riskType in frameRiskTree) {\n        for (const riskLabel in frameRiskTree[riskType]) {\n          if (frameRiskTree[riskType][riskLabel] > maxRiskValue) {\n            maxRiskValue = frameRiskTree[riskType][riskLabel];\n            maxRiskFrameIndex = i;\n          }\n        }\n      }\n    }\n    return scene[maxRiskFrameIndex];\n  }\n\n  getFrameRiskSumMax(scene: Frame[]) {\n    let maxRiskFrameIndex = 0;\n    let maxRiskValue = 0;\n    for (let i = 0; i < scene.length; i++) {\n      const frameRiskTree = this.getFrameRiskTree(`${scene[i].time}`);\n      let sum = 0;\n      for (const riskType in frameRiskTree) {\n        for (const riskLabel in frameRiskTree[riskType]) {\n          sum += frameRiskTree[riskType][riskLabel];\n        }\n      }\n      if (sum > maxRiskValue) {\n        maxRiskValue = sum;\n        maxRiskFrameIndex = i;\n      }\n    }\n    // return scene[maxRiskFrameIndex];\n    return JSON.parse(JSON.stringify(scene[maxRiskFrameIndex]));\n  }\n\n  getFrameViewData(scenes: Frame[][]) {\n    const scenesMaxRiskData = scenes.map((scene) =>\n      this.getSceneMaxRiskData(scene)\n    );\n    const scenesMaxRiskSum = scenesMaxRiskData.map((sceneData) =>\n      computeRiskSum(sceneData.sceneMaxRiskData)\n    );\n    const scenesData = JSON.parse(JSON.stringify(scenes));\n    for (let i = 0; i < scenesMaxRiskSum.length - 1; i++) {\n      for (let j = i + 1; j < scenesMaxRiskSum.length; j++) {\n        if (scenesMaxRiskSum[i] < scenesMaxRiskSum[j]) {\n          const t = scenesMaxRiskSum[i];\n          scenesMaxRiskSum[i] = scenesMaxRiskSum[j];\n          scenesMaxRiskSum[j] = t;\n          const tframe = scenesData[i];\n          scenesData[i] = scenesData[j];\n          scenesData[j] = tframe;\n          const trisk = scenesMaxRiskData[i];\n          scenesMaxRiskData[i] = scenesMaxRiskData[j];\n          scenesMaxRiskData[j] = trisk;\n        }\n      }\n    }\n    const scenesMaxRiskFrame = scenesData.map((scene) =>\n      // this.getFrameRiskMax(scene)\n      this.getFrameRiskSumMax(scene)\n    );\n    // console.log('wyh-test-02', scenesMaxRiskFrame)\n    return {\n      scenesMaxRiskData: scenesMaxRiskData,\n      scenesMaxRiskFrame: scenesMaxRiskFrame,\n      frameViewData: scenesData,\n    };\n  }\n}\n\nfunction generateTimeTicks(rawRiskData: TSData) {\n  for (const label in rawRiskData) {\n    const tskv = rawRiskData[label];\n    const tskeys = Object.keys(tskv);\n    tskeys.sort((a, b) => parseFloat(a) - parseFloat(b));\n    return tskeys;\n  }\n  return [];\n}\n\nfunction generateRiskLabelTree(rawRiskData: TSData) {\n  const rawRiskLabels = Object.keys(rawRiskData);\n  const riskLabelTree = {};\n  for (let i = 0, len = rawRiskLabels.length; i < len; i++) {\n    const riskLabel = rawRiskLabels[i];\n    const riskValue = rawRiskData[riskLabel];\n    if (aggregateArr(Object.values(riskValue)) > 0) {\n      riskDataProtocV1(riskLabelTree, riskLabel, riskValue);\n    }\n  }\n  return riskLabelTree;\n}\n\nfunction aggregateArr(arr) {\n  const reducer = (accumulator, currentValue) => accumulator + currentValue;\n  return arr.reduce(reducer);\n}\n\n// 采用风险数据协议v1\nfunction riskDataProtocV1(riskLabelTree, riskLabel, riskValue) {\n  let riskLabelTags = riskLabel\n    .split(\"_\")\n    .filter((tag) => tag !== \"Det\" && tag !== \"v0\");\n  if (riskLabelTags[1] === \"情趣品\") {\n    riskLabelTags = [aggregateArr(riskLabelTags)];\n  }\n  switch (riskLabelTags.length) {\n    case 1:\n      if (!riskLabelTree.hasOwnProperty(\"低俗色情\")) {\n        riskLabelTree[\"低俗色情\"] = {};\n      }\n      riskLabelTree[\"低俗色情\"][riskLabelTags[0]] = riskValue;\n      break;\n    case 2:\n      if (!riskLabelTree.hasOwnProperty(riskLabelTags[0])) {\n        riskLabelTree[riskLabelTags[0]] = {};\n      }\n      riskLabelTree[riskLabelTags[0]][riskLabelTags[1]] = riskValue;\n      break;\n    default:\n      break;\n  }\n}\n\nexport function computeRiskSum(\n  sceneData: Record<string, Record<string, number>>\n) {\n  let sum = 0;\n  for (const riskType in sceneData) {\n    for (const riskLabel in sceneData[riskType]) {\n      sum += sceneData[riskType][riskLabel];\n    }\n  }\n  return sum;\n}\n\nexport function normalization(numArray: number[]) {\n  let sum = 0;\n  for (let i = 0; i < numArray.length; i++) {\n    sum += numArray[i];\n  }\n  return numArray.map((num) => num / sum);\n}\n","import React, { Component } from \"react\";\nimport { Frame, FrameRiskTree } from \"../type\";\n\ntype Props = {\n  sceneX: number;\n  sceneH: number;\n  frame: Frame;\n  frameRiskTree: FrameRiskTree;\n  riskColorMap: Map<string, string>;\n  riskEncode?: \"angle\" | \"height\" | \"mixed\";\n  R_RATIO: number;\n  callbackFn: (focusRiskLabel: string) => void;\n};\n\ntype State = {\n  cx: number;\n  cy: number;\n  innerR: number;\n  outerR: number;\n  riskTypes: string[];\n  riskLabels: string[];\n  riskStore: Map<string, number>;\n  riskMax: number;\n  focusRiskLabel: string | null;\n  frameSizeScale: number;\n};\n\nconst riskThreshold = 1e-3;\n\nexport default class RadialBarGlyph extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    const { frame, frameRiskTree } = props;\n    const riskLabels = [];\n    const riskStore = new Map();\n    let sum = 0;\n    for (const riskType in frameRiskTree) {\n      for (const riskLabel in frameRiskTree[riskType]) {\n        if (frameRiskTree[riskType][riskLabel] > riskThreshold) {\n          sum += frameRiskTree[riskType][riskLabel];\n        }\n      }\n    }\n    let riskMax = 0;\n    for (const riskType in frameRiskTree) {\n      for (const riskLabel in frameRiskTree[riskType]) {\n        const _riskScore = frameRiskTree[riskType][riskLabel];\n        const _riskLabel = `${riskType}_${riskLabel}`;\n        if (_riskScore > riskThreshold) {\n          riskLabels.push(_riskLabel);\n          riskStore.set(_riskLabel, _riskScore / sum);\n          if (_riskScore / sum > riskMax) {\n            riskMax = _riskScore / sum;\n          }\n        }\n      }\n    }\n\n    // new\n    const frameSizeScale = 0.8;\n\n    const innerR = (frame.size[0] / 2) * frameSizeScale;\n    const outerR = Math.min(props.sceneH, props.sceneX) / 2;\n    this.state = {\n      cx: props.sceneX - outerR - 80,\n      cy: props.sceneH / 2,\n      innerR: innerR,\n      outerR: outerR,\n      riskTypes: Object.keys(frameRiskTree),\n      riskLabels: riskLabels,\n      riskStore: riskStore,\n      riskMax: riskMax,\n      focusRiskLabel: null,\n      frameSizeScale: frameSizeScale,\n    };\n  }\n\n  render() {\n    const {\n      frame,\n      riskColorMap,\n      R_RATIO,\n      riskEncode,\n      sceneX,\n      sceneH,\n    } = this.props;\n    const svgW = sceneX;\n    const svgH = sceneH;\n    const G_RATIO = R_RATIO * 0.8;\n    const {\n      cx,\n      cy,\n      innerR,\n      outerR,\n      riskLabels,\n      riskStore,\n      riskMax,\n      focusRiskLabel,\n      frameSizeScale,\n    } = this.state;\n    let startAngle = 0;\n    const PieSectors = riskLabels.map((riskLabel) => {\n      let endAngle,\n        _outerR = outerR;\n      let proportion = riskStore.get(riskLabel);\n      if (proportion === 1) {\n        proportion = 0.999;\n      }\n      if (riskEncode === \"angle\") {\n        endAngle = startAngle + proportion * Math.PI * 2;\n        // _outerR = innerR * 2 * G_RATIO;\n        _outerR = innerR * (1 + (riskMax / riskMax) * G_RATIO);\n      } else if (riskEncode === \"height\") {\n        endAngle =\n          startAngle +\n          ((riskLabels.length === 1 ? 0.999 : 1) * Math.PI * 2) /\n            riskLabels.length;\n        _outerR = innerR * (1 + (proportion / riskMax) * G_RATIO);\n      } else {\n        endAngle = startAngle + proportion * Math.PI * 2;\n        _outerR = innerR * (1 + (proportion / riskMax) * G_RATIO);\n      }\n      const pathD = generatePieSectorPathD(\n        cx,\n        cy,\n        innerR,\n        _outerR,\n        startAngle,\n        endAngle\n      );\n      const focusPathD = generatePieSectorPathD(\n        cx,\n        cy,\n        innerR,\n        innerR * (1 + R_RATIO),\n        startAngle,\n        endAngle\n      );\n      startAngle = endAngle;\n      const [riskType, riskTag] = riskLabel.split(\"_\");\n      const riskColor = riskColorMap.get(riskType);\n      return (\n        <g\n          key={`scene-${frame.scene}-${riskLabel}`}\n          onClick={() => this.props.callbackFn(riskLabel)}\n          onMouseEnter={() => this.setState({ focusRiskLabel: riskLabel })}\n          onMouseLeave={() => this.setState({ focusRiskLabel: null })}\n        >\n          <path\n            id={`scene${frame.scene}${riskLabel}`}\n            style={{ fill: riskColor, stroke: \"#fff\", strokeWidth: 0.5 }}\n            d={focusRiskLabel === riskLabel ? focusPathD : pathD}\n          />\n          {focusRiskLabel === riskLabel && (\n            <g>\n              <rect\n                key={`tooltip-${frame.scene}-${riskType}-${riskTag}`}\n                x={120}\n                y={30}\n                width={70}\n                height={60}\n                style={{\n                  fill: riskColor,\n                  fillOpacity: 0.6,\n                  stroke: riskColor,\n                  strokeWidth: 2,\n                }}\n                rx={5}\n                ry={5}\n              ></rect>\n              <text x={125} y={45} fill=\"#fff\">\n                {riskType}\n              </text>\n              <text x={125} y={45 + 15} fill=\"#fff\">\n                {riskTag}\n              </text>\n              <text x={125} y={45 + 15 * 2} fill=\"#fff\">\n                {proportion.toFixed(4)}\n              </text>\n            </g>\n          )}\n        </g>\n      );\n    });\n    // hard code\n    // frame.size[0] = 82.782;\n    // frame.size[1] = 82.782;\n    return (\n      <div className=\"raidal-bar-frame\">\n        <svg\n          width={svgW}\n          height={svgH}\n          style={{ position: \"absolute\", zIndex: 10 }}\n        >\n          {PieSectors}\n        </svg>\n        <img\n          key={`scene-${frame.scene}-thumbnail-${frame.time}`}\n          src={frame.src}\n          style={{\n            position: \"absolute\",\n            left: `${this.state.cx - (frameSizeScale * frame.size[0]) / 2}px`,\n            top: `${this.state.cy - (frameSizeScale * frame.size[1]) / 2}px`,\n            width: `${frameSizeScale * frame.size[0]}px`,\n            height: `${frameSizeScale * frame.size[1]}px`,\n            zIndex: 0,\n            borderRadius: `50%`,\n          }}\n        />\n      </div>\n    );\n  }\n}\n\nfunction generatePieSectorPathD(\n  cx: number,\n  cy: number,\n  innerR: number,\n  outerR: number,\n  startAngle: number,\n  endAngle: number\n) {\n  const six = cx + innerR * Math.cos(startAngle);\n  const siy = cy + innerR * Math.sin(startAngle);\n  const sox = cx + outerR * Math.cos(startAngle);\n  const soy = cy + outerR * Math.sin(startAngle);\n  const eox = cx + outerR * Math.cos(endAngle);\n  const eoy = cy + outerR * Math.sin(endAngle);\n  const eix = cx + innerR * Math.cos(endAngle);\n  const eiy = cy + innerR * Math.sin(endAngle);\n  if (endAngle - startAngle < Math.PI) {\n    return `M ${six} ${siy} L ${sox} ${soy} A ${outerR} ${outerR} 0 0 1 ${eox} ${eoy} L ${eix} ${eiy} A ${innerR} ${innerR} 0 0 0 ${six} ${siy}`;\n  } else if (endAngle - startAngle) {\n    return `M ${six} ${siy} L ${sox} ${soy} A ${outerR} ${outerR} 0 1 1 ${eox} ${eoy} L ${eix} ${eiy} A ${innerR} ${innerR} 0 1 0 ${six} ${siy}`;\n  }\n}\n\nfunction generateTextPosition(\n  cx: number,\n  cy: number,\n  innerR: number,\n  outerR: number,\n  startAngle: number\n) {\n  const six = cx + ((innerR + outerR) * Math.cos(startAngle)) / 2;\n  const siy = cy + ((innerR + outerR) * Math.sin(startAngle)) / 2;\n  return [six, siy];\n}\n","import React, { Component } from \"react\";\nimport { Frame, FrameRiskTree } from \"../type\";\n\ntype Props = {\n  frame: Frame;\n  frameScale: number;\n  frameRiskTree: FrameRiskTree;\n  focusRiskLabel: string;\n};\n\ntype State = Record<string, unknown>;\n\nconst riskThreshold = 1e-2;\n\nexport default class ScalableFrame extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {};\n  }\n\n  getDefaultStyle() {\n    return {\n      transform: `scale(1)`,\n    };\n  }\n\n  getFocusStyle() {\n    return {\n      transform: `scale(${this.props.frameScale})`,\n      zIndex: 100,\n    };\n  }\n\n  getFrameStyle() {\n    const { frameRiskTree, focusRiskLabel } = this.props;\n    if (frameRiskTree && focusRiskLabel) {\n      const [riskType, riskTag] = focusRiskLabel.split(\"_\");\n      return frameRiskTree[riskType][riskTag] > riskThreshold\n        ? this.getFocusStyle()\n        : this.getDefaultStyle();\n    }\n    return this.getDefaultStyle();\n  }\n\n  render() {\n    const { frame } = this.props;\n    return (\n      <div className=\"scalable-frame\" style={this.getFrameStyle()}>\n        <img\n          src={frame.src}\n          style={{\n            width: `${frame.size[0]}px`,\n            height: `${frame.size[1]}px`,\n          }}\n        />\n      </div>\n    );\n  }\n}\n","import React, { Component } from \"react\";\nimport { Frame, FrameRiskTree, RiskColorMap, TSData } from \"./type\";\nimport { RiskDataManager } from \"./dataProp\";\n\nimport RadialBarFrame from \"./frames/RadialBarFrame\";\nimport ScalableFrame from \"./frames/ScalableFrame\";\n\ntype Props = {\n  thumbnail: Frame;\n  frames: Frame[];\n  color: RiskColorMap;\n  riskData: TSData;\n  sceneRisk: FrameRiskTree;\n  sceneX: number;\n  sceneH: number;\n  sceneId: number;\n  callbackFn: (currentTime: number) => void;\n};\n\ntype State = {\n  R_RATIO: number;\n  focusRiskLabel: string | null;\n};\n\nexport default class Scene extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      R_RATIO: 0.4,\n      focusRiskLabel: null,\n    };\n  }\n\n  setFocusRiskLabel(riskLabel: string) {\n    this.setState({\n      focusRiskLabel: riskLabel,\n    });\n  }\n\n  render() {\n    const {\n      thumbnail,\n      frames,\n      riskData,\n      color,\n      sceneRisk,\n      sceneX,\n      sceneH,\n      sceneId,\n    } = this.props;\n    const { R_RATIO, focusRiskLabel } = this.state;\n    const riskDataManager = new RiskDataManager(riskData);\n    const sceneFrames = frames.map((frame) => {\n      return (\n        <div\n          className=\"scene-frame-wrapper\"\n          key={`scene-${thumbnail.scene}-frame-${frame.time}`}\n          style={{\n            position: \"absolute\",\n            left: `${frame.value[0]}px`,\n            top: `${(sceneH - frame.size[1]) / 2}px`,\n          }}\n          onClick={() => {\n            this.props.callbackFn(frame.time);\n          }}\n        >\n          <ScalableFrame\n            frame={frame}\n            frameScale={sceneH / frame.size[1]}\n            frameRiskTree={riskDataManager.getFrameRiskTree(`${frame.time}`)}\n            focusRiskLabel={focusRiskLabel}\n          />\n        </div>\n      );\n    });\n    return (\n      <div\n        className=\"scene\"\n        style={{\n          position: \"relative\",\n          background: \"#fff\",\n          marginBottom: \"4px\",\n          height: `${sceneH}px`,\n          width: \"100%\",\n        }}\n      >\n        <RadialBarFrame\n          sceneX={sceneX}\n          sceneH={sceneH}\n          frame={thumbnail}\n          frameRiskTree={sceneRisk}\n          riskColorMap={color}\n          R_RATIO={sceneId < 3 ? R_RATIO : 0}\n          riskEncode={\"mixed\"}\n          callbackFn={(riskLabel: string) => this.setFocusRiskLabel(riskLabel)}\n        />\n        {sceneFrames}\n      </div>\n    );\n  }\n}\n","import React, { Component, RefObject } from \"react\";\nimport { RiskDataManager } from \"./dataProp\";\nimport { TSData, Frame, RiskColorMap } from \"./type\";\n\nimport Scene from \"./Scene\";\n\nimport \"./index.css\";\n\ntype Props = {\n  data: Frame[];\n  risk: TSData;\n  color: RiskColorMap;\n  setCurrentVideoTime: (currentTime: number) => void;\n};\n\ntype State = {\n  containerX: number;\n  containerW: number;\n  containerH: number;\n  containerPadding: number[];\n  displayScenes: number;\n  thumbnailRatio: number;\n  frames: Frame[];\n  scenes: Frame[][];\n};\n\nexport default class FrameBrowser extends Component<Props, State> {\n  containerDom: RefObject<HTMLDivElement> = React.createRef();\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      containerX: 200,\n      containerH: 500,\n      containerW: 500,\n      containerPadding: [40, 0, 120, 0], // [l, b, r, t]\n      displayScenes: 4,\n      thumbnailRatio: 0.2,\n      frames: [],\n      scenes: [],\n    };\n  }\n\n  componentDidMount() {\n    const DOM = this.containerDom.current as HTMLDivElement;\n    const [\n      containerLeft,\n      containerBottom,\n      containerRight,\n      containerTop,\n    ] = this.state.containerPadding;\n    // Init container\n    this.setState({\n      containerW: DOM.clientWidth - containerLeft - containerRight,\n      containerH: DOM.clientHeight - containerBottom - containerTop,\n    });\n  }\n\n  static getDerivedStateFromProps(nextProps: Props, prevState: State) {\n    const inputData = nextProps.data || [];\n    if (inputData === prevState.frames) return null;\n    const {\n      containerW,\n      containerH,\n      containerX,\n      containerPadding,\n      displayScenes,\n    } = prevState;\n    const sceneId = [];\n    const scenes = [];\n    const thumbnailWidth = containerX - containerPadding[0];\n    const thumbnailHeight = containerH / displayScenes;\n    inputData.forEach((frame) => {\n      // Mapping frames to container coordination\n      const x = frame.value[0];\n      frame.value[0] =\n        x > 1 ? x : x * (containerW - thumbnailWidth) + containerX;\n      // frame.value[1] = y > 1 ? y : y * containerH;\n      frame.value[1] = (frame.scene + 1) * thumbnailHeight;\n      frame.size[0] = thumbnailHeight * 0.8;\n      frame.size[1] = thumbnailHeight * 0.8;\n      // Group frames into scenes\n      let i = 0;\n      let isInScenes = false;\n      for (; i < sceneId.length; i++) {\n        if (sceneId[i] === frame.scene) {\n          isInScenes = true;\n          break;\n        }\n      }\n      if (!isInScenes) {\n        sceneId.push(frame.scene);\n        scenes.push([frame]);\n      } else {\n        scenes[i].push(frame);\n      }\n    });\n    return {\n      frames: inputData,\n      scenes: scenes,\n    };\n  }\n\n  render() {\n    const riskDataManager = new RiskDataManager(this.props.risk);\n    const scenes = this.state.scenes;\n    const sceneH = this.state.containerH / this.state.displayScenes;\n    const {\n      scenesMaxRiskData,\n      scenesMaxRiskFrame,\n      frameViewData,\n    } = riskDataManager.getFrameViewData(scenes);\n    // TODO: integrate getFrameViewData into Scene\n    const Scenes = scenes.map((scene, idx) => (\n      <Scene\n        key={`scene-${idx}`}\n        sceneId={idx}\n        thumbnail={scenesMaxRiskFrame[idx]}\n        frames={frameViewData[idx]}\n        riskData={this.props.risk}\n        color={this.props.color}\n        sceneRisk={scenesMaxRiskData[idx].sceneMaxRiskData}\n        sceneX={this.state.containerX}\n        sceneH={sceneH}\n        callbackFn={(videoTime: number) =>\n          this.props.setCurrentVideoTime(videoTime)\n        }\n      />\n    ));\n    return (\n      <div\n        className=\"frame-browser\"\n        style={{ width: \"100%\", height: \"100%\", overflowY: \"scroll\" }}\n        ref={this.containerDom}\n      >\n        {Scenes}\n      </div>\n    );\n  }\n}\n","export function logConstraintError(type) {\r\n  console.warn(`Invalid ${type} constraints.`)\r\n}\r\n\r\nexport function logGeneratorError(type) {\r\n  console.warn(`Invalid ${type} generator.`)\r\n}\r\n\r\nexport function logStoryInfo(story) {\r\n  console.log(story)\r\n  // story size\r\n  const rows = story.getTableRows()\r\n  const cols = story.getTableCols()\r\n  console.log(`Story Size: ${rows}x${cols}`)\r\n  // story timeline\r\n  const timeStamps = story.timeline\r\n  console.log(`Story Timeline: ${timeStamps}`)\r\n  // story characters\r\n  const charaTable = story.getTable('character')\r\n  console.log(\r\n    `Character Table ${charaTable.rows}x${charaTable.cols}: ${charaTable.mat}`\r\n  )\r\n  // story locations\r\n  const locationTable = story.getTable('location')\r\n  console.log(\r\n    `Location Table ${locationTable.rows}x${locationTable.cols}: ${locationTable.mat}`\r\n  )\r\n  // story sessions\r\n  const sessionTable = story.getTable('session')\r\n  console.log(\r\n    `Session Table ${sessionTable.rows}x${sessionTable.cols}: ${sessionTable.mat}`\r\n  )\r\n}\r\n","import { create, all } from \"mathjs\";\r\n\r\nconst math = create(all, {});\r\n\r\nexport class Table {\r\n  /**\r\n   * Table for Generators\r\n   * @param {null | Number | Array | DenseMatrix} param\r\n   */\r\n  constructor(data) {\r\n    if (data) {\r\n      if (data.length) {\r\n        this._mat = math.matrix(data);\r\n      } else {\r\n        this._mat = data;\r\n      }\r\n    } else {\r\n      this._mat = null;\r\n    }\r\n  }\r\n\r\n  get mat() {\r\n    return this._mat;\r\n  }\r\n\r\n  get rows() {\r\n    return this._mat ? (this._mat.type ? this._mat.size()[0] : 1) : 0;\r\n  }\r\n\r\n  get cols() {\r\n    return this._mat ? (this._mat.type ? this._mat.size()[1] : 1) : 0;\r\n  }\r\n\r\n  get type() {\r\n    return this._mat ? (this._mat.type ? \"matrix\" : typeof this._mat) : null;\r\n  }\r\n\r\n  /**\r\n   * Obtain the value at (row, col).\r\n   * @param {Number} row\r\n   * @param {Number} col\r\n   */\r\n  value(row, col) {\r\n    return this.type === \"matrix\"\r\n      ? this._mat.subset(math.index(row, col))\r\n      : this._mat;\r\n  }\r\n\r\n  /**\r\n   * Obtain a independent copy of the table.\r\n   */\r\n  clone() {\r\n    const data = this.type === \"matrix\" ? math.clone(this.mat) : this.mat;\r\n    return new Table(data);\r\n  }\r\n\r\n  /**\r\n   * Translate the input range into a valid range.\r\n   * @param {Number | Array | DenseMatrix} rowRange\r\n   * @param {Number | Array | DenseMatrix} colRange\r\n   */\r\n  _translateRange(rowRange, colRange) {\r\n    let _rowRange = rowRange;\r\n    if (rowRange.length && rowRange.length === 0) {\r\n      _rowRange = 0;\r\n    }\r\n    if (rowRange.type && rowRange.size()[0] === 0) {\r\n      _rowRange = 0;\r\n    }\r\n    let _colRange = colRange;\r\n    if (colRange.length && colRange.length === 0) {\r\n      _colRange = 0;\r\n    }\r\n    if (colRange.type && colRange.size()[0] === 0) {\r\n      _colRange = 0;\r\n    }\r\n    return [_rowRange, _colRange];\r\n  }\r\n\r\n  /**\r\n   * Obtain the sub-table within [rowRange, colRange].\r\n   * @param {Number | Array | DenseMatrix} rowRange\r\n   * @param {Number | Array | DenseMatrix} colRange\r\n   */\r\n  subtable(rowRange, colRange) {\r\n    if (this._mat === null) return null;\r\n    const [_rowRange, _colRange] = this._translateRange(rowRange, colRange);\r\n    const range = math.index(_rowRange, _colRange);\r\n    const submat = this._mat.subset(range);\r\n    return new Table(submat);\r\n  }\r\n\r\n  /**\r\n   * Resize the table to (rows, cols).\r\n   * @param {Number} rows\r\n   * @param {Number} cols\r\n   */\r\n  resize(rows, cols, val = 0) {\r\n    if (this.type === \"matrix\") {\r\n      this._mat.resize([rows, cols]);\r\n    } else {\r\n      const _zeroMat = math.zeros(rows, cols);\r\n      const _mat = math.add(_zeroMat, val);\r\n      if (this._mat) {\r\n        _mat.subset(math.index(0, 0), this.mat);\r\n      }\r\n      this._mat = _mat;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Replace one row or one column of values.\r\n   * @param {Number | Array | DenseMatrix} rowRange\r\n   * @param {Number | Array | DenseMatrix} colRange\r\n   * @param {Number | Array | DenseMatrix} mat\r\n   */\r\n  replace(rowRange, colRange, mat) {\r\n    if (this._mat === null) return null;\r\n    const [_rowRange, _colRange] = this._translateRange(rowRange, colRange);\r\n    const range = math.index(_rowRange, _colRange);\r\n    this._mat.subset(range, mat);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Number} index\r\n   * @param {Array} arr\r\n   * @param {Boolean} isColumn\r\n   */\r\n  extend(index, arr, isColumn = false) {\r\n    // A scalar or null must be resized before beding extended.\r\n    // console.log(this._mat, this.type);\r\n    if (this._mat === null || this.type === \"number\") {\r\n      const rows = isColumn ? arr.length : 1;\r\n      const cols = isColumn ? 1 : arr.length;\r\n      // console.log(rows, cols, this._mat);\r\n      this.resize(rows, cols, this._mat || 0);\r\n    }\r\n    let _zeroTable;\r\n    if (isColumn) {\r\n      const rowRange = math.range(0, this.rows);\r\n      if (index < this.cols) {\r\n        _zeroTable = new Table(math.zeros(this.rows, this.cols + 1));\r\n        const headRange = index === 0 ? 0 : math.range(0, index);\r\n        const headTable = this.subtable(rowRange, headRange);\r\n        const tailRange = math.range(index + 1, this.cols + 1);\r\n        const tailTable = this.subtable(rowRange, math.range(index, this.cols));\r\n        if (index > 0) _zeroTable.replace(rowRange, headRange, headTable.mat);\r\n        if (index < this.cols)\r\n          _zeroTable.replace(rowRange, tailRange, tailTable.mat);\r\n      } else {\r\n        _zeroTable = new Table(math.zeros(this.rows, index + 1));\r\n        const colRange = math.range(0, this.cols);\r\n        _zeroTable.replace(rowRange, colRange, this.mat);\r\n      }\r\n      _zeroTable.replace(rowRange, index, arr);\r\n      this._mat = _zeroTable._mat;\r\n    } else {\r\n      const colRange = math.range(0, this.cols);\r\n      if (index < this.rows) {\r\n        _zeroTable = new Table(math.zeros(this.rows + 1, this.cols));\r\n        const headRange = index === 0 ? 0 : math.range(0, index);\r\n        const headTable = this.subtable(headRange, colRange);\r\n        const tailRange = math.range(index + 1, this.rows + 1);\r\n        const tailTable = this.subtable(math.range(index, this.rows), colRange);\r\n        if (index > 0) _zeroTable.replace(headRange, colRange, headTable.mat);\r\n        if (index < this.rows)\r\n          _zeroTable.replace(tailRange, colRange, tailTable.mat);\r\n      } else {\r\n        _zeroTable = new Table(math.zeros(index + 1, this.cols));\r\n        const rowRange = math.range(0, this.rows);\r\n        _zeroTable.replace(rowRange, colRange, this.mat);\r\n      }\r\n      _zeroTable.replace(index, colRange, arr);\r\n      this._mat = _zeroTable._mat;\r\n    }\r\n  }\r\n\r\n  addScalar(val) {\r\n    if (this._mat === null) return null;\r\n    if (this.type === \"matrix\") {\r\n      this._mat = math.add(this.mat, val);\r\n    } else {\r\n      this._mat += val;\r\n    }\r\n  }\r\n}\r\n","export class DisjointSet {\r\n  constructor(num) {\r\n    this.size = num\r\n    this.fatherSet = []\r\n    for (let i = 0; i < num; i++) {\r\n      this.fatherSet[i] = i\r\n    }\r\n  }\r\n\r\n  findFather(n) {\r\n    if (this.fatherSet[n] !== n) {\r\n      this.fatherSet[n] = this.findFather(this.fatherSet[n])\r\n    }\r\n    return this.fatherSet[n]\r\n  }\r\n\r\n  isInSameSet(n, m) {\r\n    if (this.findFather(n) === this.findFather(m)) return true\r\n    return false\r\n  }\r\n\r\n  union(n, m) {\r\n    this.fatherSet[this.findFather(n)] = this.findFather(m)\r\n  }\r\n\r\n  allElementInSet(n) {\r\n    let ans = []\r\n    for (let i = 0; i < this.size; i++) {\r\n      if (this.isInSameSet(n, i)) ans.push(i)\r\n    }\r\n    return ans\r\n  }\r\n}\r\n","// Render Module\r\nexport const STYLE_LABELS = [\r\n  'Normal',\r\n  'Color',\r\n  'Width',\r\n  'Dash',\r\n  'Zigzag',\r\n  'Wave',\r\n  'Bump',\r\n  'Unmerge',\r\n  'Twine',\r\n  'Merge',\r\n  'Collide',\r\n]\r\nexport const TIME_UNIT = 100\r\nexport const TIME_GAP = 80\r\nexport const INNERGAPS = 10\r\nexport const SCALE_GAP = 5\r\nexport const RENDER_MODE = 'Smooth'\r\n\r\n// GreedyLayout Module\r\nexport const ORDER_TIMES = 10\r\nexport const ALPHA = 0.1 // Alignment power\r\nexport const DISTANCE_IN = 10\r\nexport const DISTANCE_OUT = 10\r\n","import { Table } from '../data/table'\r\nimport { DisjointSet } from '../utils/dataStruct'\r\nimport { ORDER_TIMES } from '../utils/CONSTANTS'\r\n\r\n/**\r\n * @param {Story} story\r\n * @param {Number[][]} constraints\r\n */\r\n\r\nexport function greedySort(story, constraints) {\r\n  const param = getParam(story, constraints)\r\n  const sortTable = runAlgorithms(param)\r\n  story.setTable('sort', sortTable)\r\n}\r\n\r\n/**\r\n * @param {Story} story\r\n * @param {Number[][]} constraints\r\n * @returns {Object}\r\n */\r\nfunction getParam(story, constraints) {\r\n  let storySessionTable = story.getTable('session')\r\n  let height = storySessionTable.rows\r\n  let width = storySessionTable.cols\r\n  let charaterinSession = []\r\n  for (let time = 0; time < width; time++) {\r\n    charaterinSession.push([])\r\n    // Add a timeStamp\r\n    let sessionMap = new Map()\r\n    let sessionHash = 0\r\n    for (let characterID = 0; characterID < height; characterID++) {\r\n      let sessionID = storySessionTable.value(characterID, time)\r\n      if (sessionID !== 0 && !sessionMap.has(sessionID)) {\r\n        sessionMap.set(sessionID, sessionHash)\r\n        sessionHash += 1\r\n        charaterinSession[time].push([characterID])\r\n        // Add a session at this timeStamp\r\n      } else if (sessionID !== 0) {\r\n        charaterinSession[time][sessionMap.get(sessionID)].push(characterID)\r\n      }\r\n    }\r\n  }\r\n  let constantSort = constraints.filter(constraint => {\r\n    return constraint.style === 'Sort'\r\n  })\r\n  let constraintAtAllTime = []\r\n  for (let time = 0; time < width; time++) {\r\n    let constraintAtThisTime = []\r\n    for (let constraint of constantSort) {\r\n      if (time >= constraint.timeSpan[0] && time <= constraint.timeSpan[1]) {\r\n        let names = constraint.names\r\n        constraintAtThisTime.push([\r\n          story.getCharacterID(names[0]),\r\n          story.getCharacterID(names[1]),\r\n        ])\r\n      }\r\n    }\r\n    constraintAtAllTime.push(constraintAtThisTime)\r\n  }\r\n  return {\r\n    charaterinSession,\r\n    height,\r\n    width,\r\n    constraints: constraintAtAllTime,\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * @param {Number[]} order\r\n * @param {Number} height 多少人\r\n * @returns {Number[]}\r\n */\r\nfunction order2mat(order, height) {\r\n  let ans = []\r\n  for (let ID = 0; ID < height; ID++) {\r\n    let orderID = order.indexOf(ID) + 1\r\n    ans.push(orderID) // 0代表不存在\r\n  }\r\n  return ans\r\n}\r\n\r\n/**\r\n * @param {Object} param\r\n * @returns {Table}\r\n */\r\nfunction runAlgorithms(param) {\r\n  let ans = new Table()\r\n  let { height, width, charaterinSession, constraints } = param\r\n  ans.resize(height, width)\r\n  let initOrder = constrainedCrossingReduction(\r\n    charaterinSession[0],\r\n    charaterinSession[0],\r\n    constraints[0]\r\n  )\r\n  let initOrderMat = order2mat(initOrder, height)\r\n  let replaceIndex = []\r\n  for (let i = 0; i < height; i++) replaceIndex.push(i)\r\n  ans.replace(replaceIndex, 0, initOrderMat)\r\n  let lastTimeOrder = initOrder\r\n  for (let ordertime = 0; ordertime < ORDER_TIMES; ordertime++) {\r\n    // Scan from the begin to the end\r\n    for (let time = 1; time < width; time++) {\r\n      let thisTimeOrder = constrainedCrossingReduction(\r\n        charaterinSession[time],\r\n        lastTimeOrder,\r\n        constraints[time]\r\n      )\r\n      let thisTimeOrderMat = order2mat(thisTimeOrder, height)\r\n      ans.replace(replaceIndex, time, thisTimeOrderMat)\r\n      lastTimeOrder = thisTimeOrder\r\n    }\r\n    // Scan from the end to the begin\r\n    for (let time = width - 2; time >= 0; time--) {\r\n      let thisTimeOrder = constrainedCrossingReduction(\r\n        charaterinSession[time],\r\n        lastTimeOrder,\r\n        constraints[time]\r\n      )\r\n      let thisTimeOrderMat = order2mat(thisTimeOrder, height)\r\n      ans.replace(replaceIndex, time, thisTimeOrderMat)\r\n      lastTimeOrder = thisTimeOrder\r\n    }\r\n  }\r\n  return ans\r\n}\r\n\r\n/**\r\n * @param {Number[][]} list1 第一个维度是集合，第二个维度是集合的元素\r\n * @param {Number[]} list2 元素的权重顺序\r\n * @param {Number[][]} constraints  元素的顺序约束\r\n * @return {Number[]} orderList  元素的顺序\r\n * @example\r\n * list1 = [[1,2,3],[5,6,4],[55,63]];\r\n * list2 = [4,63,55,3,5,6,2,1];\r\n * constraints = [[5,1],[1,55],[3,2],[1,3]];\r\n */\r\n\r\nexport function constrainedCrossingReduction(list1, list2, constraints = []) {\r\n  let list1Weight = []\r\n  for (let arr of list1) {\r\n    let sumWeight = 0\r\n    for (let element of arr) {\r\n      sumWeight += getWeight(element, list2)\r\n    }\r\n    list1Weight.push(sumWeight / arr.length)\r\n  }\r\n  let [mapSetArr, setInDegree] = dealSetConstraints(\r\n    list1,\r\n    constraints,\r\n    list1Weight\r\n  )\r\n  let order = topoSort(mapSetArr, setInDegree, list1Weight)\r\n  list1.sort((a, b) => {\r\n    const indexA = list1.indexOf(a)\r\n    const indexB = list1.indexOf(b)\r\n    return order.indexOf(indexA) - order.indexOf(indexB)\r\n  })\r\n  let allElementWeight = []\r\n  let allElement = []\r\n  list1.forEach(set => {\r\n    set.forEach(id => {\r\n      allElement.push(id)\r\n      allElementWeight.push(getWeight(id, list2))\r\n    })\r\n  })\r\n  let [mapElementArr, elementInDegree] = dealElementConstraints(\r\n    list1,\r\n    constraints,\r\n    allElementWeight\r\n  )\r\n  let elementOrder = topoSort(mapElementArr, elementInDegree, allElementWeight)\r\n  for (let arr of list1) {\r\n    arr.sort((a, b) => {\r\n      const indexA = allElement.indexOf(a)\r\n      const indexB = allElement.indexOf(b)\r\n      return elementOrder.indexOf(indexA) - elementOrder.indexOf(indexB)\r\n    })\r\n  }\r\n  let ans = []\r\n  list1.forEach(session => ans.push(...session))\r\n  return ans\r\n}\r\n\r\n/**\r\n * Topological sort functions\r\n */\r\nexport function topoSort(mapSetArr, inDegree, listWeight) {\r\n  let order = []\r\n  for (let i = 0; i < inDegree.length; i++) {\r\n    let minWeight = Number.MAX_SAFE_INTEGER\r\n    let pos = -1\r\n    for (let j = 0; j < inDegree.length; j++) {\r\n      if (inDegree[j] == 0 && listWeight[j] < minWeight) {\r\n        pos = j\r\n        minWeight = listWeight[j]\r\n      }\r\n    }\r\n    order.push(pos)\r\n    inDegree[pos] = -1\r\n    // Add to the order array\r\n    for (let i = 0; i < mapSetArr[pos].length; i++) {\r\n      if (mapSetArr[pos][i] !== undefined) {\r\n        inDegree[i] -= 1\r\n      }\r\n    }\r\n  }\r\n  return order\r\n}\r\n\r\nexport function dealSetConstraints(list, constraints, listWeight) {\r\n  let mapSetArr = []\r\n  // Transform constraint to edges in a graph\r\n  let inDegree = []\r\n  let setArr = new DisjointSet(list.length)\r\n  // Binding sets\r\n  list.forEach(x => {\r\n    mapSetArr.push([])\r\n    inDegree.push(0)\r\n  })\r\n  for (let constraint of constraints) {\r\n    let [first, second] = constraint\r\n    let firstSetId = getSetId(first, list)\r\n    let secondSetId = getSetId(second, list)\r\n    if (firstSetId === -1 || secondSetId === -1) continue\r\n    if (firstSetId !== secondSetId) {\r\n      setArr.union(firstSetId, secondSetId)\r\n      let sumWeight = 0\r\n      let allElement = setArr.allElementInSet(firstSetId)\r\n      allElement.forEach(id => (sumWeight += listWeight[id]))\r\n      for (let i = 0; i < allElement.length; i++) {\r\n        listWeight[allElement[i]] = sumWeight / allElement.length\r\n      }\r\n      mapSetArr[firstSetId][secondSetId] = 1\r\n      inDegree[secondSetId] += 1\r\n    }\r\n  }\r\n  return [mapSetArr, inDegree]\r\n}\r\n\r\nexport function getWeight(id, list2) {\r\n  if (list2.indexOf(id) === -1) return 0\r\n  return list2.indexOf(id)\r\n}\r\n\r\nexport function getSetId(element, setArr) {\r\n  for (let set of setArr) {\r\n    if (set.indexOf(element) !== -1) {\r\n      return setArr.indexOf(set)\r\n    }\r\n  }\r\n  // console.error(\"Can't find this element in any set!\")\r\n  return -1\r\n}\r\n\r\nexport function dealElementConstraints(list, constraints, listWeight) {\r\n  let listAllElement = []\r\n  list.forEach(x => {\r\n    listAllElement = [...listAllElement, ...x]\r\n  })\r\n  let mapElementArr = []\r\n  let inDegree = []\r\n  let setArr = new DisjointSet(listAllElement.length)\r\n\r\n  listAllElement.forEach(x => {\r\n    mapElementArr.push([])\r\n    inDegree.push(0)\r\n  })\r\n  for (let constraint of constraints) {\r\n    let [first, second] = constraint\r\n    let firstSetId = getSetId(first, list)\r\n    let secondSetId = getSetId(second, list)\r\n    if (firstSetId === secondSetId && firstSetId !== -1) {\r\n      setArr.union(\r\n        listAllElement.indexOf(first),\r\n        listAllElement.indexOf(second)\r\n      )\r\n      let allElement = setArr.allElementInSet(listAllElement.indexOf(first))\r\n      let sumWeight = 0\r\n      allElement.forEach(id => (sumWeight += listWeight[id]))\r\n      for (let i = 0; i < allElement.length; i++) {\r\n        listWeight[allElement[i]] = sumWeight / allElement.length\r\n      }\r\n      mapElementArr[listAllElement.indexOf(first)][\r\n        listAllElement.indexOf(second)\r\n      ] = 1\r\n      inDegree[listAllElement.indexOf(second)] += 1\r\n    }\r\n  }\r\n  return [mapElementArr, inDegree]\r\n}\r\n","import { Table } from '../data/table'\r\nimport { ALPHA } from '../utils/CONSTANTS'\r\n\r\n/**\r\n * @param {Story} story\r\n * @param {constraints} Object\r\n */\r\nexport function greedyAlign(story, constraints) {\r\n  const param = getParam(story, constraints)\r\n  const alignTable = runAlgorithms(param)\r\n  story.setTable('align', alignTable)\r\n}\r\n\r\nfunction getParam(story, constraints) {\r\n  let sortTable = story.getTable('sort')\r\n  let chaTable = story.getTable('character')\r\n  let sessionTable = story.getTable('session')\r\n  let height = sortTable.rows\r\n  let width = sortTable.cols\r\n  let characterIdInOrder = []\r\n  // debugger\r\n  let constraintsAlign = constraints.filter(constraint => {\r\n    return constraint.style === 'Straighten'\r\n  })\r\n  let constraintsBend = constraints.filter(\r\n    constraint => constraint.style == 'Bend'\r\n  )\r\n  for (let time = 0; time < width; time++) {\r\n    let num = []\r\n    for (let id = 0; id < height; id++) {\r\n      if (sortTable.value(id, time) !== 0) num.push(id)\r\n    }\r\n    num.sort((a, b) => {\r\n      return sortTable.value(a, time) - sortTable.value(b, time)\r\n    })\r\n    characterIdInOrder.push(num)\r\n  }\r\n  let rewardArr = []\r\n  for (let time = 0; time < width - 1; time++) {\r\n    let reward = []\r\n    for (let cha = 0; cha < characterIdInOrder[time].length; cha++) {\r\n      let rewardInEachCha = []\r\n      for (\r\n        let chaInNextTime = 0;\r\n        chaInNextTime < characterIdInOrder[time + 1].length;\r\n        chaInNextTime++\r\n      ) {\r\n        const id1 = characterIdInOrder[time][cha]\r\n        const id2 = characterIdInOrder[time + 1][chaInNextTime]\r\n        let isConstraint = 0\r\n        for (let constraint of constraintsAlign) {\r\n          if (\r\n            story.getCharacterID(constraint.names[0]) === id1 &&\r\n            story.getCharacterID(constraint.names[0]) === id2 &&\r\n            constraint.timeSpan[0] <= time &&\r\n            constraint.timeSpan[1] >= time\r\n          )\r\n            isConstraint = 1\r\n        }\r\n        for (let constraint of constraintsBend) {\r\n          if (\r\n            story.getCharacterID(constraint.names[0]) === id1 &&\r\n            story.getCharacterID(constraint.names[0]) === id2 &&\r\n            constraint.timeSpan[0] <= time &&\r\n            constraint.timeSpan[1] >= time\r\n          )\r\n            isConstraint = 2\r\n        }\r\n        if (isConstraint == 1) rewardInEachCha.push(Number.MAX_SAFE_INTEGER)\r\n        else if (isConstraint == 2)\r\n          rewardInEachCha.push(-Number.MAX_SAFE_INTEGER)\r\n        else\r\n          rewardInEachCha.push(\r\n            solveReward(id1, id2, time, sessionTable, sortTable)\r\n          )\r\n      }\r\n      reward.push(rewardInEachCha)\r\n    }\r\n    rewardArr.push(reward)\r\n  }\r\n  return {\r\n    characterIdInOrder,\r\n    rewardArr,\r\n    width,\r\n    height,\r\n    chaTable,\r\n  }\r\n}\r\n\r\nfunction runAlgorithms(param) {\r\n  let ans = new Table(-1)\r\n  let { height, width, rewardArr, characterIdInOrder } = param\r\n  ans.resize(height, width, -1)\r\n  for (let time = 0; time < width - 1; time++) {\r\n    let alignAns\r\n    alignAns = longestCommonSubstring(\r\n      characterIdInOrder[time].length,\r\n      characterIdInOrder[time + 1].length,\r\n      rewardArr[time]\r\n    )\r\n    for (let idOrder = 0; idOrder < alignAns.length; idOrder++) {\r\n      let alignId = alignAns[idOrder]\r\n      if (alignAns[idOrder] === undefined) alignId = -1\r\n      else alignId = characterIdInOrder[time + 1][alignId]\r\n\r\n      ans.replace(characterIdInOrder[time][idOrder], time, alignId)\r\n    }\r\n  }\r\n  // double check\r\n  // for (let chaId=0;chaId<height;chaId++)\r\n  //   for (let time=0;time<width;time++)\r\n  //     if (chaTable.value(chaId,time)===0) ans.replace(chaId,time,-1)\r\n  // console.log(ans);\r\n  return ans\r\n}\r\n\r\n/**\r\n * Calculate dynamic programming rewards\r\n * @param {Number} id1 first character ID\r\n * @param {Number} id2 second character ID\r\n * @param {Number} time first time\r\n * @param {Table} sessionTable sessionTable\r\n * @param {Table} sortTable sortTable\r\n * @returns {Number} reward\r\n */\r\nfunction solveReward(id1, id2, time, sessionTable, sortTable) {\r\n  let reward = 0\r\n  let sessionId1 = sessionTable.value(id1, time)\r\n  let sessionId2 = sessionTable.value(id2, time + 1)\r\n  let session1 = findChaInSessionAtTime(\r\n    sessionId1,\r\n    time,\r\n    sessionTable,\r\n    sortTable\r\n  )\r\n  let session2 = findChaInSessionAtTime(\r\n    sessionId2,\r\n    time + 1,\r\n    sessionTable,\r\n    sortTable\r\n  )\r\n  for (let chaId of session1) {\r\n    if (session2.indexOf(chaId) !== -1) reward += 1\r\n  }\r\n  reward +=\r\n    ALPHA *\r\n    (1 -\r\n      Math.abs(\r\n        session1.indexOf(id1) / session1.length -\r\n          session2.indexOf(id2) / session2.length\r\n      ))\r\n  return reward\r\n}\r\n\r\nfunction findChaInSessionAtTime(sessionId, time, sessionTable, sortTable) {\r\n  let ans = []\r\n  let height = sessionTable.rows\r\n  for (let id = 0; id < height; id++)\r\n    if (sessionTable.value(id, time) === sessionId) ans.push(id)\r\n  ans.sort((a, b) => {\r\n    return sortTable.value(a, time) - sortTable.value(b, time)\r\n  })\r\n  return ans\r\n}\r\n\r\n/**\r\n * Calculate LCS from two sequences\r\n * @param {Number[]} list1\r\n * @param {Number[]} list2\r\n * @param {Number[][]} reward\r\n * @return {Number[]} longestCommonSubstring  list1中元素对齐的是第几个list2中元素\r\n * @example\r\n * let list1Length=4;\r\n * let list2Length=3\r\n * let reward=[[1,1,1],[1,1,1],[1,1,1],[1,1,1]]\r\n */\r\n\r\nexport function longestCommonSubstring(list1Length, list2Length, reward) {\r\n  let totalReward = []\r\n  let direction = []\r\n  reward.forEach(row => {\r\n    totalReward.push([])\r\n    direction.push([])\r\n  })\r\n  // Init\r\n  for (let i = 0; i < list1Length; i++) {\r\n    reward[i][-1] = 0\r\n  }\r\n  reward[-1] = []\r\n  totalReward[-1] = []\r\n  for (let j = 0; j < list2Length; j++) {\r\n    reward[-1][j] = 0\r\n  }\r\n  for (let i = -1; i < list1Length; i++)\r\n    for (let j = -1; j < list2Length; j++) {\r\n      totalReward[i][j] = 0\r\n    }\r\n  // Transition functions\r\n  for (let i = 0; i < list1Length; i++) {\r\n    for (let j = 0; j < list2Length; j++) {\r\n      // Boundary conditions\r\n      let valueList = [\r\n        totalReward[i - 1][j],\r\n        totalReward[i][j - 1],\r\n        totalReward[i - 1][j - 1] + reward[i][j],\r\n      ] // 0:left, 1:right, 2:align\r\n      let maxListArg = maxArg(valueList)\r\n      direction[i][j] = maxListArg\r\n      totalReward[i][j] = valueList[maxListArg]\r\n    }\r\n  }\r\n  let alignList = []\r\n  let leftHead = list1Length - 1\r\n  let rightHead = list2Length - 1\r\n  while (rightHead >= 0 && leftHead >= 0) {\r\n    if (direction[leftHead][rightHead] == 2) {\r\n      alignList[leftHead] = rightHead\r\n      leftHead -= 1\r\n      rightHead -= 1\r\n    } else if (direction[leftHead][rightHead] == 1) {\r\n      rightHead -= 1\r\n    } else if (direction[leftHead][rightHead] == 0) {\r\n      leftHead -= 1\r\n    } else {\r\n      break\r\n    }\r\n  }\r\n  return alignList\r\n}\r\n\r\nfunction maxArg(list) {\r\n  let ans = -1\r\n  let maxValue = Number.MIN_SAFE_INTEGER\r\n  for (let i = 0; i < list.length; i++) {\r\n    if (list[i] > maxValue) {\r\n      maxValue = list[i]\r\n      ans = i\r\n    }\r\n  }\r\n  return ans\r\n}\r\n","import { Table } from '../data/table'\r\nimport { DISTANCE_IN, DISTANCE_OUT } from '../utils/CONSTANTS'\r\n\r\nexport function greedySlotCompact(story, constraints) {\r\n  const param = getParam(story, constraints)\r\n  const layoutTable = runAlgorithms(param)\r\n  story.setTable('layout', layoutTable)\r\n}\r\n\r\nfunction getParam(story, constraints) {\r\n  let alignTable = story.getTable('align')\r\n  let sessionTable = story.getTable('session')\r\n  let sortTable = story.getTable('sort')\r\n  let height = sessionTable.rows\r\n  let width = sessionTable.cols\r\n  let characterIdInOrder = []\r\n\r\n  let sessionInOrder = []\r\n  let sessionAlignMaps = []\r\n  for (let time = 0; time < width; time++) {\r\n    let num = []\r\n    for (let id = 0; id < height; id++) {\r\n      if (sortTable.value(id, time) !== 0) num.push(id)\r\n    }\r\n    num.sort((a, b) => {\r\n      return sortTable.value(a, time) - sortTable.value(b, time)\r\n    })\r\n    characterIdInOrder.push(num)\r\n    let sessionInOrderSet = new Set()\r\n    for (let cha of num) sessionInOrderSet.add(sessionTable.value(cha, time))\r\n    sessionInOrder.push(Array.from(sessionInOrderSet))\r\n    if (time == width - 1) continue // next, we deal with align\r\n    let sessionAlignMap = new Map()\r\n    let beAlignedSession = new Map() //sessionId 2 size, however don't use size now\r\n    for (let characterId of num) {\r\n      //num:characterIdInOrderInThisTime\r\n      const sessionId = sessionTable.value(characterId, time)\r\n      const alignCharacterId = alignTable.value(characterId, time)\r\n      let alignSessionId = -1\r\n      if (alignCharacterId !== -1)\r\n        alignSessionId = sessionTable.value(alignCharacterId, time + 1)\r\n      if (alignSessionId === 0) alignSessionId = -1\r\n      //bug\r\n\r\n      if (\r\n        !sessionAlignMap.has(sessionId) ||\r\n        sessionAlignMap.get(sessionId) === -1\r\n      ) {\r\n        if (beAlignedSession.has(alignSessionId)) alignSessionId = -1\r\n        sessionAlignMap.set(sessionId, alignSessionId)\r\n        beAlignedSession.set(alignSessionId, true)\r\n      }\r\n    }\r\n    sessionAlignMaps.push(sessionAlignMap)\r\n  }\r\n\r\n  let constraintsCompress = constraints.filter(\r\n    constraint => constraint.style == 'Compress'\r\n  )\r\n\r\n  let constraintsExpand = constraints.filter(\r\n    constraint => constraint.style == 'Expand'\r\n  )\r\n\r\n  return {\r\n    story,\r\n    alignTable,\r\n    sessionTable,\r\n    sortTable,\r\n    height,\r\n    width,\r\n    characterIdInOrder,\r\n    sessionAlignMaps,\r\n    sessionInOrder,\r\n    constraintsExpand,\r\n    constraintsCompress,\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Number[][]} characterIdInOrder\r\n * @param {Table} sessionTable\r\n * @param {Number} time\r\n * @param {Number} sessionId\r\n * @returns {Number[]}\r\n */\r\nfunction sessionId2CharactersInOrder(\r\n  characterIdInOrder,\r\n  sessionTable,\r\n  time,\r\n  sessionId\r\n) {\r\n  let characterIdInOrderInThisTime = characterIdInOrder[time]\r\n  let ans = []\r\n  for (let characterId of characterIdInOrderInThisTime) {\r\n    if (sessionTable.value(characterId, time) === sessionId)\r\n      ans.push(characterId)\r\n  }\r\n  return ans\r\n}\r\n\r\nfunction calculateSlotHeight(slots, slotId, characterIdInOrder, sessionTable) {\r\n  let sum = 0\r\n  for (let i = 0; i < slotId; i++) {\r\n    let slot = slots[i]\r\n    let maxCharacterNum = 0\r\n    for (let time = 0; time < slot.length; time++) {\r\n      let characters = sessionId2CharactersInOrder(\r\n        characterIdInOrder,\r\n        sessionTable,\r\n        time,\r\n        slot[time]\r\n      )\r\n      maxCharacterNum = Math.max(maxCharacterNum, characters.length)\r\n    }\r\n    sum += (maxCharacterNum - 1) * DISTANCE_IN + DISTANCE_OUT\r\n  }\r\n  return sum\r\n}\r\n\r\nfunction insert2Array(pos, array, element) {\r\n  //splice没有insert2Array的意思直接\r\n  array.splice(pos, 0, element)\r\n}\r\n\r\nfunction sessionIdTime2SlotId(slots, sessionId, time) {\r\n  for (let i = 0; i < slots.length; i++) {\r\n    if (slots[i][time] === sessionId) return i\r\n  }\r\n  return -1\r\n}\r\n\r\nfunction runAlgorithms(param) {\r\n  let {\r\n    story,\r\n    sessionTable,\r\n    alignTable,\r\n    height,\r\n    width,\r\n    characterIdInOrder,\r\n    sessionInOrder,\r\n    sessionAlignMaps,\r\n    constraintsExpand,\r\n    constraintsCompress,\r\n  } = param\r\n  let ans = new Table()\r\n  ans.resize(height, width, -1)\r\n  let slots = []\r\n  sessionInOrder[0].forEach(sessionId => {\r\n    slots.push([sessionId])\r\n  })\r\n  // Init slots\r\n  // Insert session to slot\r\n  for (let time = 1; time < width; time++) {\r\n    let sessionIdHasDealedMap = new Map()\r\n    for (let slotId = 0; slotId < slots.length; slotId++) {\r\n      let slot = slots[slotId]\r\n      const lastTimeSessionId = slot[time - 1]\r\n      if (!sessionAlignMaps[time - 1].has(lastTimeSessionId)) {\r\n        slot.push(-1)\r\n        continue\r\n      }\r\n      const thisTimeSessionId = sessionAlignMaps[time - 1].get(\r\n        lastTimeSessionId\r\n      )\r\n      // if (thisTimeSessionId===0) debugger\r\n      slot.push(thisTimeSessionId)\r\n      sessionIdHasDealedMap.set(thisTimeSessionId, slotId)\r\n    }\r\n    //deal with new session\r\n    let sessionIds = sessionInOrder[time]\r\n    //is the first session aligned?\r\n    if (!sessionIdHasDealedMap.has(sessionIds[0])) {\r\n      let slot = new Array(time).fill(-1) //0-time-1\r\n      slot.push(sessionIds[0])\r\n      insert2Array(0, slots, slot)\r\n      sessionIdHasDealedMap.set(sessionIds[0], 0)\r\n    }\r\n    for (\r\n      let sessionIdNum = 1;\r\n      sessionIdNum < sessionIds.length;\r\n      sessionIdNum++\r\n    ) {\r\n      const sessionId = sessionIds[sessionIdNum]\r\n      if (sessionIdHasDealedMap.has(sessionId)) continue\r\n      //get last slot ID\r\n      const lastSessionId = sessionIds[sessionIdNum - 1]\r\n      const lastSlotId = sessionIdTime2SlotId(slots, lastSessionId, time)\r\n      let slot = new Array(time).fill(-1) //0-time-1\r\n      slot.push(sessionId)\r\n      insert2Array(lastSlotId + 1, slots, slot)\r\n    }\r\n  }\r\n  let slotsOfCharacter = new Array(slots.length)\r\n  for (let i = 0; i < slotsOfCharacter.length; i++) slotsOfCharacter[i] = []\r\n  for (let slotsId = 0; slotsId < slots.length; slotsId++)\r\n    for (let time = 0; time < width; time++) {\r\n      if (slots[slotsId][time] === -1) continue\r\n      slotsOfCharacter[slotsId][time] = sessionId2CharactersInOrder(\r\n        characterIdInOrder,\r\n        sessionTable,\r\n        time,\r\n        slots[slotsId][time]\r\n      )\r\n    }\r\n  for (let slotsId = 0; slotsId < slots.length; slotsId++)\r\n    for (let time = 0; time < width - 1; time++) {\r\n      if (slots[slotsId][time] === -1) continue\r\n      let thisSlot = slotsOfCharacter[slotsId][time]\r\n      let nextSlot = slotsOfCharacter[slotsId][time + 1]\r\n      if (nextSlot === undefined) continue\r\n      let firstAlignCharacterNum = -1\r\n      let alignCharacterNumInNextTime = -1\r\n      for (\r\n        let firstAlignCharacter = 0;\r\n        firstAlignCharacter < thisSlot.length;\r\n        firstAlignCharacter++\r\n      ) {\r\n        let Id = thisSlot[firstAlignCharacter]\r\n        if (Id === -1) continue\r\n        let alignCharacterId = alignTable.value(Id, time)\r\n        if (nextSlot.indexOf(alignCharacterId) !== -1) {\r\n          firstAlignCharacterNum = firstAlignCharacter\r\n          alignCharacterNumInNextTime = nextSlot.indexOf(alignCharacterId)\r\n          break\r\n        }\r\n      }\r\n      if (firstAlignCharacterNum === -1) continue\r\n      //在前面所有的加-1，在后面这个加-1\r\n      if (firstAlignCharacterNum > alignCharacterNumInNextTime) {\r\n        let loss = firstAlignCharacterNum - alignCharacterNumInNextTime\r\n        for (; loss > 0; loss--) nextSlot.unshift(-1)\r\n      }\r\n      if (firstAlignCharacterNum < alignCharacterNumInNextTime) {\r\n        let loss = alignCharacterNumInNextTime - firstAlignCharacterNum\r\n        for (let lastTime = 0; lastTime <= time; lastTime++) {\r\n          for (let lossnum = 0; lossnum < loss; lossnum++) {\r\n            if (slotsOfCharacter[slotsId][lastTime] !== undefined)\r\n              slotsOfCharacter[slotsId][lastTime].unshift(-1)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  let baseHeightArray = new Array(slots.length)\r\n  for (\r\n    let slotsOfCharacterId = 0;\r\n    slotsOfCharacterId < slotsOfCharacter.length;\r\n    slotsOfCharacterId++\r\n  )\r\n    for (let time = 0; time < width; time++) {\r\n      if (!baseHeightArray[slotsOfCharacterId])\r\n        baseHeightArray[slotsOfCharacterId] = calculateSlotHeight(\r\n          slots,\r\n          slotsOfCharacterId,\r\n          characterIdInOrder,\r\n          sessionTable\r\n        )\r\n      let baseHeight = baseHeightArray[slotsOfCharacterId]\r\n      let charactersInThisSlot = slotsOfCharacter[slotsOfCharacterId][time]\r\n      if (!charactersInThisSlot) continue\r\n      for (\r\n        let characterI = 0;\r\n        characterI < charactersInThisSlot.length;\r\n        characterI++\r\n      ) {\r\n        const characterId = charactersInThisSlot[characterI]\r\n        if (characterId === -1) continue\r\n        let scale = 1\r\n        let idNum = 0\r\n        let isCompress = false\r\n        let isExpand = false\r\n        if (constraintsCompress && constraintsCompress.length > 0)\r\n          isCompress = constraintsCompress.some(constraint => {\r\n            idNum = constraint.names.indexOf(\r\n              story.getCharacterName(characterId)\r\n            )\r\n            if (\r\n              idNum !== -1 &&\r\n              constraint.timeSpan[0] <= time &&\r\n              constraint.timeSpan[1] >= time\r\n            ) {\r\n              scale = constraint.param.scale\r\n              return true\r\n            }\r\n            return false\r\n          })\r\n        if (constraintsExpand && constraintsExpand.length > 0)\r\n          isExpand = constraintsExpand.some(constraint => {\r\n            idNum = constraint.names.indexOf(\r\n              story.getCharacterName(characterId)\r\n            )\r\n            if (\r\n              idNum !== -1 &&\r\n              constraint.timeSpan[0] <= time &&\r\n              constraint.timeSpan[1] >= time\r\n            ) {\r\n              scale = constraint.param.scale\r\n              return true\r\n            }\r\n            return false\r\n          })\r\n        let Height = baseHeight + characterI * DISTANCE_IN\r\n        if (isExpand) Height += idNum * DISTANCE_IN * (scale - 1)\r\n        else if (isCompress) Height -= idNum * DISTANCE_IN * (1 - scale)\r\n\r\n        ans.replace(characterId, time, Height)\r\n      }\r\n    }\r\n  // debugger\r\n\r\n  // for (let time = 0; time < width; time++) {\r\n  //   for (let id = 0; id < height; id++) {\r\n  //     if (sortTable.value(id, time) !== 0)\r\n  //       ans.replace(id, time, sortTable.value(id, time) * DISTANCE_OUT)\r\n  //   }\r\n  // }\r\n  //console.log(ans)\r\n  return ans\r\n}\r\n","import { Table } from '../data/table'\r\nimport { STYLE_LABELS } from '../utils/CONSTANTS'\r\nexport class StyleConfiger {\r\n  constructor(story, constraints) {\r\n    const { style, styleFlag, moveMark, styleY } = this.genStyle(\r\n      story,\r\n      constraints\r\n    )\r\n    this._style = style\r\n    this._styleFlag = styleFlag //0 for even 1 for odd\r\n    this._moveMark = moveMark\r\n    this._styleY = styleY\r\n  }\r\n  get style() {\r\n    return this._style\r\n  }\r\n  get styleFlag() {\r\n    return this._styleFlag\r\n  }\r\n  get moveMark() {\r\n    return this._moveMark\r\n  }\r\n  get styleY() {\r\n    return this._styleY\r\n  }\r\n  genStyle(story, oConstraints) {\r\n    const constraints = this.ctrsFilter(oConstraints)\r\n    const tstyle = this.newArray(story.getTableRows(), story.getTableCols())\r\n    const tstyleFlag = this.newArray(story.getTableRows(), story.getTableCols())\r\n    const tmoveMark = this.newArray(story.getTableRows(), story.getTableCols())\r\n    const tstyleY = this.newArray(story.getTableRows(), story.getTableCols())\r\n    constraints.forEach(ctr => {\r\n      this._changeStyle(ctr, story, tstyle, tmoveMark)\r\n      this._changeStyleY(ctr, story, tstyleFlag, tstyleY)\r\n    })\r\n    const style = new Table(tstyle)\r\n    const styleFlag = tstyleFlag,\r\n      moveMark = tmoveMark,\r\n      styleY = tstyleY\r\n    return { style, styleFlag, moveMark, styleY }\r\n  }\r\n  ctrsFilter(octrs) {\r\n    let tctrs = []\r\n    octrs.forEach(ctr => {\r\n      for (let i = 0; i < STYLE_LABELS.length; i++) {\r\n        if (STYLE_LABELS[i] === ctr.style) {\r\n          tctrs.push(ctr)\r\n          break\r\n        }\r\n      }\r\n    })\r\n    return tctrs\r\n  }\r\n  getStyleId(styleName) {\r\n    for (let i = 0; i < STYLE_LABELS.length; i++) {\r\n      if (styleName === STYLE_LABELS[i]) return i\r\n    }\r\n    return 0\r\n  }\r\n  newArray(n, m) {\r\n    let ret = []\r\n    for (let i = 0; i < n; i++) {\r\n      ret[i] = []\r\n      for (let j = 0; j < m; j++) ret[i][j] = 0\r\n    }\r\n    return ret\r\n  }\r\n  _changeStyle(ctr, story, style, moveMark) {\r\n    const timesteps = story.getTimeSteps([ctr.timeSpan])\r\n    ctr.names.forEach(name => {\r\n      const id = story.getCharacterID(name)\r\n      for (let i = 0; i < timesteps.length; i++) {\r\n        const timestep = timesteps[i]\r\n        style[id][timestep] = this.getStyleId(ctr.style)\r\n        moveMark[id][timestep] = 0\r\n        if (style[id][timestep] >= this.getStyleId('Twine')) {\r\n          if (i === 0) moveMark[id][timestep] |= 1\r\n          if (i === timesteps.length - 1) moveMark[id][timestep] |= 2\r\n          if (!moveMark[id][timestep]) moveMark[id][timestep] = 4\r\n        }\r\n      }\r\n    })\r\n  }\r\n  _changeStyleY(ctr, story, styleFlag, styleY) {\r\n    const timesteps = story.getTimeSteps([ctr.timeSpan])\r\n    if (timesteps.length <= 0) return\r\n    const layout = story.getTable('layout')\r\n    let avgY = 0,\r\n      tot = 0\r\n    ctr.names.forEach(name => {\r\n      const id = story.getCharacterID(name)\r\n      avgY += layout.value(id, timesteps[0])\r\n      tot += 1\r\n    })\r\n    if (tot > 0) {\r\n      avgY /= tot\r\n      ctr.names.forEach(name => {\r\n        const id = story.getCharacterID(name)\r\n        const y = layout.value(id, timesteps[0])\r\n        timesteps.forEach(timestep => {\r\n          styleFlag[id][timestep] = y > avgY ? 1 : 0\r\n          styleY[id][timestep] = avgY\r\n        })\r\n      })\r\n    }\r\n  }\r\n}\r\n","import { TIME_UNIT, TIME_GAP, INNERGAPS, SCALE_GAP } from '../utils/CONSTANTS'\r\n\r\nexport class LayoutRelaxer {\r\n  constructor(story, constraints) {\r\n    const { origX, renderX } = this.layoutRelax(story, constraints)\r\n    this._origX = origX\r\n    this._renderX = renderX\r\n  }\r\n  get origX() {\r\n    return this._origX\r\n  }\r\n  get renderX() {\r\n    return this._renderX\r\n  }\r\n  time2origX(timeStamp, startOrEnd) {\r\n    return timeStamp * TIME_UNIT - startOrEnd * TIME_GAP\r\n  }\r\n  origX2time(origX, startOrEnd) {\r\n    return (origX + startOrEnd * TIME_GAP) / TIME_UNIT\r\n  }\r\n  layoutRelax(story) {\r\n    const timeline = story.timeline\r\n    const character = story.getTable('character')\r\n    const layout = story.getTable('layout')\r\n    let originX = this.newArray(story.getTableRows(), story.getTableCols())\r\n    for (let i = 0, len = story.getTableRows(); i < len; i++) {\r\n      for (let j = 0, len = story.getTableCols(); j < len; j++) {\r\n        originX[i][j] = []\r\n        if (character.value(i, j) === 0 || layout.value(i, j) < 0) {\r\n          originX[i][j] = [-1, -1]\r\n        } else {\r\n          originX[i][j][0] = this.time2origX(timeline[j], 0)\r\n          originX[i][j][1] = this.time2origX(timeline[j + 1], 1)\r\n        }\r\n      }\r\n    }\r\n    const origX = originX\r\n    const renderX = this._getRenderX(originX, story)\r\n    return { origX, renderX }\r\n  }\r\n  _getRenderX(originX, story) {\r\n    const layout = story.getTable('layout')\r\n    const character = story.getTable('character')\r\n\r\n    let renderX = []\r\n    for (let i = 0, n = story.getTableRows(); i < n; i++) {\r\n      renderX[i] = []\r\n      for (let j = 0, m = story.getTableCols(); j < m; j++)\r\n        renderX[i][j] = [-1, -1]\r\n    }\r\n    for (let j = 0, m = story.getTableCols(); j < m; j++) {\r\n      let oriY = []\r\n      for (let i = 0, n = story.getTableRows(); i < n; i++) {\r\n        if (character.value(i, j) === 1 && layout.value(i, j) >= 0)\r\n          oriY.push({\r\n            y: layout.value(i, j),\r\n            ny:\r\n              j === m - 1 ||\r\n              !character.value(i, j + 1) ||\r\n              layout.value(i, j + 1) < 0\r\n                ? -1\r\n                : layout.value(i, j + 1),\r\n            py:\r\n              j === 0 ||\r\n              !character.value(i, j - 1) ||\r\n              layout.value(i, j - 1) < 0\r\n                ? -1\r\n                : layout.value(i, j - 1),\r\n            id: i,\r\n          })\r\n      }\r\n      oriY.sort((a, b) => {\r\n        return a.y - b.y\r\n      })\r\n      let flag = []\r\n      for (let i = 0; i < oriY.length; i++) {\r\n        flag[i] = []\r\n        flag[i][0] =\r\n          oriY[i].y === oriY[i].py || oriY[i].py === -1\r\n            ? 0\r\n            : oriY[i].y > oriY[i].py\r\n            ? 1\r\n            : 2\r\n        flag[i][1] =\r\n          oriY[i].y === oriY[i].ny || oriY[i].ny === -1\r\n            ? 0\r\n            : oriY[i].y > oriY[i].ny\r\n            ? 1\r\n            : 2\r\n      }\r\n      for (let z = 0; z < 2; z++) {\r\n        let st = 0,\r\n          ed = 0\r\n        while (st < oriY.length) {\r\n          while (\r\n            ed < oriY.length - 1 &&\r\n            flag[ed + 1][z] === flag[st][z] &&\r\n            oriY[ed + 1] - oriY[ed] <= INNERGAPS\r\n          )\r\n            ed++\r\n          for (let k = st; k <= ed; k++) {\r\n            if (flag[k][z] === 0)\r\n              renderX[oriY[k].id][j][z] = originX[oriY[k].id][j][z]\r\n            else if (flag[k][z] === 1)\r\n              renderX[oriY[k].id][j][z] =\r\n                originX[oriY[k].id][j][z] + (z ? 1 : -1) * (k - st) * SCALE_GAP\r\n            else\r\n              renderX[oriY[k].id][j][z] =\r\n                originX[oriY[k].id][j][z] + (z ? 1 : -1) * (ed - k) * SCALE_GAP\r\n          }\r\n          st = ed + 1\r\n          ed++\r\n        }\r\n      }\r\n    }\r\n    return renderX\r\n  }\r\n  newArray(n, m) {\r\n    let ret = []\r\n    for (let i = 0; i < n; i++) {\r\n      ret[i] = []\r\n      for (let j = 0; j < m; j++) ret[i][j] = 0\r\n    }\r\n    return ret\r\n  }\r\n}\r\n","import { StyleConfiger } from './styleConfiger'\r\nimport { LayoutRelaxer } from './layoutRelaxer'\r\nimport { Table } from '../data/table'\r\nimport { STYLE_LABELS, RENDER_MODE } from '../utils/CONSTANTS'\r\nexport class PathSmoother {\r\n  constructor(story, constraints) {\r\n    this.styleConfiger = new StyleConfiger(story, constraints)\r\n    this.layoutRelaxer = new LayoutRelaxer(story, constraints)\r\n  }\r\n  genStyle(story, constraints) {\r\n    return this.styleConfiger.style\r\n  }\r\n  genPosition(story) {\r\n    const layout = story.getTable('layout')\r\n    const charater = story.getTable('character')\r\n    const { style, styleFlag, moveMark, styleY } = this.styleConfiger\r\n    const renderX = this.layoutRelaxer.renderX\r\n    let pos = [],\r\n      tpos = []\r\n    for (let i = 0, n = story.getTableRows(); i < n; i++) {\r\n      pos[i] = []\r\n      tpos[i] = []\r\n      for (let j = 0, m = story.getTableCols(); j < m; j++) {\r\n        pos[i][j] = []\r\n        tpos[i][j] = 0\r\n      }\r\n    }\r\n    for (let i = 0, n = story.getTableRows(); i < n; i++) {\r\n      let curFlags = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\n      for (let j = 0, m = story.getTableCols(); j < m; j++) {\r\n        if (!charater.value(i, j) || layout.value(i, j) < 0) continue\r\n        const { lineNodes, curFlag } = this.linkLine(\r\n          [\r\n            [\r\n              renderX[i][j][0],\r\n              moveMark[i][j] ? styleY[i][j] : layout.value(i, j),\r\n            ],\r\n            [\r\n              renderX[i][j][1],\r\n              moveMark[i][j] ? styleY[i][j] : layout.value(i, j),\r\n            ],\r\n          ],\r\n          (curFlags[style.value(i, j)] & 1) ^ //curnum odd or even\r\n            (moveMark[i][j] ? styleFlag[i][j] & 1 : 1) //curflag odd or even\r\n            ? 1\r\n            : -1,\r\n          style.value(i, j)\r\n        )\r\n        curFlags[style.value(i, j)] += curFlag\r\n        for (let z = 0; z < lineNodes.length; z++)\r\n          pos[i][j].push([lineNodes[z][0], lineNodes[z][1]])\r\n        if (j < m - 1) {\r\n          if (!charater.value(i, j + 1)) continue\r\n          const { gapANodes, gapBNodes } = this.linkGap(\r\n            [\r\n              [\r\n                renderX[i][j][1],\r\n                moveMark[i][j] ? styleY[i][j] : layout.value(i, j),\r\n              ],\r\n              [\r\n                renderX[i][j + 1][0],\r\n                moveMark[i][j + 1] ? styleY[i][j + 1] : layout.value(i, j + 1),\r\n              ],\r\n            ],\r\n            [style.value(i, j), style.value(i, j + 1)],\r\n            [\r\n              (curFlags[style.value(i, j)] & 1) ^\r\n              (moveMark[i][j] ? styleFlag[i][j] & 1 : 1)\r\n                ? 1\r\n                : -1,\r\n              (curFlags[style.value(i, j + 1)] & 1) ^\r\n              (moveMark[i][j + 1] ? styleFlag[i][j + 1] & 1 : 1)\r\n                ? 1\r\n                : -1,\r\n            ],\r\n            curFlags\r\n          )\r\n          for (let k = 1; k < gapANodes.length; k++)\r\n            pos[i][j].push([gapANodes[k][0], gapANodes[k][1]])\r\n          for (let k = 0; k < gapBNodes.length - 1; k++)\r\n            pos[i][j + 1].push([gapBNodes[k][0], gapBNodes[k][1]])\r\n        }\r\n      }\r\n    }\r\n    story.cleanPositions()\r\n    for (let i = 0; i < pos.length; i++) {\r\n      for (let j = 0; j < pos[i].length; j++) {\r\n        if (charater.value(i, j)) tpos[i][j] = story.addPosition(pos[i][j])\r\n      }\r\n    }\r\n    const position = new Table(tpos)\r\n    return position\r\n  }\r\n  linkLine(nodes, flag, styleId) {\r\n    if (STYLE_LABELS[styleId] === 'Zigzag')\r\n      return this.zigzagLinker(nodes, flag)\r\n    if (STYLE_LABELS[styleId] === 'Wave') return this.waveLinker(nodes, flag)\r\n    if (STYLE_LABELS[styleId] === 'Bump') return this.bumpLinker(nodes, flag)\r\n    if (STYLE_LABELS[styleId] === 'Twine') return this.twineLinker(nodes, flag)\r\n    if (STYLE_LABELS[styleId] === 'Collide')\r\n      return this.collideLinker(nodes, flag)\r\n    if (RENDER_MODE === 'Smooth') return this.normalLinker(nodes, flag)\r\n    else return this.sketchLinker(nodes, flag)\r\n  }\r\n  linkGap(nodes, styles, flags, curFlags) {\r\n    let gapANodes = []\r\n    let gapBNodes = []\r\n    if (nodes[0][1] !== nodes[1][1]) {\r\n      let tmpNodes = []\r\n      if (RENDER_MODE === 'Smooth') tmpNodes = this.bezierLinker(nodes)\r\n      else tmpNodes = this.sketchLinker(nodes).lineNodes\r\n      for (let k = 0; k < tmpNodes.length; k++) {\r\n        if (k <= tmpNodes.length >> 1)\r\n          gapANodes.push([tmpNodes[k][0], tmpNodes[k][1]])\r\n        if (k >= tmpNodes.length >> 1)\r\n          gapBNodes.push([tmpNodes[k][0], tmpNodes[k][1]])\r\n      }\r\n    } else {\r\n      const midNode = [(nodes[0][0] + nodes[1][0]) / 2, nodes[0][1]]\r\n      const gapA = this.linkLine([nodes[0], midNode], flags[0], styles[0])\r\n      curFlags[styles[0]] += gapA.curFlag\r\n      const gapB = this.linkLine([midNode, nodes[1]], flags[1], styles[1])\r\n      curFlags[styles[1]] += gapB.curFlag\r\n      gapANodes = gapA.lineNodes\r\n      gapBNodes = gapB.lineNodes\r\n    }\r\n    return { gapANodes, gapBNodes }\r\n  }\r\n  bezierLinker(nodes, SAMPLERATE = 5) {\r\n    let lineNodes = [],\r\n      p = []\r\n    if (nodes.length === 2) {\r\n      p[0] = [nodes[0][0], nodes[0][1]]\r\n      p[1] = [(nodes[0][0] + nodes[1][0]) * 0.5, nodes[0][1]]\r\n      p[2] = [(nodes[0][0] + nodes[1][0]) * 0.5, nodes[1][1]]\r\n      p[3] = [nodes[1][0], nodes[1][1]]\r\n    } else {\r\n      for (let i = 0; i < 4; i++) p[i] = [nodes[i][0], nodes[i][1]]\r\n    }\r\n    if (SAMPLERATE < 2) SAMPLERATE = 2 //ensure that the number of nodes is odd\r\n    if (SAMPLERATE & 1) SAMPLERATE += 1 //thus, we can divide nodes into two groups evenly\r\n    for (let i = 0; i <= SAMPLERATE; i++) {\r\n      lineNodes[i] = []\r\n      lineNodes[i][0] = this.calcBezier(p, i / SAMPLERATE, 0)\r\n      lineNodes[i][1] = this.calcBezier(p, i / SAMPLERATE, 1)\r\n    }\r\n    return lineNodes\r\n  }\r\n  normalLinker(nodes, flag = 1) {\r\n    const lineNodes = nodes\r\n    let curFlag = 0\r\n    return { lineNodes, curFlag }\r\n  }\r\n  sketchLinker(\r\n    nodes,\r\n    flag = 1,\r\n    sampleling = 5,\r\n    sketchN = 3,\r\n    height = 0.03,\r\n    length = 10,\r\n    shakeX = 0.02,\r\n    shakeY = 0.02\r\n  ) {\r\n    let lineNodes = [],\r\n      endNodes = [],\r\n      p = [],\r\n      curFlag = 0\r\n    let tmpLength = nodes[1][0] - nodes[0][0]\r\n    let tmpHeight = nodes[1][1] - nodes[0][1]\r\n    if (nodes[0][1] === nodes[1][1]) {\r\n      lineNodes.push([nodes[0][0], nodes[0][1]])\r\n      endNodes.push([nodes[0][0] + tmpLength / sampleling, nodes[0][1]])\r\n      endNodes.push([nodes[1][0] - tmpLength / sampleling, nodes[1][1]])\r\n      p.push(endNodes[0])\r\n      p.push([\r\n        (endNodes[0][0] * (sketchN - 1)) / sketchN + endNodes[1][0] / sketchN,\r\n        endNodes[0][1] +\r\n          (Math.random() > 0.5 ? -1 : 1) * Math.random() * tmpLength * height,\r\n      ])\r\n      p.push([\r\n        endNodes[0][0] / sketchN + (endNodes[1][0] * (sketchN - 1)) / sketchN,\r\n        endNodes[1][1] +\r\n          (Math.random() > 0.5 ? -1 : 1) * Math.random() * tmpLength * height,\r\n      ])\r\n      p.push(endNodes[1])\r\n      for (let i = 0, curFlag = 6; i <= curFlag; i++)\r\n        lineNodes.push([\r\n          this.calcBezier(p, i / curFlag, 0),\r\n          this.calcBezier(p, i / curFlag, 1),\r\n        ])\r\n      lineNodes.push([nodes[1][0], nodes[1][1]])\r\n    } else {\r\n      let smoothNodes = this.bezierLinker(nodes)\r\n      for (let i = 1; i < smoothNodes.length - 1; i++) {\r\n        smoothNodes[i][0] +=\r\n          (Math.random() > 0.5 ? -1 : 1) * Math.random() * tmpLength * shakeX\r\n        smoothNodes[i][1] +=\r\n          (Math.random() > 0.5 ? -1 : 1) * Math.random() * tmpHeight * shakeY\r\n      }\r\n      let ctrlNode = [\r\n        smoothNodes[0][0] - (smoothNodes[1][0] - smoothNodes[0][0]) / 2,\r\n        smoothNodes[0][1],\r\n      ]\r\n      for (let i = 0; i < smoothNodes.length - 1; i++) {\r\n        ctrlNode[0] = 2 * smoothNodes[i][0] - ctrlNode[0]\r\n        ctrlNode[1] = 2 * smoothNodes[i][1] - ctrlNode[1]\r\n        p[0] = smoothNodes[i]\r\n        p[1] = ctrlNode\r\n        p[2] = ctrlNode\r\n        p[3] = smoothNodes[i + 1]\r\n        for (let j = 0, curFlag = 4; j < curFlag; j++)\r\n          lineNodes.push([\r\n            this.calcBezier(p, j / curFlag, 0),\r\n            this.calcBezier(p, j / curFlag, 1),\r\n          ])\r\n      }\r\n      lineNodes.push([\r\n        smoothNodes[smoothNodes.length - 1][0],\r\n        smoothNodes[smoothNodes.length - 1][1],\r\n      ])\r\n    }\r\n    return { lineNodes, curFlag }\r\n  }\r\n  zigzagLinker(nodes, flag = 1, length = 10, height = 4) {\r\n    let lineNodes = []\r\n\r\n    const tmpLength = nodes[1][0] - nodes[0][0]\r\n    let curFlag = Math.ceil(tmpLength / length)\r\n    if (curFlag < 2) curFlag = 2\r\n    if (curFlag & 1) curFlag += 1\r\n\r\n    lineNodes.push([nodes[0][0], nodes[0][1]])\r\n    for (let z = 0; z < curFlag; z++) {\r\n      lineNodes.push([\r\n        nodes[0][0] + length * (z + 0.5),\r\n        nodes[0][1] + height * (z & 1 ? -1 : 1) * flag,\r\n      ])\r\n    }\r\n    lineNodes.push([nodes[1][0], nodes[1][1]])\r\n\r\n    return { lineNodes, curFlag }\r\n  }\r\n  waveLinker(nodes, flag = 1, length = 10, height = 4, sampleling = 2) {\r\n    let lineNodes = []\r\n\r\n    const tmpLength = nodes[1][0] - nodes[0][0]\r\n    let curFlag = Math.ceil(tmpLength / length)\r\n    if (curFlag < 2) curFlag = 2\r\n    if (curFlag & 1) curFlag += 1\r\n    let sampleRate = Math.ceil(tmpLength / sampleling)\r\n    if (sampleRate < 2) sampleRate = 2\r\n    if (sampleRate & 1) sampleRate += 1\r\n\r\n    for (let z = 0; z <= sampleRate; z++) {\r\n      lineNodes.push([\r\n        nodes[0][0] + (tmpLength * z) / sampleRate,\r\n        nodes[0][1] +\r\n          Math.sin((z * curFlag * 3.14) / sampleRate) * height * flag,\r\n      ])\r\n    }\r\n    return { lineNodes, curFlag }\r\n  }\r\n  bumpLinker(nodes, flag = 1, length = 10, height = 4) {\r\n    let lineNodes = []\r\n    const tmpLength = nodes[1][0] - nodes[0][0]\r\n    let curFlag = Math.ceil(tmpLength / length)\r\n    if (curFlag < 2) curFlag = 2\r\n    if (curFlag & 1) curFlag += 1\r\n\r\n    for (let z = 0; z <= curFlag; z++) {\r\n      lineNodes.push([\r\n        nodes[0][0] + (tmpLength * z) / curFlag,\r\n        nodes[0][1] + height * (z & 1 ? 1 : -1) * flag * (z != 0),\r\n      ])\r\n      lineNodes.push([\r\n        nodes[0][0] + (tmpLength * z) / curFlag,\r\n        nodes[0][1] + height * (z & 1 ? -1 : 1) * flag * (z != curFlag),\r\n      ])\r\n    }\r\n\r\n    return { lineNodes, curFlag }\r\n  }\r\n  twineLinker(nodes, flag = 1, length = 15, height = 4, sampleling = 2) {\r\n    let lineNodes = []\r\n\r\n    const tmpLength = nodes[1][0] - nodes[0][0]\r\n    let curFlag = Math.ceil(tmpLength / length)\r\n    if (curFlag < 2) curFlag = 2\r\n    if (curFlag & 1) curFlag += 1\r\n    let sampleRate = Math.ceil(tmpLength / sampleling)\r\n    if (sampleRate < 2) sampleRate = 2\r\n    if (sampleRate & 1) sampleRate += 1\r\n\r\n    for (let z = 0; z <= sampleRate; z++) {\r\n      lineNodes.push([\r\n        nodes[0][0] + (tmpLength * z) / sampleRate,\r\n        nodes[0][1] +\r\n          Math.sin((z * curFlag * 3.14) / sampleRate) * height * flag,\r\n      ])\r\n    }\r\n\r\n    return { lineNodes, curFlag }\r\n  }\r\n  collideLinker(nodes, flag = 1, length = 50, height = 2) {\r\n    let lineNodes = []\r\n    const curFlag = 0\r\n    lineNodes.push([nodes[0][0], nodes[0][1] + flag * height])\r\n    lineNodes.push([nodes[1][0], nodes[1][1] + flag * height])\r\n\r\n    return { lineNodes, curFlag }\r\n  }\r\n  calcBezier(p, t, d) {\r\n    let ret = p[0][d] * (1 - t) * (1 - t) * (1 - t)\r\n    ret += 3 * p[1][d] * t * (1 - t) * (1 - t)\r\n    ret += 3 * p[2][d] * t * t * (1 - t)\r\n    ret += p[3][d] * t * t * t\r\n    return ret\r\n  }\r\n}\r\n","import { logGeneratorError } from '../utils/logger'\r\nimport { smoothRender } from './smoothRender'\r\n\r\nexport function storyRender(generator, story, constraints) {\r\n  switch (generator) {\r\n    case 'SmoothRender':\r\n      smoothRender(story, constraints)\r\n      break\r\n    default:\r\n      logGeneratorError(generator)\r\n  }\r\n}\r\n","import { PathSmoother } from './pathSmoother'\r\n\r\nexport function smoothRender(story, constraints) {\r\n  const pathSmoother = new PathSmoother(story, constraints)\r\n  const style = pathSmoother.genStyle(story, constraints)\r\n  story.setTable('style', style)\r\n  const position = pathSmoother.genPosition(story)\r\n  story.setTable('position', position)\r\n}\r\n","import { Table } from '../data/table'\r\n\r\nexport function scale(story, constraints) {\r\n  const ctrs = constraints.filter(ctr => {\r\n    return ctr.style === 'Scale'\r\n  })\r\n  const position = story.getTable('position')\r\n  const character = story.getTable('character')\r\n  const layout = story.getTable('layout')\r\n  const positions = story.positions\r\n  if (ctrs.length < 1) return position\r\n  const { x0, y0, width, height, reserveRatio } = ctrs[ctrs.length - 1].param\r\n  const { minX, maxX, minY, maxY } = getBoundary(story)\r\n  let pos = []\r\n  let ratio = (maxY - minY) / (maxX - minX)\r\n  // ratio = ratio < thres ? idealRatio : ratio;\r\n  for (let i = 0, n = story.getTableRows(); i < n; i++) {\r\n    pos[i] = []\r\n    for (let j = 0, m = story.getTableCols(); j < m; j++) {\r\n      pos[i][j] = []\r\n      if (character.value(i, j) && layout.value(i, j) >= 0) {\r\n        const storySegment = positions[position.value(i, j)]\r\n        storySegment.forEach(node => {\r\n          pos[i][j].push([\r\n            ((node[0] - minX) / (maxX - minX)) * width + x0,\r\n            ((node[1] - minY) / (maxY - minY)) *\r\n              (reserveRatio ? ratio / width : height) +\r\n              y0,\r\n          ])\r\n        })\r\n      }\r\n    }\r\n  }\r\n  const newPosition = genNewPosition(story, pos)\r\n  return newPosition\r\n}\r\n\r\nexport function genNewPosition(story, pos) {\r\n  story.cleanPositions()\r\n  const character = story.getTable('character')\r\n  const layout = story.getTable('layout')\r\n  let tpos = []\r\n  for (let i = 0; i < pos.length; i++) {\r\n    tpos[i] = []\r\n    for (let j = 0; j < pos[i].length; j++) {\r\n      tpos[i][j] = null\r\n      if (character.value(i, j) && layout.value(i, j) >= 0)\r\n        tpos[i][j] = story.addPosition(pos[i][j])\r\n    }\r\n  }\r\n  const newPosition = new Table(tpos)\r\n  return newPosition\r\n}\r\n\r\nexport function getBoundary(story) {\r\n  const position = story.getTable('position')\r\n  const character = story.getTable('character')\r\n  const layout = story.getTable('layout')\r\n  const positions = story.positions\r\n  let minX = 1e9,\r\n    maxX = -1e9,\r\n    minY = 1e9,\r\n    maxY = -1e9\r\n  for (let i = 0, n = story.getTableRows(); i < n; i++) {\r\n    for (let j = 0, m = story.getTableCols(); j < m; j++) {\r\n      if (character.value(i, j) && layout.value(i, j) >= 0) {\r\n        const storySegment = positions[position.value(i, j)]\r\n        storySegment.forEach(node => {\r\n          minX = Math.min(minX, node[0])\r\n          maxX = Math.max(maxX, node[0])\r\n          minY = Math.min(minY, node[1])\r\n          maxY = Math.max(maxY, node[1])\r\n        })\r\n      }\r\n    }\r\n  }\r\n  return { minX, maxX, minY, maxY }\r\n}\r\n\r\nfunction freeTransform(story, constraints) {\r\n  const pathTable = genPath(story, constraints)\r\n  story.setTable('path', pathTable)\r\n  return pathTable\r\n}\r\n\r\nexport function genPath(story, constraints) {\r\n  story.cleanPaths()\r\n  // const position = story.getTable('position')\r\n  const position = scale(story, constraints)\r\n  const character = story.getTable('character')\r\n  const layout = story.getTable('layout')\r\n  const positions = story.positions\r\n  let path = []\r\n  for (let i = 0, n = story.getTableRows(); i < n; i++) {\r\n    path[i] = []\r\n    for (let j = 0, m = story.getTableCols(); j < m; j++) {\r\n      if (character.value(i, j) && layout.value(i, j) >= 0) {\r\n        const segment = positions[position.value(i, j)]\r\n        let pathStr = `M ${segment[0][0]} ${segment[0][1]} `\r\n        for (let k = 1, len = segment.length; k < len; k++) {\r\n          pathStr += `L ${segment[k][0]} ${segment[k][1]}`\r\n        }\r\n        path[i][j] = story.addPath(pathStr)\r\n      } else {\r\n        path[i][j] = 0\r\n      }\r\n    }\r\n  }\r\n  const pathTable = new Table(path)\r\n  return pathTable\r\n}\r\n\r\nexport { freeTransform }\r\n","import { getBoundary, genNewPosition, genPath } from './freeTransform.js'\r\n\r\nfunction transform(story, constraints) {\r\n  const ctrs = constraints.filter(ctr => {\r\n    return ctr.style === 'Reshape'\r\n  })\r\n  const position = story.getTable('position')\r\n  const character = story.getTable('character')\r\n  const layout = story.getTable('layout')\r\n  const positions = story.positions\r\n  if (ctrs.length < 1) return position\r\n  const { upperPath, lowerPath } = ctrs[ctrs.length - 1].param\r\n  const { minX, maxX, minY, maxY } = getBoundary(story)\r\n  let pos = [],\r\n    tpos = []\r\n  for (let i = 0, n = story.getTableRows(); i < n; i++) {\r\n    pos[i] = []\r\n    tpos[i] = []\r\n    for (let j = 0, m = story.getTableCols(); j < m; j++) {\r\n      pos[i][j] = []\r\n      tpos[i][j] = null\r\n      if (character.value(i, j) && layout.value(i, j) >= 0) {\r\n        const storySegment = positions[position.value(i, j)]\r\n        for (let k = 0, len = storySegment.length; k < len; k++) {\r\n          const rY = (storySegment[k][1] - minY) / (maxY - minY)\r\n          const rX =\r\n            (storySegment[k][0] - storySegment[0][0]) /\r\n            (storySegment[len - 1][0] - storySegment[0][0])\r\n          const sNode = [\r\n            upperPath[j << 1] + (lowerPath[j << 1] - upperPath[j << 1]) * rY,\r\n            upperPath[(j << 1) | 1] +\r\n              (lowerPath[(j << 1) | 1] - upperPath[(j << 1) | 1]) * rY,\r\n          ]\r\n          const eNode = [\r\n            upperPath[(j + 1) << 1] +\r\n              (lowerPath[(j + 1) << 1] - upperPath[(j + 1) << 1]) * rY,\r\n            upperPath[((j + 1) << 1) | 1] +\r\n              (lowerPath[((j + 1) << 1) | 1] - upperPath[((j + 1) << 1) | 1]) *\r\n                rY,\r\n          ]\r\n          pos[i][j].push([\r\n            sNode[0] + (eNode[0] - sNode[0]) * rX,\r\n            sNode[1] + (eNode[1] - sNode[1]) * rX,\r\n          ])\r\n        }\r\n      }\r\n    }\r\n  }\r\n  const newPosition = genNewPosition(story, pos)\r\n  return newPosition\r\n}\r\n\r\nfunction circleTransform(story, constraints) {\r\n  const tPosition = transform(story, constraints)\r\n  story.setTable('position', tPosition)\r\n  const pathTable = genPath(story, constraints)\r\n  story.setTable('path', pathTable)\r\n  return position\r\n}\r\n\r\nexport { circleTransform }\r\n","import { logGeneratorError } from '../utils/logger'\r\nimport { freeTransform } from './freeTransform'\r\nimport { circleTransform } from './circleTransform'\r\n\r\nexport function storyTransform(generator, story, constraints) {\r\n  switch (generator) {\r\n    case 'CircleTransform':\r\n      circleTransform(story, constraints)\r\n      break\r\n    case 'FreeTransform':\r\n      freeTransform(story, constraints)\r\n      break\r\n    default:\r\n      logGeneratorError(generator)\r\n  }\r\n}\r\n","export class ConstraintStore {\r\n  constructor() {\r\n    this._constraints = []\r\n    // Default scale constraint\r\n    this.add([], [], 'Scale', {\r\n      x0: 100,\r\n      y0: 100,\r\n      width: 1700,\r\n      height: 400,\r\n      reserveRatio: false,\r\n    })\r\n  }\r\n\r\n  get constraints() {\r\n    return this._constraints\r\n  }\r\n\r\n  add(names, timeSpan, style, param) {\r\n    this._constraints.push({\r\n      names: names,\r\n      timeSpan: timeSpan,\r\n      style: style,\r\n      param: param,\r\n    })\r\n  }\r\n}\r\n","/**\r\n * @types\r\n * Visual Space\r\n *  - Node: [x, y]\r\n *  - NodeID: Number\r\n *  - Segment: Node[]\r\n *  - SegmentID: Number\r\n *  - SegmentPath: String\r\n *  - Storyline: Segment[]\r\n *  - StorylinePath: SegmentPath[]\r\n * Story Space\r\n *  - CharacterName: String\r\n *  - CharacterID: Number\r\n *  - Time: Number\r\n *  - TimeStep: Number\r\n *  - TimeSpan: [t1, t2]\r\n *  - TimeRange: TimeSpan[]\r\n *  - LocationID: Number\r\n *  - LocationName: String\r\n */\r\nexport class Graph {\r\n  constructor(story) {\r\n    this._story = story\r\n    this._storylines = []\r\n    this._storylinePaths = []\r\n    const characterTable = this.getTable('character')\r\n    const positionTable = this.getTable('position')\r\n    const pathTable = this.getTable('path')\r\n    const rows = this.getTableRows()\r\n    const cols = this.getTableCols()\r\n    for (let row = 0; row < rows; row++) {\r\n      let segments = []\r\n      let segmentPaths = []\r\n      for (let col = 0; col < cols; col++) {\r\n        let characterStatus = characterTable.value(row, col)\r\n        if (characterStatus > 0) {\r\n          let positionId = positionTable.value(row, col)\r\n          let segment = this._story._positions[positionId]\r\n          segments.push(segment)\r\n          let pathId = pathTable.value(row, col)\r\n          let path = this._story._paths[pathId]\r\n          segmentPaths.push(path)\r\n        }\r\n      }\r\n      if (segments.length > 0) {\r\n        this._storylines.push(segments)\r\n      }\r\n      if (segmentPaths.length > 0) {\r\n        this._storylinePaths.push(segmentPaths)\r\n      }\r\n    }\r\n  }\r\n\r\n  get characters() {\r\n    return this._story.characters\r\n  }\r\n\r\n  get locations() {\r\n    return this._story.locations\r\n  }\r\n\r\n  get storylines() {\r\n    return this._storylines\r\n  }\r\n\r\n  get storylinePaths() {\r\n    return this._storylinePaths\r\n  }\r\n\r\n  getTable(tableName) {\r\n    return this._story.getTable(tableName)\r\n  }\r\n\r\n  getTableRows() {\r\n    return this._story.getTableRows()\r\n  }\r\n\r\n  getTableCols() {\r\n    return this._story.getTableCols()\r\n  }\r\n\r\n  /**\r\n   * Get the character ID according to the given position.\r\n   *\r\n   * @param { Number } x\r\n   * @param { Number } y\r\n   *\r\n   * @return characterID\r\n   */\r\n  getCharacterID(x, y) {}\r\n\r\n  /**\r\n   * Get the character name according to the given position.\r\n   *\r\n   * @param { Number } x\r\n   * @param { Number } y\r\n   *\r\n   * @return characterName\r\n   */\r\n  getCharacterName(x, y) {}\r\n\r\n  /**\r\n   * Get the location ID according to the given position.\r\n   *\r\n   * @param { Number } x\r\n   * @param { Number } y\r\n   *\r\n   * @return locationID\r\n   */\r\n  getLocationID(x, y) {}\r\n\r\n  /**\r\n   * Get the location name according to the given position.\r\n   *\r\n   * @param { Number } x\r\n   * @param { Number } y\r\n   *\r\n   * @return locationName\r\n   */\r\n  getLocationName(x, y) {}\r\n\r\n  /**\r\n   * Get the timeStep according to the given position.\r\n   *\r\n   * @param { Number } x\r\n   * @param { Number } y\r\n   *\r\n   * @return timeStep\r\n   */\r\n  getTimeStep(x, y) {}\r\n\r\n  /**\r\n   * Get the timeSpan according to the given position.\r\n   *\r\n   * @param { Number } x\r\n   * @param { Number } y\r\n   *\r\n   * @return timeStep\r\n   */\r\n  getTimeSpan(x, y) {}\r\n\r\n  /**\r\n   * Get the x pos of the specified character at a given time.\r\n   *\r\n   * @param { String | Number } character\r\n   * @param { Number } timeStep\r\n   *\r\n   * @return X\r\n   */\r\n  getCharacterX(character, timeStep) {}\r\n\r\n  /**\r\n   * Get the y pos of the specified character at a given time.\r\n   *\r\n   * @param { String | Number } character\r\n   * @param { Number } timeStep\r\n   *\r\n   * @return Y\r\n   */\r\n  getCharacterY(character, timeStep) {}\r\n\r\n  /**\r\n   * Get the segment of the specified character at a given time.\r\n   *\r\n   * @param { String | Number } character\r\n   * @param { Number } timeStep\r\n   *\r\n   * @return segment\r\n   */\r\n  getSegment(character, timeStep) {}\r\n\r\n  /**\r\n   * Get the storyline of the specified character at a given time.\r\n   *\r\n   * @param { String | Number } character\r\n   * @param { Number } timeStep\r\n   *\r\n   * @return segment[]\r\n   */\r\n  getStoryline(character, timeStep) {}\r\n\r\n  /**\r\n   * Get the segment path of the specified character at a given time.\r\n   *\r\n   * @param { String | Number } character\r\n   * @param { Number } timeStep\r\n   *\r\n   * @return segmentPath\r\n   */\r\n  getSegmentPath(character, timeStep) {}\r\n\r\n  /**\r\n   * Get the storyline path of the specified character at a given time.\r\n   *\r\n   * @param { String | Number } character\r\n   * @param { Number } timeStep\r\n   *\r\n   * @return segmentPath[]\r\n   */\r\n  getStorylinePath(character, timeStep) {}\r\n}\r\n","import xml2js from 'xml2js'\r\n\r\nexport function parseXMLFile(xml, story) {\r\n  story.restore()\r\n  let storyNode = xml.querySelector('Story')\r\n  if (storyNode) {\r\n    let characters = storyNode.querySelector('Characters')\r\n    characters = characters.querySelectorAll('Character')\r\n    for (let character of characters) {\r\n      let name = character.getAttribute('Name')\r\n      story._characters.push(name)\r\n      let spans = character.querySelectorAll('Span')\r\n      for (let span of spans) {\r\n        let start = parseInt(span.getAttribute('Start'))\r\n        let end = parseInt(span.getAttribute('End'))\r\n        story._timeStamps.push(start, end)\r\n      }\r\n    }\r\n    const timeset = new Set(story._timeStamps)\r\n    story._timeStamps = Array.from(timeset)\r\n    story._timeStamps.sort((a, b) => a - b)\r\n    let sessionTable = story._tableMap.get('session')\r\n    let characterTable = story._tableMap.get('character')\r\n    let locationTable = story._tableMap.get('location')\r\n    for (let table of [sessionTable, characterTable, locationTable]) {\r\n      table.resize(story._characters.length, story._timeStamps.length - 1)\r\n    }\r\n    for (let character of characters) {\r\n      let spans = character.querySelectorAll('Span')\r\n      let characterName = character.getAttribute('Name')\r\n      let characterId = story._characters.indexOf(characterName)\r\n      for (let span of spans) {\r\n        let start = parseInt(span.getAttribute('Start'))\r\n        let end = parseInt(span.getAttribute('End'))\r\n        let timeId = story._timeStamps.indexOf(start)\r\n        let timeIdend = story._timeStamps.indexOf(end)\r\n        let sessionId = span.getAttribute('Session')\r\n        sessionId = parseInt(sessionId)\r\n        story._maxSessionID = Math.max(story._maxSessionID, sessionId)\r\n        for (let id = timeId; id < timeIdend; id++) {\r\n          characterTable.replace(characterId, id, 1)\r\n          sessionTable.replace(characterId, id, sessionId)\r\n        }\r\n      }\r\n    }\r\n    //parse the location part\r\n    let locations = storyNode.querySelector('Locations')\r\n    locations = storyNode.querySelectorAll('Location')\r\n    for (let location of locations) {\r\n      let locationTable = story._tableMap.get('location')\r\n      let sessionTable = story._tableMap.get('session')\r\n      let characterTable = story._tableMap.get('character')\r\n      let locationName = location.getAttribute('Name')\r\n      story._locations.push(locationName)\r\n      const locationId = story._locations.length - 1\r\n      let sessionsInthislocation = location.getAttribute('Sessions').split(',')\r\n      sessionsInthislocation = sessionsInthislocation.map(x => parseInt(x))\r\n      for (let i = 0; i < sessionTable.rows; i++)\r\n        for (let j = 0; j < sessionTable.cols; j++) {\r\n          let rightSession =\r\n            sessionsInthislocation.indexOf(sessionTable.value(i, j)) !== -1\r\n          if (characterTable.value(i, j) === 1 && rightSession) {\r\n            locationTable.replace(i, j, locationId)\r\n          }\r\n        }\r\n    }\r\n  } else {\r\n    console.warn('No story can be found through this url!')\r\n  }\r\n}\r\n\r\nexport function parseJSONFile(json, story) {\r\n  // let jsonObject=JSON.parse(json)\r\n  story.restore()\r\n  let storyJson = json.Story\r\n  let locations = storyJson.Locations\r\n  let characters = storyJson.Characters\r\n  for (let character in characters) {\r\n    let name = character\r\n    story._characters.push(name)\r\n    let spans = characters[name]\r\n    for (let span of spans) {\r\n      let start = parseInt(span['Start'])\r\n      let end = parseInt(span['End'])\r\n      story._timeStamps.push(start, end)\r\n      let session = parseInt(span['Session'])\r\n      story._maxSessionID = Math.max(story._maxSessionID, session)\r\n    }\r\n  }\r\n  const timeset = new Set(story._timeStamps)\r\n  story._timeStamps = Array.from(timeset)\r\n  story._timeStamps.sort((a, b) => a - b)\r\n  let sessionTable = story._tableMap.get('session')\r\n  let characterTable = story._tableMap.get('character')\r\n  let locationTable = story._tableMap.get('location')\r\n  for (let table of [sessionTable, characterTable, locationTable]) {\r\n    table.resize(story._characters.length, story._timeStamps.length - 1)\r\n  }\r\n  for (let character in characters) {\r\n    let characterName = character\r\n    let spans = characters[characterName]\r\n    let characterId = story._characters.indexOf(characterName)\r\n    for (let span of spans) {\r\n      let start = parseInt(span['Start'])\r\n      let end = parseInt(span['End'])\r\n      let timeId = story._timeStamps.indexOf(start)\r\n      let timeIdend = story._timeStamps.indexOf(end)\r\n      let sessionId = span['Session']\r\n      sessionId = parseInt(sessionId)\r\n      for (let id = timeId; id < timeIdend; id++) {\r\n        characterTable.replace(characterId, id, 1)\r\n        sessionTable.replace(characterId, id, sessionId)\r\n      }\r\n    }\r\n  }\r\n  //parse the location part\r\n  for (let locationName in locations) {\r\n    let location = locations[locationName]\r\n    let locationTable = story._tableMap.get('location')\r\n    let sessionTable = story._tableMap.get('session')\r\n    let characterTable = story._tableMap.get('character')\r\n    story._locations.push(locationName)\r\n    const locationId = story._locations.length - 1\r\n    let sessionsInthislocation = location\r\n    sessionsInthislocation = sessionsInthislocation.map(x => parseInt(x))\r\n    for (let i = 0; i < sessionTable.rows; i++)\r\n      for (let j = 0; j < sessionTable.cols; j++) {\r\n        let rightSession =\r\n          sessionsInthislocation.indexOf(sessionTable.value(i, j)) !== -1\r\n        if (characterTable.value(i, j) === 1 && rightSession) {\r\n          locationTable.replace(i, j, locationId)\r\n        }\r\n      }\r\n  }\r\n}\r\n\r\nexport function dumpXMLFile(fileName, story) {\r\n  if (fileName.indexOf('.xml') == -1) fileName += '.xml '\r\n  const JSONFile = generateJSONFile(story)\r\n  let builder = new xml2js.Builder()\r\n  let xml = builder.buildObject(JSONFile)\r\n  downloadFile(fileName, xml)\r\n}\r\n\r\nexport function dumpJSONFile(fileName, story) {\r\n  if (fileName.indexOf('.json') == -1) fileName += '.json'\r\n  let storyJson = generateJSONFile(story)\r\n  downloadFile(fileName, JSON.stringify(storyJson))\r\n}\r\n\r\nexport function generateJSONFile(story) {\r\n  let locationsJson = dumpJsonLocation(story)\r\n  let charactersJson = dumpJsonCharacters(story)\r\n  let storyJson = {\r\n    Story: { Locations: locationsJson, Characters: charactersJson },\r\n  }\r\n  return storyJson\r\n}\r\n\r\nfunction dumpJsonLocation(story) {\r\n  let locationsJson = {}\r\n  let locations = story._locations\r\n  for (let location of locations) {\r\n    let sessions = story.getLocationSessions(location)\r\n    if (sessions.length > 0) {\r\n      locationsJson[location] = sessions\r\n    }\r\n  }\r\n  return locationsJson\r\n}\r\n\r\nfunction dumpJsonCharacters(story) {\r\n  let charactersJson = {}\r\n  let characters = story._characters\r\n  for (let character of characters) {\r\n    let timeStamps = story.getCharacterTimeRange(character)\r\n    let spansJson = []\r\n    for (let timeStamp of timeStamps) {\r\n      let [start, end] = timeStamp\r\n      let sessionId = story.getSessionID(start, character)\r\n      let spanJson = { Start: start, End: end, Session: sessionId }\r\n      spansJson.push(spanJson)\r\n    }\r\n    charactersJson[character] = spansJson\r\n  }\r\n  return charactersJson\r\n}\r\n\r\nfunction downloadFile(fileName, content) {\r\n  let aLink = document.createElement('a')\r\n  let blob = new Blob([content])\r\n  aLink.download = fileName\r\n  aLink.style.display = 'none'\r\n  aLink.href = URL.createObjectURL(blob)\r\n  document.body.appendChild(aLink)\r\n  aLink.click()\r\n  document.body.removeChild(aLink)\r\n}\r\n","import * as d3Fetch from 'd3-fetch'\r\nimport { Table } from './table'\r\nimport {\r\n  parseXMLFile,\r\n  parseJSONFile,\r\n  dumpXMLFile,\r\n  dumpJSONFile,\r\n  generateJSONFile,\r\n} from '../utils/io'\r\n\r\nexport class Story {\r\n  constructor() {\r\n    this.restore()\r\n  }\r\n\r\n  /**\r\n   * init story\r\n   */\r\n  restore() {\r\n    this._maxSessionID = -1\r\n    this._tableMap = new Map()\r\n    this._tableMap.set('character', new Table())\r\n    this._tableMap.set('session', new Table())\r\n    this._tableMap.set('location', new Table())\r\n    this._characters = []\r\n    this._locations = []\r\n    this._timeStamps = []\r\n    this._positions = []\r\n    this._paths = []\r\n  }\r\n\r\n  get characters() {\r\n    return this._characters\r\n  }\r\n\r\n  get locations() {\r\n    return this._locations\r\n  }\r\n\r\n  get timeline() {\r\n    return this._timeStamps\r\n  }\r\n\r\n  get positions() {\r\n    return this._positions\r\n  }\r\n\r\n  get paths() {\r\n    return this._paths\r\n  }\r\n\r\n  /**\r\n   * read xml/json document\r\n   * @param {string} fileUrl\r\n   * @param {string} fileType\r\n   * @returns\r\n   */\r\n  async load(fileUrl) {\r\n    const fileSeps = fileUrl.split('.')\r\n    const fileType = fileSeps[fileSeps.length - 1]\r\n    if (fileType === 'xml') {\r\n      const xml = await d3Fetch.xml(fileUrl)\r\n      parseXMLFile(xml, this)\r\n    } else if (fileType === 'json') {\r\n      const json = await d3Fetch.json(fileUrl)\r\n      parseJSONFile(json, this)\r\n    } else {\r\n      console.error('Wrong fileType!')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * load json object\r\n   * @param {Object} json\r\n   * @returns\r\n   */\r\n  loadJson(json) {\r\n    parseJSONFile(json, this);\r\n  }\r\n\r\n  /**\r\n   * export xml/json document\r\n   * @param {string} fileUrl\r\n   * @param {string} fileType\r\n   * @returns\r\n   */\r\n  dump(fileName, fileType) {\r\n    if (fileType === 'xml') {\r\n      dumpXMLFile(fileName, this)\r\n    } else if (fileType === 'json') {\r\n      dumpJSONFile(fileName, this)\r\n    } else {\r\n      console.error('Wrong fileType!')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * get table (tableMap)\r\n   * @param {string} tableName\r\n   * @returns\r\n   * - table: Table\r\n   */\r\n  getTable(tableName) {\r\n    return this._tableMap.get(tableName)\r\n  }\r\n\r\n  /**\r\n   * set table (tableMap)\r\n   * @param {String} tableName\r\n   * @param {Table} table\r\n   */\r\n  setTable(tableName, table) {\r\n    this._tableMap.set(tableName, table)\r\n  }\r\n\r\n  getTableRows() {\r\n    return this._characters.length || 0\r\n  }\r\n\r\n  getTableCols() {\r\n    return this._timeStamps.length - 1 || 0\r\n  }\r\n\r\n  /**\r\n   * change timeStamp to timeStep\r\n   * @param {Number} timeStamp\r\n   * @returns\r\n   * - timeStep: number\r\n   */\r\n  getTimeStep(timeStamp) {\r\n    const len = this.getTableCols()\r\n    if (len === 0 || timeStamp < this._timeStamps[0]) return null\r\n    for (let i = 0; i < len; i++) {\r\n      if (this._timeStamps[i] >= timeStamp) {\r\n        return i\r\n      }\r\n    }\r\n    return timeStamp <= this._timeStamps[len] ? len : null\r\n  }\r\n\r\n  /**\r\n   * change timeRange to timeSteps\r\n   * @param {timeSpan[]} timeRange\r\n   * @returns\r\n   * - timeSteps: number[]\r\n   */\r\n  getTimeSteps(timeRange) {\r\n    let tmpTimeSteps = [],\r\n      timeSteps = []\r\n    timeRange.forEach((timeSpan) => {\r\n      let l = -1,\r\n        r = -1\r\n      for (let i = 0; i < this.getTableCols(); i++) {\r\n        if (\r\n          this._timeStamps[i] <= timeSpan[0] &&\r\n          timeSpan[0] < this._timeStamps[i + 1]\r\n        )\r\n          l = i\r\n        if (\r\n          this._timeStamps[i] < timeSpan[1] &&\r\n          timeSpan[1] <= this._timeStamps[i + 1]\r\n        )\r\n          r = i\r\n      }\r\n      for (let i = l; i <= r; i++) tmpTimeSteps.push(i)\r\n    })\r\n    tmpTimeSteps.sort()\r\n    if (tmpTimeSteps.length >= 1) timeSteps.push(tmpTimeSteps[0])\r\n    for (let i = 1; i < tmpTimeSteps.length; i++) {\r\n      if (tmpTimeSteps[i] !== timeSteps[timeSteps.length - 1]) {\r\n        timeSteps.push(tmpTimeSteps[i])\r\n      }\r\n    }\r\n    return timeSteps\r\n  }\r\n\r\n  /**\r\n   * add timestamp to timestamps\r\n   * @param {Number} timeStamp\r\n   */\r\n  addTimeStamp(timeStamp) {\r\n    const storyJson = generateJSONFile(this)\r\n    const characters = storyJson.Story.Characters\r\n    const maxTimeStamp = Math.max(...this._timeStamps)\r\n    if (timeStamp < maxTimeStamp) {\r\n      for (let name in characters) {\r\n        const character = characters[name]\r\n        const _character = []\r\n        character.forEach((_) => {\r\n          const start = _['Start']\r\n          const end = _['End']\r\n          const sessionID = _['Session']\r\n          if (timeStamp > start && timeStamp < end) {\r\n            _character.push(\r\n              {\r\n                Start: start,\r\n                End: timeStamp,\r\n                Session: sessionID,\r\n              },\r\n              {\r\n                Start: timeStamp,\r\n                End: end,\r\n                Session: sessionID,\r\n              }\r\n            )\r\n          } else {\r\n            _character.push(_)\r\n          }\r\n        })\r\n        characters[name] = _character\r\n      }\r\n    } else if (timeStamp > maxTimeStamp) {\r\n      for (let character of characters) {\r\n        character.push({\r\n          Start: maxTimeStamp,\r\n          End: timeStamp,\r\n          Session: this.getNewSessionID(),\r\n        })\r\n      }\r\n    }\r\n    parseJSONFile(storyJson, this)\r\n  }\r\n\r\n  /**\r\n   * delete timestamp from timestamps\r\n   * @param {Number} timeStamp\r\n   */\r\n  deleteTimeStamp(timeStamp) {}\r\n\r\n  /**\r\n   * add characters to the story\r\n   * @param {String} characterName\r\n   * @param {timeSpan[]} timeRange\r\n   */\r\n  addCharacter(characterName, timeRange = []) {\r\n    if (this._characters.indexOf(characterName) > -1) {\r\n      this.changeCharacter(characterName, timeRange)\r\n    } else {\r\n      const storyJson = generateJSONFile(this)\r\n      const sessionID = ++this._maxSessionID\r\n      const locations = storyJson.Story.Locations\r\n      const characters = storyJson.Story.Characters\r\n      if (locations.All) {\r\n        locations.All.push(sessionID)\r\n      } else {\r\n        locations['All'] = [sessionID]\r\n      }\r\n      characters[characterName] = timeRange.map((timeSpan) => {\r\n        return {\r\n          Start: timeSpan[0],\r\n          End: timeSpan[1],\r\n          Session: sessionID,\r\n        }\r\n      })\r\n      parseJSONFile(storyJson, this)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * delete characters from the story\r\n   * @param {String | Number} character\r\n   */\r\n  deleteCharacter(character) {\r\n    const characterName =\r\n      typeof character === 'number'\r\n        ? this.getCharacterName(character)\r\n        : character\r\n    if (characterName) {\r\n      const storyJson = generateJSONFile(this)\r\n      const locations = storyJson.Story.Locations\r\n      const characters = storyJson.Story.Characters\r\n      if (characters.hasOwnProperty(characterName)) {\r\n        const sessions = characters[characterName].map(\r\n          (span) => span['Session']\r\n        )\r\n        // remove the sessions of the character\r\n        delete characters[characterName]\r\n        for (let location in locations) {\r\n          locations[location] = locations[location].filter(\r\n            (_id) => sessions.indexOf(_id) < 0\r\n          )\r\n        }\r\n        parseJSONFile(storyJson, this)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * change the life circle of characters\r\n   * @param {String | Number} character\r\n   * @param {timeSpan[]} timeRange\r\n   */\r\n  changeCharacter(character, timeRange = []) {\r\n    const characterName =\r\n      typeof character === 'number'\r\n        ? this.getCharacterName(character)\r\n        : character\r\n    if (characterName) {\r\n      this.deleteCharacter(characterName)\r\n      this.addCharacter(characterName, timeRange)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * change the sessions of characters\r\n   * WARN!: this operation will disturb locations\r\n   * @param {Number} sessionID\r\n   * @param {String | Number[]} characters\r\n   * @param {timeSpan} timeSpan\r\n   */\r\n  changeSession(sessionID, characters = [], timeSpan, isHardBoundary = false) {\r\n    if (isHardBoundary) {\r\n      const [start, end] = timeSpan\r\n      this.addTimeStamp(start)\r\n      this.addTimeStamp(end)\r\n    }\r\n    this._changeSessionSoft(sessionID, characters, timeSpan)\r\n  }\r\n\r\n  _changeSessionSoft(sessionID, characters = [], timeSpan) {\r\n    let timeSteps = this.getTimeSteps([timeSpan])\r\n    let session = this.getTable('session')\r\n    for (let i = 0; i < characters.length; i++) {\r\n      let character = characters[i]\r\n      if (typeof character === 'string') {\r\n        character = this.getCharacterID(character)\r\n      }\r\n      if (character !== null) {\r\n        for (let j = 0; j < timeSteps.length; j++) {\r\n          session.replace(character, timeSteps[j], sessionID)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * change the locations of characters\r\n   * @param {String} location\r\n   * @param {Number[]} sessions\r\n   */\r\n  changeLocation(location, sessions) {\r\n    if (this._locations.indexOf(location) < 0) {\r\n      this._locations.push(location)\r\n    }\r\n    let locationID = this.getLocationID(location)\r\n    if (locationID === null) return\r\n    const locationTable = this.getTable('location')\r\n    const sessionTable = this.getTable('session')\r\n    for (let i = 0, len = this.getTableRows(); i < len; i++) {\r\n      for (let j = 0, len = this.getTableCols(); j < len; j++) {\r\n        const sessionID = sessionTable.value(i, j)\r\n        if (sessions.indexOf(sessionID) > -1) {\r\n          locationTable.replace(i, j, locationID)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * get character name\r\n   * @param {Number} characterID\r\n   * @returns\r\n   * - name: string | null\r\n   */\r\n  getCharacterName(characterID) {\r\n    return characterID < this._characters.length\r\n      ? this._characters[characterID]\r\n      : null\r\n  }\r\n\r\n  /**\r\n   * get character ID\r\n   * @param {String} characterName\r\n   * @returns\r\n   * - ID: number | null\r\n   */\r\n  getCharacterID(characterName) {\r\n    const characterID = this._characters.indexOf(characterName)\r\n    return characterID > -1 ? characterID : null\r\n  }\r\n\r\n  /**\r\n   * get the time range of characters\r\n   * @param {String | Number} character\r\n   * @returns\r\n   * - timeRange: [[t1, t2], ..]\r\n   */\r\n  getCharacterTimeRange(character) {\r\n    character =\r\n      typeof character === 'number' ? character : this.getCharacterID(character)\r\n    let timeRange = []\r\n    if (character !== null) {\r\n      for (let i = 0; i < this.getTableCols(); i++) {\r\n        if (this._tableMap.get('character').value(character, i) === 1) {\r\n          timeRange.push([this._timeStamps[i], this._timeStamps[i + 1]])\r\n        }\r\n      }\r\n    }\r\n    return timeRange\r\n  }\r\n\r\n  /**\r\n   * get session ID\r\n   * @param {Number} timeStamp\r\n   * @param {String} characterName\r\n   * @returns\r\n   * - ID: number\r\n   */\r\n  getSessionID(timeStamp, characterName) {\r\n    let timeStep = this.getTimeStep(timeStamp)\r\n    let characterID = this.getCharacterID(characterName)\r\n    if (timeStep !== null && characterID !== null) {\r\n      return this.getTable('session').value(characterID, timeStep)\r\n    }\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * increment maxSessionID\r\n   */\r\n  getNewSessionID() {\r\n    return ++this._maxSessionID\r\n  }\r\n\r\n  /**\r\n   * get characters according to the session\r\n   * @param {Number} sessionID\r\n   * @returns\r\n   * - characterIDs: number[]\r\n   */\r\n  getSessionCharacters(sessionID) {\r\n    let characterIDs = new Set()\r\n    for (let i = 0; i < this.getTableRows(); i++) {\r\n      for (let j = 0; j < this.getTableCols(); j++) {\r\n        if (\r\n          this.getTable('character').value(i, j) == 1 &&\r\n          this.getTable('session').value(i, j) === sessionID\r\n        ) {\r\n          characterIDs.add(i)\r\n          break\r\n        }\r\n      }\r\n    }\r\n    return Array.from(characterIDs)\r\n  }\r\n\r\n  /**\r\n   * get the timeSpan of sessions\r\n   * @param {Number} sessionID\r\n   * @returns\r\n   * - timeRange: timeSpan[]\r\n   */\r\n  getSessionTimeRange(sessionID) {\r\n    let timeSteps = []\r\n    for (let i = 0; i < this.getTableRows(); i++) {\r\n      for (let j = 0; j < this.getTableCols(); j++) {\r\n        if (\r\n          this.getTable('session').value(i, j) === sessionID &&\r\n          timeSteps.indexOf(j) < 0\r\n        ) {\r\n          timeSteps.push(j)\r\n        }\r\n      }\r\n    }\r\n    return timeSteps.map((step) => [\r\n      this._timeStamps[step],\r\n      this._timeStamps[step + 1],\r\n    ])\r\n  }\r\n\r\n  /**\r\n   * get location name\r\n   * @param {Number} locationID\r\n   * @returns\r\n   * - locationName: string\r\n   */\r\n  getLocationName(locationID) {\r\n    return locationID < this._locations.length\r\n      ? this._locations[locationID]\r\n      : null\r\n  }\r\n\r\n  /**\r\n   * get location ID\r\n   * @param {String} locationName\r\n   * @returns\r\n   * - locationID: number\r\n   */\r\n  getLocationID(locationName) {\r\n    const locationID = this._locations.indexOf(locationName)\r\n    return locationID > -1 ? locationID : null\r\n  }\r\n\r\n  /**\r\n   * get characters according to the location\r\n   * @param {String | Number} location\r\n   * @returns\r\n   * - characterIDs: number[]\r\n   */\r\n  getLocationCharacters(location) {\r\n    if (typeof location == 'string') {\r\n      location = this.getLocationID(location)\r\n    }\r\n    let characterIDs = new Set()\r\n    for (let i = 0; i < this.getTableRows(); i++) {\r\n      for (let j = 0; j < this.getTableCols(); j++) {\r\n        if (\r\n          this._tableMap.get('character').value(i, j) == 1 &&\r\n          this._tableMap.get('location').value(i, j) === location\r\n        ) {\r\n          characterIDs.add(i)\r\n        }\r\n      }\r\n    }\r\n    return Array.from(characterIDs)\r\n  }\r\n\r\n  /**\r\n   * get session according to the location\r\n   * @param {String | Number} location\r\n   * @returns\r\n   * - sessionIDs: number[]\r\n   */\r\n  getLocationSessions(location) {\r\n    if (typeof location == 'string') {\r\n      location = this.getLocationID(location)\r\n    }\r\n    if (location !== null) {\r\n      let sessionIDs = new Set()\r\n      for (let i = 0; i < this.getTableRows(); i++) {\r\n        for (let j = 0; j < this.getTableCols(); j++) {\r\n          if (\r\n            this.getTable('character').value(i, j) == 1 &&\r\n            this.getTable('location').value(i, j) === location\r\n          ) {\r\n            sessionIDs.add(this._tableMap.get('session').value(i, j))\r\n          }\r\n        }\r\n      }\r\n      let ans = Array.from(sessionIDs)\r\n      ans.sort((a, b) => a - b)\r\n      return ans\r\n    }\r\n    return []\r\n  }\r\n  cleanPaths() {\r\n    this._paths = []\r\n  }\r\n  cleanPositions() {\r\n    this._positions = []\r\n  }\r\n  addPath(path) {\r\n    this._paths.push(path)\r\n    return this._paths.length - 1\r\n  }\r\n  addPosition(pos) {\r\n    this._positions.push(pos)\r\n    return this._positions.length - 1\r\n  }\r\n}\r\n","// Generators\r\nimport { storyOrder } from './order/index'\r\nimport { storyAlign } from './align/index'\r\nimport { storyCompact } from './compact/index'\r\nimport { storyRender } from './render/index'\r\nimport { storyTransform } from './transform/index'\r\n// Data structure\r\nimport { ConstraintStore } from './data/constraint'\r\nimport { Graph } from './data/graph'\r\nimport { Story } from './data/story'\r\n// Utils\r\nimport { logConstraintError } from './utils/logger'\r\n\r\nexport default class iStoryline {\r\n  /**\r\n   * Construct a iStoryline generator for a story.\r\n   * Once the story changed, the generator should be re-constructed.\r\n   *\r\n   * @param {Array} pipeline\r\n   * - ['GreedyOrder', 'GreedyAlign', 'GreedySlotCompact', 'SmoothRender', 'FreeTransform']\r\n   */\r\n  constructor(\r\n    pipeline = [\r\n      'GreedyOrder',\r\n      'GreedyAlign',\r\n      'GreedySlotCompact',\r\n      'SmoothRender',\r\n      'FreeTransform',\r\n    ]\r\n  ) {\r\n    this._pipeline = pipeline\r\n    this._story = new Story()\r\n    this._constraintStore = new ConstraintStore()\r\n  }\r\n\r\n  /**\r\n   * Generate storyline visualizations from the input file.\r\n   *\r\n   * @param {String} fileUrl\r\n   * - \"./data/JurassicPark.xml\"\r\n   */\r\n  async load(fileUrl, fileType = 'xml') {\r\n    await this._story.load(fileUrl, fileType)\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Generate storyline visualizations from the input json.\r\n   * Detailed for AudioStoryline component\r\n   *\r\n   * @param {Object} json\r\n   */\r\n  generateLayout(json, x0=0, y0=0, width=500, height=300) {\r\n    this._constraintStore.add([], [], 'Scale', {\r\n      x0: x0,\r\n      y0: y0,\r\n      width: width,\r\n      height: height,\r\n      reserveRatio: false,\r\n    })\r\n    this._story.loadJson(json)\r\n    return this._layout()\r\n  }\r\n\r\n  _layout() {\r\n    const { _story, _constraintStore, _pipeline } = this\r\n    const _constraints = _constraintStore.constraints\r\n    // Order\r\n    this.orderGenerator = _pipeline[0] || null\r\n    if (this.orderGenerator) {\r\n      storyOrder(this.orderGenerator, _story, _constraints)\r\n    }\r\n    // Align\r\n    this.alignGenerator = _pipeline[1] || null\r\n    if (this.alignGenerator) {\r\n      storyAlign(this.alignGenerator, _story, _constraints)\r\n    }\r\n    // Compact\r\n    this.compactGenerator = _pipeline[2] || null\r\n    if (this.compactGenerator) {\r\n      storyCompact(this.compactGenerator, _story, _constraints)\r\n    }\r\n    // Render\r\n    this.renderGenerator = _pipeline[3] || null\r\n    if (this.renderGenerator) {\r\n      storyRender(this.renderGenerator, _story, _constraints)\r\n    }\r\n    // Transform\r\n    this.transformGenerator = _pipeline[4] || null\r\n    if (this.transformGenerator) {\r\n      storyTransform(this.transformGenerator, _story, _constraints)\r\n    }\r\n    return new Graph(_story)\r\n  }\r\n\r\n  dump(fileName, fileType) {\r\n    this._story.dump(fileName, fileType)\r\n  }\r\n\r\n  addCharacter(character, timeRange) {\r\n    this._story.addCharacter(character, timeRange)\r\n    return this._layout()\r\n  }\r\n\r\n  changeCharacter(character, timeRange) {\r\n    this._story.changeCharacter(character, timeRange)\r\n    return this._layout()\r\n  }\r\n\r\n  deleteCharacter(character) {\r\n    this._story.deleteCharacter(character)\r\n    return this._layout()\r\n  }\r\n\r\n  addSession(characters, timeSpan) {\r\n    const newSessionID = this._story.getNewSessionID()\r\n    this._story.changeSession(newSessionID, characters, timeSpan)\r\n    return this._layout()\r\n  }\r\n\r\n  removeSession(sessionID) {\r\n    this._story.deleteSession(sessionID)\r\n    return this._layout()\r\n  }\r\n\r\n  addLocation(location, characters, timeRange) {\r\n    this._story.changeLocation(location, characters, timeRange)\r\n    return this._layout()\r\n  }\r\n\r\n  removeLocation(location) {\r\n    this._story.changeLocation(location)\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Rearrange the order of characters\r\n   *\r\n   * @param {String[]} names\r\n   * @param {Number[]} timeSpan\r\n   *\r\n   * @example\r\n   * - constraint: {\r\n   *   \"names\": ['upperName', 'lowerName'],\r\n   *   \"timeSpan\": [t1, t2],\r\n   *   \"style\": 'Sort',\r\n   *   \"param\": {}\r\n   * }\r\n   *\r\n   * @return graph\r\n   */\r\n  sort(names, timeSpan) {\r\n    if (names.length > 1 && timeSpan.length === 2) {\r\n      this._constraintStore.add(names, timeSpan, 'Sort', {})\r\n    } else {\r\n      logConstraintError('Sort')\r\n    }\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Bend character lines\r\n   *\r\n   * @param {String[]} names\r\n   * @param {Number[]} timeSpan\r\n   *\r\n   * @example\r\n   * - constraint: {\r\n   *   \"names\": ['name'],\r\n   *   \"timeSpan\": [t1, t2],\r\n   *   \"style\": 'Bend',\r\n   *   \"param\": {}\r\n   * }\r\n   *\r\n   * @return graph\r\n   */\r\n  bend(names, timeSpan) {\r\n    if (\r\n      names.length === 1 &&\r\n      timeSpan.length === 2 &&\r\n      timeSpan[0] === timeSpan[1]\r\n    ) {\r\n      this._constraintStore.add(names, timeSpan, 'Bend', {})\r\n    } else {\r\n      logConstraintError('Bend')\r\n    }\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Straighten character lines\r\n   *\r\n   * @param {String[]} names\r\n   * @param {Number[]} timeSpan\r\n   *\r\n   * @example\r\n   * - constraint: {\r\n   *   \"names\": ['name'],\r\n   *   \"timeSpan\": [t1, t2],\r\n   *   \"style\": 'Straighten',\r\n   *   \"param\": {}\r\n   * }\r\n   *\r\n   * @return graph\r\n   */\r\n  straighten(names, timeSpan) {\r\n    if (\r\n      names.length === 1 &&\r\n      timeSpan.length === 2 &&\r\n      timeSpan[0] !== timeSpan[1]\r\n    ) {\r\n      this._constraintStore.add(names, timeSpan, 'Straighten', {})\r\n    } else {\r\n      logConstraintError('Straighten')\r\n    }\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Remove white space\r\n   *\r\n   * @param {String[]} names\r\n   * @param {Number[]} timepan\r\n   * @param {Number} scale\r\n   *\r\n   * @example\r\n   * - scale: 0<<1\r\n   * - constraint: {\r\n   *   \"names\": ['name1', 'name2', ...],\r\n   *   \"timeSpan\": [t1, t2],\r\n   *   \"style\": 'Compact',\r\n   *   \"param\": { 'scale': 0.5 }\r\n   * }\r\n   *\r\n   * @return graph\r\n   */\r\n  compress(names, timeSpan, scale = 0.5) {\r\n    if (names.length === 2 && timeSpan.length === 2) {\r\n      this._constraintStore.add(names, timeSpan, 'Compress', { scale: scale })\r\n    } else {\r\n      logConstraintError('Compress')\r\n    }\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Expand white space\r\n   *\r\n   * @param {String[]} names\r\n   * @param {Number[]} timeSpan\r\n   * @param {Number} scale\r\n   *\r\n   * @example\r\n   * - scale: >1\r\n   * - constraint: {\r\n   *   \"names\": ['name1', 'name2', ...],\r\n   *   \"timeSpan\": [t1, t2],\r\n   *   \"style\": 'Expand',\r\n   *   \"param\": {}\r\n   * }\r\n   *\r\n   * @return graph\r\n   */\r\n  expand(names, timeSpan, scale = 2) {\r\n    if (names.length === 2 && timeSpan.length === 2) {\r\n      this._constraintStore.add(names, timeSpan, 'Expand', { scale: scale })\r\n    } else {\r\n      logConstraintError('Expand')\r\n    }\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Control white space\r\n   *\r\n   * @param {Number} intraSep\r\n   * @param {Number} interSep\r\n   *\r\n   * @return graph\r\n   */\r\n  space(intraSep, interSep) {\r\n    this._constraintStore.add([], [], 'Space', {\r\n      intraSep: intraSep,\r\n      interSep: interSep,\r\n    })\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Change line paths\r\n   *\r\n   * @param {String[]} names\r\n   * @param {Number[]} timeSpan\r\n   * @param {Point[]} path\r\n   * @param {Array} constraints\r\n   *\r\n   * @example\r\n   * - constraint: {\r\n   *   \"names\": ['name'],\r\n   *   \"timeSpan\": [t1, t2],\r\n   *   \"style\": 'Adjust',\r\n   *   \"param\": {'path': [x1, y1, x2, y2, ...]}\r\n   * }\r\n   *\r\n   * @return graph\r\n   */\r\n  adjust(names, timeSpan, path) {\r\n    if (\r\n      names.length === 1 &&\r\n      timeSpan.length === 2 &&\r\n      timeSpan[1] > timeSpan[0]\r\n    ) {\r\n      this._constraintStore.add(names, timeSpan, 'Adjust', { path: path })\r\n    } else {\r\n      logConstraintError('Adjust')\r\n    }\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Relate lines acccording to the semantic connections\r\n   *\r\n   * @param {String[]} names\r\n   * @param {Number[]} timeSpan\r\n   * @param {String} style\r\n   * @param {Array} constraints\r\n   *\r\n   * @example\r\n   * - constraint: {\r\n   *   \"names\": ['name1', 'name2'],\r\n   *   \"timeSpan\": [t1, t2],\r\n   *   \"style\": 'Twine' | 'Knot' | 'Collide' | 'Merge' | 'Split',\r\n   *   \"param\": {}\r\n   * }\r\n   *\r\n   * @return graph\r\n   */\r\n  relate(names, timeSpan, style) {\r\n    if (names.length === 2 && timeSpan.length === 2) {\r\n      this._constraintStore.add(names, timeSpan, style, {})\r\n    } else {\r\n      logConstraintError('Relate')\r\n    }\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Set the style of lines\r\n   *\r\n   * @param {String[]} names\r\n   * @param {Number[]} timeSpan\r\n   * @param {String} style\r\n   *\r\n   * @example\r\n   * - constraint: {\r\n   *   \"names\": ['name'],\r\n   *   \"timeSpan\": [t1, t2],\r\n   *   \"style\": 'Color' | 'Width' | 'Dash' | 'Zigzag' | 'Wave' | 'Bump',\r\n   *   \"param\": {}\r\n   * }\r\n   *\r\n   * @return graph\r\n   */\r\n  stylish(names, timeSpan, style) {\r\n    if (names.length === 1 && timeSpan.length === 2) {\r\n      this._constraintStore.add(names, timeSpan, style, {})\r\n    } else {\r\n      logConstraintError('Stylish')\r\n    }\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Reshape the layout.\r\n   *\r\n   * @param {Number[]} upperPath\r\n   * @param {Number[]} lowerPath\r\n   *\r\n   * @example\r\n   * - path: [x1, y1, x2, y2, ...]\r\n   *\r\n   * @return graph\r\n   */\r\n  reshape(upperPath = [], lowerPath = []) {\r\n    this._constraintStore.add([], [], 'Reshape', {\r\n      upperPath: upperPath,\r\n      lowerPath: lowerPath,\r\n    })\r\n    return this._layout()\r\n  }\r\n\r\n  /**\r\n   * Change the size of storyline visualization\r\n   *\r\n   * @param {Number} x0\r\n   * @param {Number} y0\r\n   * @param {Number} width\r\n   * @param {Number} height\r\n   * @param {Boolean} reserveRatio\r\n   *\r\n   * @return graph\r\n   */\r\n  scale(x0 = 0, y0 = 0, width = 1000, height = 372, reserveRatio = false) {\r\n    this._constraintStore.add([], [], 'Scale', {\r\n      x0: x0,\r\n      y0: y0,\r\n      width: width,\r\n      height: height,\r\n      reserveRatio: reserveRatio,\r\n    })\r\n    return this._layout()\r\n  }\r\n}\r\n","import { logGeneratorError } from '../utils/logger'\r\nimport { locationSort } from './locationSort'\r\nimport { greedySort } from './greedySort'\r\n\r\nexport function storyOrder(generator, story, constraints) {\r\n  switch (generator) {\r\n    case 'GreedyOrder':\r\n      greedySort(story, constraints)\r\n      break\r\n    case 'LocationOrder':\r\n      locationSort(story, constraints)\r\n      break\r\n    default:\r\n      logGeneratorError(generator)\r\n  }\r\n}\r\n","import { greedyAlign } from './greedyAlign'\r\nimport { logGeneratorError } from '../utils/logger'\r\n\r\nexport function storyAlign(generator, story, constraints) {\r\n  switch (generator) {\r\n    case 'GreedyAlign':\r\n      greedyAlign(story, constraints)\r\n      break\r\n    default:\r\n      logGeneratorError(generator)\r\n  }\r\n}\r\n","import { logGeneratorError } from '../utils/logger'\r\nimport { greedySlotCompact } from './greedySlotCompact'\r\nimport { opCompact } from './opCompact'\r\nimport { opSlotCompact } from './opSlotCompact'\r\n\r\nexport function storyCompact(generator, story, constraints) {\r\n  switch (generator) {\r\n    case 'GreedySlotCompact':\r\n      greedySlotCompact(story, constraints)\r\n      break\r\n    case 'OpCompact':\r\n      opCompact(story, constraints)\r\n      break\r\n    case 'OpSlotCompact':\r\n      opSlotCompact(story, constraints)\r\n      break\r\n    default:\r\n      logGeneratorError(generator)\r\n  }\r\n}\r\n","import { StoryLine, Character  } from \"./type\";\nimport * as StorylineFactory from \"../../../alg/istoryline\";\n\nexport class LayoutGenerator {\n  storylines: StoryLine[];\n  characters: Character[];\n  charactersRiskNum: number[];\n  riskGroupsList: number[][];\n  constructor(storyScript, x0, y0, width, height) {\n    const iStoryliner = new StorylineFactory.iStoryline();\n    const graph = iStoryliner.generateLayout(\n      storyScript,\n      x0,\n      y0,\n      width,\n      height\n    );\n    const {\n      riskGroupLines: riskGroupsList,\n      charactersRiskNum,\n    } = this.computeRiskGroupIndex(storyScript);\n    const storylines = this.postProcessYScale(\n      riskGroupsList,\n      graph.storylines,\n      height\n    );\n    this.storylines = storylines;\n    this.characters = graph.characters;\n    this.charactersRiskNum = charactersRiskNum;\n    this.riskGroupsList = riskGroupsList;\n  }\n\n  postProcessYScale(\n    riskGroupsListInput: number[][],\n    storylinesInput: number[][][][],\n    containerH: number\n  ) {\n    const riskGroupsList = JSON.parse(JSON.stringify(riskGroupsListInput));\n    const storylinesOrigin = JSON.parse(JSON.stringify(storylinesInput));\n    const storylines = [];\n    const connectLineRatio = 0.1;\n    // retain 4 points for one segment\n    for (let i = 0; i < storylinesOrigin.length; i++) {\n      storylines.push([]);\n      for (let j = 0; j < storylinesOrigin[i].length; j++) {\n        storylines[i].push([]);\n        const pointsNum = storylinesOrigin[i][j].length;\n        const startX = storylinesOrigin[i][j][0][0];\n        const endX = storylinesOrigin[i][j][pointsNum - 1][0];\n        const medianY = storylinesOrigin[i][j][Math.floor(pointsNum / 2)][1];\n        const connectWidth = connectLineRatio * (endX - startX);\n        storylines[i][j].push([startX, medianY]);\n        storylines[i][j].push([startX + connectWidth, medianY]);\n        storylines[i][j].push([endX - connectWidth, medianY]);\n        storylines[i][j].push([endX, medianY]);\n      }\n    }\n    // sort by Y value - small to big\n    for (let i = 0; i < riskGroupsList.length; i++) {\n      for (let j = 0; j < riskGroupsList[i].length - 1; j++) {\n        for (let k = j + 1; k < riskGroupsList[i].length; k++) {\n          const yJ = storylines[riskGroupsList[i][j]][i][0][1];\n          const yK = storylines[riskGroupsList[i][k]][i][0][1];\n          if (yJ > yK) {\n            const t = riskGroupsList[i][j];\n            riskGroupsList[i][j] = riskGroupsList[i][k];\n            riskGroupsList[i][k] = t;\n          }\n        }\n      }\n    }\n    const lineCount = storylines.length;\n    const scaleRatio = 0.2;\n    const linesGap = (scaleRatio * containerH) / (lineCount + 1);\n    for (let i = 0; i < riskGroupsList.length; i++) {\n      const riskGroupGap = linesGap * (riskGroupsList[i].length - 1);\n      let linesYSum = 0;\n      for (let j = 0; j < riskGroupsList[i].length; j++) {\n        linesYSum += storylines[riskGroupsList[i][j]][i][0][1];\n      }\n      const riskGroupYStart =\n        linesYSum / riskGroupsList[i].length - riskGroupGap / 2;\n      for (let j = 0; j < riskGroupsList[i].length; j++) {\n        for (let k = 0; k < storylines[riskGroupsList[i][j]][i].length; k++) {\n          storylines[riskGroupsList[i][j]][i][k][1] =\n            riskGroupYStart + j * linesGap;\n        }\n      }\n    }\n    return storylines;\n  }\n\n  computeRiskGroupIndex(audioScript: any) {\n    const charactersData = audioScript.Story.Characters;\n    const characters = Object.keys(charactersData);\n    const sessionCount = charactersData[characters[0]].length;\n    const lineCount = characters.length;\n    const charactersRiskNum = new Array(lineCount).fill(0);\n    const riskGroupLines: number[][] = [];\n    for (let i = 0; i < sessionCount; i++) {\n      const riskGroupLinesIndex: number[] = [];\n      let riskGroupSession = 0;\n      let isFindGroup = false;\n      for (let j = 0; j < lineCount; j++) {\n        const characterSession = charactersData[characters[j]][i].Session;\n        if (isFindGroup) {\n          if (characterSession === riskGroupSession) {\n            riskGroupLinesIndex.push(j);\n            charactersRiskNum[j]++;\n          }\n        } else {\n          for (let k = 0; k < j; k++) {\n            if (characterSession === charactersData[characters[k]][i].Session) {\n              riskGroupSession = characterSession;\n              isFindGroup = true;\n              riskGroupLinesIndex.push(k);\n              riskGroupLinesIndex.push(j);\n              charactersRiskNum[k]++;\n              charactersRiskNum[j]++;\n              break;\n            }\n          }\n        }\n      }\n      riskGroupLines.push(riskGroupLinesIndex);\n    }\n    return {\n      riskGroupLines: riskGroupLines,\n      charactersRiskNum: charactersRiskNum,\n    };\n  }\n}\n","import React, { Component } from \"react\";\nimport { StoryLine, Character } from \"./type\";\n\ntype Props = {\n  sessionId: number;\n  riskGroup: number[];\n  storylines: StoryLine[];\n  characters: Character[];\n};\n\ntype State = {\n  fillColor: string;\n  fillOpacity: number;\n  strokeColor: string;\n  strokeWidth: number;\n  rectRadius: number;\n};\n\nconst colorScheme = [\n  {\n    risk: \"FA\",\n    policy: \"Flase Advertising\",\n    color: \"#fb8072\",\n  },\n  {\n    risk: \"PP\",\n    policy: \"Protected Products\",\n    color: \"#80b1d3\",\n  },\n  {\n    risk: \"IB\",\n    policy: \"Inappropriate Business\",\n    color: \"#fdb462\",\n  },\n  {\n    risk: \"SC\",\n    policy: \"Sensitive content\",\n    color: \"#8dd3c7\",\n  },\n  {\n    risk: \"NM\",\n    policy: \"Normal\",\n    color: \"#c0c0c0\",\n  },\n];\n\nfunction pickColor(riskType) {\n  for (let i = 0, len = colorScheme.length; i < len; i++) {\n    const item = colorScheme[i];\n    if (item.risk === riskType) {\n      return item.color;\n    }\n  }\n  return \"#000\";\n}\n\nexport default class GroupShape extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      fillColor: \"#fff\",\n      fillOpacity: 1,\n      strokeColor: \"#e78859\",\n      strokeWidth: 2,\n      rectRadius: 5,\n    };\n  }\n\n  getRectData() {\n    const riskGroup = this.props.riskGroup;\n    const storylines = this.props.storylines;\n    const sessionId = this.props.sessionId;\n    for (let i = 0; i < riskGroup.length - 1; i++) {\n      for (let j = i + 1; j < riskGroup.length; j++) {\n        if (\n          storylines[riskGroup[i]][sessionId][0][1] >\n          storylines[riskGroup[j]][sessionId][0][1]\n        ) {\n          const t = riskGroup[i];\n          riskGroup[i] = riskGroup[j];\n          riskGroup[j] = t;\n        }\n      }\n    }\n\n    const x = storylines[riskGroup[0]][sessionId][1][0];\n    const w = storylines[riskGroup[0]][sessionId][2][0] - x;\n    const y = storylines[riskGroup[0]][sessionId][1][1];\n    const h = storylines[riskGroup[riskGroup.length - 1]][sessionId][2][1] - y;\n    const additionY = h;\n    const additionY2 = (h + 2 * additionY) / (riskGroup.length - 1) / 2;\n    return {\n      x: x,\n      y: y - additionY - additionY2,\n      w: w,\n      h: h + 2 * (additionY + additionY2),\n    };\n  }\n\n  // hard code\n  getRectColor() {\n    const riskGroup = this.props.riskGroup;\n    const characters = this.props.characters;\n    const riskTypes = riskGroup.map((cidx) => characters[cidx].split(\"_\")[0]);\n    const riskTypesMap = new Map();\n    let maxRiskType = \"PP\";\n    let tempCount = -1;\n    riskTypes.forEach((riskType) => {\n      if (riskTypesMap.has(riskType)) {\n        const riskTypeNum = riskTypesMap.get(riskType) + 1;\n        if (riskTypeNum > tempCount) {\n          tempCount = riskTypeNum;\n          maxRiskType = riskType;\n        }\n        riskTypesMap.set(riskType, riskTypeNum);\n      } else {\n        riskTypesMap.set(riskType, 1);\n      }\n    });\n    return pickColor(maxRiskType);\n  }\n\n  getTextData() {\n    const riskGroup = this.props.riskGroup;\n    const storylines = this.props.storylines;\n    const sessionId = this.props.sessionId;\n    const characters = this.props.characters;\n    for (let i = 0; i < riskGroup.length - 1; i++) {\n      for (let j = i + 1; j < riskGroup.length; j++) {\n        if (\n          storylines[riskGroup[i]][sessionId][0][1] >\n          storylines[riskGroup[j]][sessionId][0][1]\n        ) {\n          const t = riskGroup[i];\n          riskGroup[i] = riskGroup[j];\n          riskGroup[j] = t;\n        }\n      }\n    }\n    const x =\n      (storylines[riskGroup[0]][sessionId][1][0] +\n        storylines[riskGroup[0]][sessionId][2][0]) /\n      2;\n    const y = storylines[riskGroup[0]][sessionId][1][1];\n    const h = storylines[riskGroup[riskGroup.length - 1]][sessionId][2][1] - y;\n    const additionY = h * 0.8;\n    const yStart = y - additionY;\n    const yGap = (h + 2 * additionY) / (riskGroup.length - 1);\n    return riskGroup.map((cidx, idx) => {\n      const [riskType, riskWord] = characters[cidx].split(\"_\");\n      return (\n        <text\n          key={`risk-word-${sessionId}-${characters[cidx]}`}\n          x={x}\n          y={yStart + idx * yGap}\n          style={{\n            textAnchor: \"middle\",\n            dominantBaseline: \"middle\",\n            fontSize: riskWord === \"Turtle\" ? 20 : 14,\n            fill: pickColor(riskType),\n          }}\n        >\n          {riskWord}\n        </text>\n      );\n    });\n  }\n\n  getCircleData(cx, cy, r) {\n    const riskGroup = this.props.riskGroup;\n    const characters = this.props.characters;\n    const sessionId = this.props.sessionId;\n    const riskTypes = riskGroup.map((cidx) => characters[cidx].split(\"_\")[0]);\n    const riskTypesMap = new Map();\n    riskTypes.forEach((riskType) => {\n      if (riskTypesMap.has(riskType)) {\n        const riskTypeNum = riskTypesMap.get(riskType) + 1;\n        riskTypesMap.set(riskType, riskTypeNum);\n      } else {\n        riskTypesMap.set(riskType, 1);\n      }\n    });\n    let startAngle = -Math.PI;\n    const circleWidth = 1.5;\n    return colorScheme.map((c) => {\n      if (riskTypesMap.get(c.risk) > 0) {\n        const endAngle =\n          startAngle +\n          (riskTypesMap.get(c.risk) / riskGroup.length) * (2 * Math.PI - 0.001);\n        const pathD = generatePieSectorPathD(\n          cx,\n          cy,\n          r - circleWidth * riskGroup.length,\n          r + circleWidth * riskGroup.length,\n          startAngle,\n          endAngle\n        );\n        startAngle = endAngle;\n        return (\n          <path\n            id={`scene${sessionId}${c.risk}`}\n            style={{ fill: c.color, stroke: \"none\" }}\n            d={pathD}\n          />\n        );\n      }\n    });\n  }\n\n  render() {\n    const { fillColor, strokeWidth, fillOpacity, rectRadius } = this.state;\n    const strokeColor = this.getRectColor();\n    const { x, y, w, h } = this.getRectData();\n    const texts = this.getTextData();\n    const circles = this.getCircleData(x + w / 2, y + h / 2, Math.min(w, h));\n    return (\n      <g>\n        {/* <rect\n          key={`session-${this.props.sessionId}`}\n          x={`${x}`}\n          y={`${y}`}\n          width={`${w}`}\n          height={`${h}`}\n          style={{\n            fill: fillColor,\n            fillOpacity: fillOpacity,\n            stroke: strokeColor,\n            strokeWidth: strokeWidth,\n          }}\n          rx={rectRadius}\n          ry={rectRadius}\n        /> */}\n        <circle\n          cx={x + w / 2}\n          cy={y + h / 2}\n          r={Math.min(w, h)}\n          style={{\n            fill: fillColor,\n            fillOpacity: fillOpacity,\n            stroke: \"none\",\n          }}\n        />\n        {circles}\n        {texts}\n      </g>\n    );\n  }\n}\n\nfunction generatePieSectorPathD(\n  cx: number,\n  cy: number,\n  innerR: number,\n  outerR: number,\n  startAngle: number,\n  endAngle: number\n) {\n  const six = cx + innerR * Math.cos(startAngle);\n  const siy = cy + innerR * Math.sin(startAngle);\n  const sox = cx + outerR * Math.cos(startAngle);\n  const soy = cy + outerR * Math.sin(startAngle);\n  const eox = cx + outerR * Math.cos(endAngle);\n  const eoy = cy + outerR * Math.sin(endAngle);\n  const eix = cx + innerR * Math.cos(endAngle);\n  const eiy = cy + innerR * Math.sin(endAngle);\n  if (endAngle - startAngle < Math.PI) {\n    return `M ${six} ${siy} L ${sox} ${soy} A ${outerR} ${outerR} 0 0 1 ${eox} ${eoy} L ${eix} ${eiy} A ${innerR} ${innerR} 0 0 0 ${six} ${siy}`;\n  } else if (endAngle - startAngle) {\n    return `M ${six} ${siy} L ${sox} ${soy} A ${outerR} ${outerR} 0 1 1 ${eox} ${eoy} L ${eix} ${eiy} A ${innerR} ${innerR} 0 1 0 ${six} ${siy}`;\n  }\n}\n","import React, { Component } from \"react\";\nimport { StoryLine } from \"./type\";\n\ntype Props = {\n  storyline: StoryLine;\n  storylineName: string;\n  storylineWidth: number;\n  storylineColor: string;\n};\n\ntype State = Record<string, unknown>;\n\nexport default class StorylinePath extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {};\n  }\n\n  render() {\n    return (\n      <path\n        d={generateSmoothSegment(this.props.storyline)}\n        stroke={`${this.props.storylineColor}`}\n        fill=\"none\"\n        strokeWidth={this.props.storylineWidth}\n      />\n    );\n  }\n}\n\nfunction generateSmoothSegment(line: number[][][]) {\n  let path = `M ${line[0][0][0]} ${line[0][0][1]} L ${line[0][1][0]} ${line[0][1][1]}`;\n  for (let i = 0; i < line.length - 1; i++) {\n    path += ` L ${line[i][2][0]} ${line[i][2][1]} C ${line[i][3][0]} ${\n      line[i][3][1]\n    } ${line[i + 1][0][0]} ${line[i + 1][0][1]} ${line[i + 1][1][0]} ${\n      line[i + 1][1][1]\n    }`;\n  }\n  const linesNum = line.length;\n  path += ` L ${line[linesNum - 1][2][0]} ${line[linesNum - 1][2][1]} L ${\n    line[linesNum - 1][3][0]\n  } ${line[linesNum - 1][3][1]}`;\n  return path;\n}\n","import React, { Component } from \"react\";\nimport { StoryLine } from \"./type\";\nimport StorylinePath from \"./StorylinePath\";\n\ntype Props = {\n  containerX: number;\n  barHeight: number;\n  barStartY: number;\n  riskValue: number;\n  riskColor: string;\n  character: string;\n  storyline: StoryLine;\n};\n\ntype State = {\n  isFocusing: boolean;\n  barScale: number;\n  barRatio: number;\n  gapRatio: number;\n  defaultStrokeWidth: number;\n  activateStrokeWidth: number;\n};\n\nexport default class StorylineBar extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      isFocusing: false,\n      barScale: 0.8, // scale bar height\n      barRatio: 0.4, // bar width\n      gapRatio: 0.2, // gap width\n      defaultStrokeWidth: 2,\n      activateStrokeWidth: 5,\n    };\n  }\n\n  getGapPathD(start: number[], end: number[]) {\n    const xInterval = end[0] - start[0];\n    const c1x = start[0] + xInterval / 3;\n    const c2x = end[0] - xInterval / 3;\n    return `M ${start[0]} ${start[1]} C ${c1x} ${start[1]} ${c2x} ${end[1]} ${end[0]} ${end[1]}`;\n  }\n\n  render() {\n    const {\n      containerX,\n      barHeight,\n      barStartY,\n      riskValue,\n      riskColor,\n      character,\n      storyline,\n    } = this.props;\n    const {\n      barRatio,\n      gapRatio,\n      isFocusing,\n      defaultStrokeWidth,\n      activateStrokeWidth,\n      barScale,\n    } = this.state;\n    const textRatio = 1 - barRatio - gapRatio;\n    const gapPathD = this.getGapPathD(\n      [containerX * (1 - gapRatio), barStartY + barHeight / 2],\n      storyline[0][0]\n    );\n    const barWidth = containerX * barRatio * riskValue;\n    const barStartX = containerX - containerX * gapRatio - barWidth;\n    return (\n      <g\n        onMouseEnter={() => this.setState({ isFocusing: true })}\n        onMouseLeave={() => this.setState({ isFocusing: false })}\n      >\n        <text\n          x={10}\n          y={`${barStartY + barHeight / 2}`}\n          style={{ dominantBaseline: \"middle\" }}\n        >\n          {character.split(\"_\")[1]}\n        </text>\n        <rect\n          x={`${containerX * textRatio}`}\n          y={`${barStartY + (barHeight * (1 - barScale)) / 2}`}\n          width={`${containerX * barRatio}`}\n          height={`${barHeight * barScale}`}\n          style={{\n            fill: isFocusing ? \"#888\" : \"#E6E6E6\",\n            stroke: isFocusing ? \"#888\" : \"#E6E6E6\",\n            strokeWidth: 2,\n            opacity: \"0.6\",\n          }}\n        />\n        <rect\n          x={`${barStartX}`}\n          y={`${barStartY + (barHeight * (1 - barScale)) / 2}`}\n          width={`${barWidth}`}\n          height={`${barHeight * barScale}`}\n          style={{ fill: `${riskColor}` }}\n        />\n        <path\n          d={gapPathD}\n          stroke={`${riskColor}`}\n          fill=\"none\"\n          strokeWidth={isFocusing ? activateStrokeWidth : defaultStrokeWidth}\n        />\n        <StorylinePath\n          storyline={storyline}\n          storylineName={character}\n          storylineWidth={isFocusing ? activateStrokeWidth : defaultStrokeWidth}\n          storylineColor={riskColor}\n        />\n      </g>\n    );\n  }\n}\n","import React, { Component } from \"react\";\n\ntype Props = {\n  containerX: number;\n  width: number;\n  height: number;\n};\n\ntype State = {\n  duration: number;\n  minuteTickLength: number;\n  minuteTickWidth: number;\n  minuteTickStroke: string;\n  smallSecondTickLength: number;\n  smallSecondTickWidth: number;\n  smallSecondTickStroke: string;\n  largeSecondTickLength: number;\n  largeSecondTickWidth: number;\n  largeSecondTickStroke: string;\n};\n\nconst LARGE_SECOND_TICK_STROKE = \"#bfbebf\";\nconst SMALL_SECOND_TICK_STROKE = \"#d9dad9\";\nconst MINUTE_TICK_STROKE = \"#afafaf\";\nconst TICK_LABEL_COLOR = \"#7A7A7A\";\n\nexport default class TimeTicks extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      duration: 150,\n      minuteTickLength: 6,\n      minuteTickWidth: 1.5,\n      minuteTickStroke: MINUTE_TICK_STROKE,\n      smallSecondTickLength: 2,\n      smallSecondTickWidth: 1,\n      smallSecondTickStroke: SMALL_SECOND_TICK_STROKE,\n      largeSecondTickLength: 3,\n      largeSecondTickWidth: 1,\n      largeSecondTickStroke: LARGE_SECOND_TICK_STROKE,\n    };\n  }\n\n  getTimePosition(num, sep = 5) {\n    const { duration } = this.state;\n    const { containerX, width, height } = this.props;\n    return [((num * sep) / duration) * width + containerX, height / 2];\n  }\n\n  getStartPoint() {\n    const { containerX, height } = this.props;\n    const startX = containerX;\n    const startY = height / 2;\n    return [startX, startY];\n  }\n\n  getEndPoint() {\n    const { containerX, width, height } = this.props;\n    const endX = containerX + width;\n    const endY = height / 2;\n    return [endX, endY];\n  }\n\n  render() {\n    const {\n      duration,\n      smallSecondTickLength,\n      smallSecondTickWidth,\n      smallSecondTickStroke,\n      largeSecondTickLength,\n      largeSecondTickWidth,\n      largeSecondTickStroke,\n      minuteTickLength,\n      minuteTickWidth,\n      minuteTickStroke,\n    } = this.state;\n    const [startX, startY] = this.getStartPoint();\n    const [endX, endY] = this.getEndPoint();\n    const AnchorLine = (\n      <line\n        x1={startX}\n        y1={startY}\n        x2={endX}\n        y2={endY}\n        style={{ stroke: MINUTE_TICK_STROKE, strokeWidth: 1 }}\n      />\n    );\n    const minutesTickArr = generateArr(Math.floor(duration / 60));\n    const MinutesTicks = minutesTickArr.map((num) => {\n      const [posX, posY] = this.getTimePosition(num, 60);\n      return (\n        <g key={`min-${num}`}>\n          <line\n            x1={posX}\n            y1={posY}\n            x2={posX}\n            y2={posY - minuteTickLength}\n            style={{ stroke: minuteTickStroke, strokeWidth: minuteTickWidth }}\n          />\n          <text\n            x={posX}\n            y={posY - minuteTickLength - 2}\n            fill={TICK_LABEL_COLOR}\n            style={{ textAnchor: \"middle\" }}\n          >{`${num} min`}</text>\n        </g>\n      );\n    });\n    const largeSecondsTickArr = generateArr(Math.floor(duration / 10));\n    const LargeSecondsTicks = largeSecondsTickArr.map((num) => {\n      const [posX, posY] = this.getTimePosition(num, 10);\n      return (\n        <g key={`large-tick-${num}`}>\n          <line\n            x1={posX}\n            y1={posY}\n            x2={posX}\n            y2={posY - largeSecondTickLength}\n            style={{\n              stroke: largeSecondTickStroke,\n              strokeWidth: largeSecondTickWidth,\n            }}\n          />\n          {num % 6 > 0 && (\n            <text\n              x={posX}\n              y={posY - largeSecondTickLength - 2}\n              fill={TICK_LABEL_COLOR}\n              style={{ textAnchor: \"middle\" }}\n            >{`${num}0s`}</text>\n          )}\n        </g>\n      );\n    });\n    const smallSecondsTickArr = generateArr(Math.floor(duration / 5));\n    const SmallSecondsTicks = smallSecondsTickArr.map((num) => {\n      const [posX, posY] = this.getTimePosition(num, 5);\n      return (\n        <line\n          key={`small-tick-${num}`}\n          x1={posX}\n          y1={posY}\n          x2={posX}\n          y2={posY - smallSecondTickLength}\n          style={{\n            stroke: smallSecondTickStroke,\n            strokeWidth: smallSecondTickWidth,\n          }}\n        />\n      );\n    });\n    return (\n      <g className=\"time-ticks\">\n        {AnchorLine}\n        {SmallSecondsTicks}\n        {LargeSecondsTicks}\n        {MinutesTicks}\n      </g>\n    );\n  }\n}\n\nfunction generateArr(num) {\n  const tempArr = Array.from(Array(num), (v, k) => k);\n  tempArr.push(tempArr.length);\n  return tempArr;\n}\n","import React, { Component, RefObject } from \"react\";\nimport { AudioScript } from \"./type\";\nimport { LayoutGenerator } from \"./layout\";\n// Components\nimport GroupShape from \"./GroupShape\";\nimport StorylineBar from \"./StorylineBar\";\nimport TimeTicks from \"./TimeTicks\";\n\ntype Props = {\n  audioScript: AudioScript;\n  riskColorMap: Map<string, string>;\n  setCurrentVideoTime: (currentTime: number) => void;\n};\n\ntype State = {\n  containerW: number;\n  containerH: number;\n  containerX: number;\n  containerPadding: number[];\n};\n\nexport default class AudioStoryline extends Component<Props, State> {\n  containerDom: RefObject<SVGSVGElement> = React.createRef();\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      containerW: 500,\n      containerH: 500,\n      containerX: 200,\n      containerPadding: [100, 20, 20, 20],\n    };\n  }\n\n  componentDidMount() {\n    const DOM = this.containerDom.current as SVGSVGElement;\n    const [\n      paddingT,\n      paddingL,\n      paddingB,\n      paddingR,\n    ] = this.state.containerPadding;\n    // Init container\n    this.setState({\n      containerW: DOM.clientWidth - paddingL - paddingR,\n      containerH: DOM.clientHeight - paddingT - paddingB,\n    });\n  }\n\n  pickRiskColor(riskType: string) {\n    if (this.props.riskColorMap.has(riskType)) {\n      return this.props.riskColorMap.get(riskType);\n    }\n    return \"#000\";\n  }\n\n  getGroupShapeTime(sessionIdx) {\n    const { audioScript } = this.props;\n    if (audioScript.Story) {\n      for (const _character in audioScript.Story.Characters) {\n        const segments = audioScript.Story.Characters[_character];\n        return segments[sessionIdx].Start;\n      }\n    }\n    return 0;\n  }\n\n  render() {\n    const { audioScript } = this.props;\n    const { containerW, containerH, containerX, containerPadding } = this.state;\n    const [paddingT, paddingL, paddingB, paddingR] = containerPadding;\n    let StorylineBars = [],\n      GroupShapes = [];\n    if (audioScript && audioScript.Story) {\n      const layoutManager = new LayoutGenerator(\n        audioScript,\n        containerX,\n        paddingT,\n        containerW - containerX + paddingL,\n        containerH\n      );\n      const storylines = layoutManager.storylines;\n      const characters = layoutManager.characters;\n      const charactersRiskNum = layoutManager.charactersRiskNum;\n      const riskGroups = layoutManager.riskGroupsList;\n\n      // new\n      const riskNumMax =\n        Math.max(...charactersRiskNum) === 0\n          ? 1\n          : Math.max(...charactersRiskNum);\n      const barHeight = containerH / characters.length;\n      StorylineBars = charactersRiskNum.map((num, idx) => {\n        if (num === 0) num = 1;\n        const riskType = characters[idx].split(\"_\")[0];\n        const riskValue = num / riskNumMax;\n        const storylineColor = this.pickRiskColor(riskType);\n        return (\n          <StorylineBar\n            key={`storyline-bar-${characters[idx]}`}\n            containerX={containerX}\n            barHeight={barHeight}\n            barStartY={paddingT + barHeight * idx}\n            riskValue={riskValue}\n            riskColor={storylineColor}\n            character={characters[idx]}\n            storyline={storylines[idx]}\n          />\n        );\n      });\n      GroupShapes = riskGroups.map((riskGroup, idx) => {\n        if (riskGroup.length === 0) return;\n        const groupShapeTime = this.getGroupShapeTime(idx);\n        return (\n          <g\n            key={`risk-group-${idx}`}\n            onClick={() => {\n              this.props.setCurrentVideoTime(groupShapeTime);\n            }}\n          >\n            <GroupShape\n              sessionId={idx}\n              riskGroup={riskGroup}\n              storylines={storylines}\n              characters={characters}\n            />\n          </g>\n        );\n      });\n    }\n    return (\n      <svg\n        className=\"audio-storyline\"\n        style={{ width: \"100%\", height: \"100%\", background: \"#fff\" }}\n        ref={this.containerDom}\n      >\n        <TimeTicks\n          containerX={containerX}\n          width={containerW - containerX + paddingL}\n          height={paddingT}\n        />\n        {StorylineBars}\n        {GroupShapes}\n      </svg>\n    );\n  }\n}\n","import React from \"react\";\nimport \"./App.css\";\nimport axios from \"axios\";\nimport styled from \"styled-components\";\nimport { connect } from \"react-redux\";\nimport {\n  IStateType,\n  IDispatchType,\n  VideoState,\n  YoukuVideo,\n  StudyVideo,\n  StudyResult,\n} from \"./types\";\nimport {\n  initServer,\n  fetchDemoVideo,\n  fetchYoukuVideo,\n  fetchStudyVideo,\n} from \"./store/actions\";\n// Utils\nimport { consoleError } from \"./utils/logger\";\nimport { Button, Select, Result, Radio, Row, Col, Space, Alert } from \"antd\";\n// Components\nimport VideoTracker from \"./components/VideoTracker\";\nimport FrameBrowser from \"./components/FrameBrowser\";\nimport AudioStoryline from \"./components/AudioStoryline\";\n// Demo data\nimport videoAlgJson from \"../public/dataset/0000.alg.json\";\nimport audioAlgJson from \"../public/dataset/0000.story.json\";\nimport imageAlgJson from \"../public/dataset/0000.tsne.json\";\n\nconst mapStateToProps = (state: IStateType) => {\n  return {\n    videoState: state.videoState,\n    videoSrc: state.videoState.videoSrc,\n    videoRiskTS: state.videoState.videoRiskTS,\n    videoFrames: state.videoState.videoFrames,\n    videoASRText: state.videoState.videoASRText,\n    audioScript: state.videoState.audioScript,\n    riskColorMap: state.videoState.riskColorMap,\n    participants: state.studyState.participants,\n    videoIds: state.studyState.videoIds,\n    videoLabels: state.studyState.videoLabels,\n    videoOrders: state.studyState.videoOrders,\n  };\n};\n\nconst mapDispatchToProps = (dispatch: IDispatchType) => {\n  return {\n    initServer: (msg: string) => dispatch(initServer(msg)),\n    fetchDemo: (videoInfo: VideoState) => dispatch(fetchDemoVideo(videoInfo)),\n    fetchYouku: (videoInfo: YoukuVideo) => dispatch(fetchYoukuVideo(videoInfo)),\n    fetchStudy: (videoInfo: StudyVideo) => dispatch(fetchStudyVideo(videoInfo)),\n  };\n};\n\nconst colorScheme = [\n  {\n    risk: \"FA\",\n    policy: \"Flase Advertising\",\n    color: \"#fb8072\",\n    borderColor: \"#fa574b\",\n  },\n  {\n    risk: \"PP\",\n    policy: \"Protected Products\",\n    color: \"#80b1d3\",\n    borderColor: \"#4698c7\",\n  },\n  {\n    risk: \"IB\",\n    policy: \"Inappropriate Business\",\n    color: \"#fdb462\",\n    borderColor: \"#f7953c\",\n  },\n  {\n    risk: \"SC\",\n    policy: \"Sensitive content\",\n    color: \"#8dd3c7\",\n    borderColor: \"#538e82\",\n  },\n  {\n    risk: \"NM\",\n    policy: \"Normal\",\n    color: \"#c0c0c0\",\n    borderColor: \"#999999\",\n  },\n];\n\nconst AppHeader = styled.div`\n  width: 100%;\n  height: 56px;\n  display: flex;\n  flex-direction: row;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 8px rgba(32, 84, 159, 0.4);\n`;\n\nconst AppContent = styled.div`\n  width: 100%;\n  padding: 0 4px;\n`;\n\nconst CompContainer = styled.div`\n  width: 100%;\n  height: 100%;\n  border-radius: 5px;\n  box-shadow: 2px 2px 4px rgba(32, 84, 159, 0.4);\n`;\n\nconst CompHeader = styled.div`\n  width: 100%;\n  height: 36px;\n  padding: 0 0 0 16px;\n  line-height: 36px;\n  background: #fafafa;\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n  box-shadow: 0 2px 4px rgba(32, 84, 159, 0.4);\n`;\n\nconst CompWrapper = styled.div`\n  width: 100%;\n  border-top: 1px solid #bfbfbf;\n  border-radius: 5px;\n`;\n\ntype State = {\n  interface: string;\n  currentTime: number;\n  userId: string;\n  videoId: string;\n  videoLabel: string;\n  videoOrder: number[];\n  videoOrderIdx: number;\n  isFinished: boolean;\n  isWarning: boolean;\n  startTimestamp: number;\n  result: StudyResult[];\n  btnLabel: string;\n};\n\ntype Props = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nfunction getTimeNow() {\n  return new Date().getTime();\n}\n\nclass App extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      interface: \"A\",\n      currentTime: 0,\n      userId: \"P1\",\n      videoId: \"0000\",\n      videoLabel: \"正常\",\n      videoOrder: [],\n      videoOrderIdx: -1,\n      isFinished: false,\n      isWarning: false,\n      startTimestamp: getTimeNow(),\n      result: [],\n      btnLabel: \"Normal\",\n    };\n  }\n\n  componentDidMount() {\n    this.test();\n  }\n\n  changeUserId(userId: string) {\n    if (this.props.videoOrders.has(userId)) {\n      const videoOrder = this.props.videoOrders.get(userId);\n      this.setState({\n        userId: userId,\n        currentTime: 0,\n        videoOrder: videoOrder,\n        videoOrderIdx: -1,\n      });\n    }\n  }\n\n  changeVideoTime(currentTime: number) {\n    this.setState({ currentTime: currentTime });\n  }\n\n  changeVideoLabel(label) {\n    this.setState({ videoLabel: label });\n  }\n\n  changeLabelTest(label) {\n    this.setState({ btnLabel: label });\n  }\n\n  fetchVideo(videoId) {\n    axios\n      .post(`/api/study1_dataset`, { videoId: videoId })\n      .then((res) => {\n        const resData = res.data as StudyVideo;\n        this.props.fetchStudy(resData);\n      })\n      .catch((err) => {\n        consoleError(err);\n      });\n  }\n\n  fetchLocalVideo() {\n    this.props.fetchStudy({\n      videoId: \"0000\",\n      videoSrc: \"dataset/0000.mp4\",\n      videoAlgJson: videoAlgJson,\n      audioAlgJson: audioAlgJson,\n      imageSrc: \"dataset/0000.vi\",\n      imageAlgJson: imageAlgJson,\n    });\n  }\n\n  downloadResult() {\n    console.log(this.state.result);\n    const ret = {};\n    const retKey = `${this.state.interface}-${this.state.userId}`;\n    ret[retKey] = this.state.result;\n    const datastr =\n      \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(ret));\n    const downloadAnchorNode = document.createElement(\"a\");\n    downloadAnchorNode.setAttribute(\"href\", datastr);\n    downloadAnchorNode.setAttribute(\"download\", `${retKey}.json`);\n    downloadAnchorNode.click();\n    downloadAnchorNode.remove();\n  }\n\n  start() {\n    const { userId } = this.state;\n    if (this.props.videoOrders.has(userId)) {\n      const videoOrder = this.props.videoOrders.get(userId);\n      const videoId = this.props.videoIds[videoOrder[0]];\n      this.fetchVideo(videoId);\n      this.setState({\n        currentTime: 0,\n        userId: userId,\n        videoId: videoId,\n        videoLabel: \"正常\",\n        videoOrder: videoOrder,\n        videoOrderIdx: 0,\n        isFinished: false,\n        isWarning: false,\n        startTimestamp: getTimeNow(),\n        result: [],\n      });\n    }\n  }\n\n  test() {\n    // this.fetchVideo(\"0000\");\n    this.fetchLocalVideo();\n    this.setState({\n      currentTime: 0,\n      isFinished: false,\n      isWarning: false,\n    });\n  }\n\n  next() {\n    const { videoIds } = this.props;\n    const {\n      userId,\n      videoId,\n      videoOrderIdx,\n      videoOrder,\n      videoLabel,\n      startTimestamp,\n      currentTime,\n    } = this.state;\n    if (videoOrder.length === 0) {\n      this.setState({ isWarning: true });\n      return;\n    }\n    const currentTimestamp = getTimeNow();\n    const duration = currentTimestamp - startTimestamp;\n    console.log(userId, videoId, videoLabel, duration, currentTime);\n    this.state.result.push({\n      interface: this.state.interface,\n      userId: userId,\n      videoId: videoId,\n      videoLabel: videoLabel,\n      duration: duration,\n      evidance: currentTime,\n    });\n    if (videoOrderIdx < videoOrder.length - 1) {\n      const nextVideoId = videoIds[videoOrder[videoOrderIdx + 1]];\n      this.fetchVideo(nextVideoId);\n      this.setState({\n        currentTime: 0,\n        videoId: nextVideoId,\n        videoLabel: \"正常\",\n        videoOrderIdx: videoOrderIdx + 1,\n        startTimestamp: currentTimestamp,\n      });\n    } else {\n      this.downloadResult();\n      this.setState({\n        currentTime: 0,\n        isFinished: true,\n        startTimestamp: currentTimestamp,\n        result: [],\n      });\n    }\n  }\n\n  render(): JSX.Element {\n    const { btnLabel } = this.state;\n    const riskLabelBtns = colorScheme.map((item) => (\n      <div\n        style={{\n          display: \"flex\",\n          flexDirection: \"row\",\n          alignItems: \"center\",\n          margin: \"0 5px\",\n        }}\n      >\n        <div\n          style={{\n            width: \"30px\",\n            height: \"30px\",\n            borderRadius: \"8px\",\n            border: `4px solid ${item.borderColor}`,\n            background: item.color,\n            marginRight: \"5px\",\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n          }}\n          onClick={() => this.changeLabelTest(item.policy)}\n        >\n          {btnLabel === item.policy && (\n            <div\n              style={{\n                width: \"12px\",\n                height: \"12px\",\n                borderRadius: \"2px\",\n                background: item.borderColor,\n              }}\n            />\n          )}\n        </div>\n        <span style={{ fontSize: 16, fontWeight: 500 }}>{item.policy}</span>\n      </div>\n    ));\n    const AppTitle = (\n      <AppHeader>\n        <div\n          style={{\n            background: \"#4f5d75\",\n            width: \"20vw\",\n            height: \"100%\",\n            color: \"white\",\n            fontSize: \"28px\",\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n          }}\n        >\n          <b>VideoModerator</b>\n        </div>\n        <div\n          style={{\n            width: \"0\",\n            height: \"0\",\n            borderLeft: \"28px solid #4f5d75\",\n            borderTop: \"28px solid #4f5d75\",\n            borderRight: \"28px solid transparent\",\n            borderBottom: \"28px solid transparent\",\n          }}\n        ></div>\n        <div\n          style={{\n            position: \"absolute\",\n            width: \"100%\",\n            height: \"5px\",\n            background: \"#4f5d75\",\n          }}\n        ></div>\n        <div\n          style={{\n            flex: \"auto\",\n            height: \"100%\",\n            display: \"flex\",\n            flexDirection: \"row-reverse\",\n            alignItems: \"center\",\n          }}\n        >\n          <div\n            className={\"clickBtn\"}\n            style={{\n              display: \"flex\",\n              flexDirection: \"row\",\n              alignItems: \"center\",\n              margin: \"0px 20px 0px 10px\",\n              width: \"100px\",\n              height: \"30px\",\n              borderRadius: \"15px\",\n            }}\n          >\n            <img\n              src={require(\"./submit.png\")}\n              style={{\n                width: \"25px\",\n                height: \"25px\",\n                marginLeft: \"2px\",\n              }}\n            />\n            <span\n              style={{\n                fontSize: 16,\n                fontWeight: 500,\n                color: \"#fff\",\n                marginLeft: \"10px\",\n              }}\n            >\n              Submit\n            </span>\n          </div>\n          {riskLabelBtns}\n          <div\n            className={\"clickBtn\"}\n            style={{\n              display: \"flex\",\n              flexDirection: \"row\",\n              alignItems: \"center\",\n              margin: \"0px 10px\",\n              borderRadius: \"15px\",\n              width: \"100px\",\n              height: \"30px\",\n            }}\n          >\n            <img\n              src={require(\"./load.png\")}\n              style={{\n                width: \"29px\",\n                height: \"29px\",\n              }}\n            />\n            <span\n              style={{\n                fontSize: 16,\n                fontWeight: 500,\n                color: \"#fff\",\n                marginLeft: \"24px\",\n              }}\n            >\n              Load\n            </span>\n          </div>\n        </div>\n      </AppHeader>\n    );\n    const VideoView = (\n      <CompContainer style={{ background: \"white\" }}>\n        <CompHeader>\n          <b style={{ color: \"#666\", fontSize: \"16px\" }}>Video View</b>\n        </CompHeader>\n        <CompWrapper style={{ height: \"84vh\" }}>\n          <VideoTracker\n            videoSrc={this.props.videoSrc}\n            videoType={\"video/mp4\"}\n            videoWidth={540}\n            videoHeight={960}\n            videoRisk={this.props.videoRiskTS}\n            videoText={this.props.videoASRText}\n            videoStartTime={this.state.currentTime}\n          />\n        </CompWrapper>\n      </CompContainer>\n    );\n    const FrameView = (\n      <CompContainer>\n        <CompHeader>\n          <b style={{ color: \"#666\", fontSize: \"16px\" }}>Frame View</b>\n        </CompHeader>\n        <CompWrapper style={{ height: \"50vh\" }}>\n          <FrameBrowser\n            data={this.props.videoFrames}\n            risk={this.props.videoRiskTS}\n            color={this.props.riskColorMap}\n            setCurrentVideoTime={(videoTime: number) =>\n              this.changeVideoTime(videoTime)\n            }\n          />\n        </CompWrapper>\n      </CompContainer>\n    );\n    const AudioView = (\n      <CompContainer>\n        <CompHeader>\n          <b style={{ color: \"#666\", fontSize: \"16px\" }}>Audio View</b>\n        </CompHeader>\n        <CompWrapper style={{ height: \"33vh\" }}>\n          <AudioStoryline\n            audioScript={this.props.audioScript}\n            riskColorMap={this.props.riskColorMap}\n            setCurrentVideoTime={(videoTime: number) =>\n              this.changeVideoTime(videoTime)\n            }\n          />\n        </CompWrapper>\n      </CompContainer>\n    );\n    return (\n      <div className=\"App\">\n        {AppTitle}\n        <AppContent>\n          <Row gutter={[8, 0]}>\n            <Col span={7}>{VideoView}</Col>\n            <Col span={17}>\n              <Row gutter={[0, 8]}>\n                <Col span={24}>{FrameView}</Col>\n              </Row>\n              <Row>\n                <Col span={24}>{AudioView}</Col>\n              </Row>\n            </Col>\n          </Row>\n        </AppContent>\n      </div>\n    );\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === \"localhost\" ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === \"[::1]\" ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener(\"load\", () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            \"This web app is being served cache-first by a service \" +\r\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === \"installed\") {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                \"New content is available and will be used when all \" +\r\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log(\"Content is cached for offline use.\");\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"Error during service worker registration:\", error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { \"Service-Worker\": \"script\" },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get(\"content-type\");\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        \"No internet connection found. App is running in offline mode.\"\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if (\"serviceWorker\" in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import {\n  IActionType,\n  VideoState,\n  KAny,\n  VideoRiskTS,\n  RiskLabelTree,\n} from \"../../types\";\nimport { consoleInfo, consoleError } from \"../../utils/logger\";\nimport axios from \"axios\";\n// import * as d3Color from \"d3-scale-chromatic\";\n\nconst initialState: VideoState = {\n  videoId: null,\n  videoSrc: null,\n  videoSize: [],\n  videoFPS: 30,\n  videoAnnotations: [],\n  videoRiskTS: {},\n  videoASRText: [],\n  videoFrames: [],\n  riskColorMap: new Map(),\n};\n\nexport default (state = initialState, action: IActionType): VideoState => {\n  switch (action.type) {\n    case \"INIT_SERVER\": {\n      const { msg } = action.payload;\n      axios\n        .get(`/api/hello?message=${msg}`)\n        .then((res) => {\n          consoleInfo(res.data.express);\n        })\n        .catch((e) => {\n          consoleError(e);\n        });\n      return state;\n    }\n    case \"FETCH_DEMOVIDEO\": {\n      return action.payload;\n    }\n    case \"FETCH_YOUKUVIDEO\": {\n      const {\n        imageSrc,\n        imageAlgJson,\n        videoSrc,\n        videoId,\n        videoAlgJson,\n      } = action.payload;\n      const videoRiskTS = getVideoRiskTS(videoAlgJson);\n      const riskLabelTree = getRiskLabelTree(videoRiskTS);\n      const riskColorMap = getRiskColorMap(riskLabelTree);\n      return {\n        videoId: videoId,\n        videoSrc: videoSrc,\n        videoSize: [],\n        videoFPS: 30,\n        videoAnnotations: [],\n        videoRiskTS: videoRiskTS,\n        videoASRText: getVideoASRText(videoAlgJson),\n        videoFrames: imageAlgJson.data,\n        riskColorMap: riskColorMap,\n      };\n    }\n    case \"FETCH_STUDYVIDEO\": {\n      const {\n        imageSrc,\n        imageAlgJson,\n        videoSrc,\n        videoId,\n        videoAlgJson,\n        audioAlgJson,\n      } = action.payload;\n      const videoRiskTS = getVideoRiskTS(videoAlgJson);\n      const riskLabelTree = getRiskLabelTree(videoRiskTS);\n      const riskColorMap = getRiskColorMap(riskLabelTree);\n      return {\n        videoId: videoId,\n        videoSrc: videoSrc,\n        videoSize: [],\n        videoFPS: 30,\n        videoAnnotations: [],\n        videoRiskTS: videoRiskTS,\n        videoASRText: getVideoASRText(videoAlgJson),\n        audioScript: audioAlgJson,\n        videoFrames: imageAlgJson.data,\n        riskColorMap: riskColorMap,\n      };\n    }\n    default:\n      return state;\n  }\n};\n\nfunction getVideoRiskTS(videoAlgJson: KAny) {\n  const videoRisk = {};\n  for (const label in videoAlgJson) {\n    if (isTSKV(videoAlgJson[label])) {\n      videoRisk[label] = videoAlgJson[label];\n    }\n  }\n  return videoRisk;\n}\n\nfunction isTSKV(TS) {\n  if (TS instanceof Object) {\n    return typeof Object.values(TS)[0] === \"number\";\n  }\n  return false;\n}\n\nfunction getVideoASRText(videoAlgJson: KAny) {\n  let videoASRText = [];\n  if (videoAlgJson.hasOwnProperty(\"ASR文本敏感关键词\")) {\n    const ASRText = videoAlgJson[\"ASR文本敏感关键词\"];\n    const timeTicks = Object.keys(ASRText).map((timeStr) => +timeStr);\n    timeTicks.sort((a, b) => a - b);\n    let i = 0;\n    for (let len = timeTicks.length - 1; i < len; i++) {\n      const _startTime = timeTicks[i];\n      const _endTime = timeTicks[i + 1];\n      const _text = ASRText[`${_startTime}`];\n      videoASRText.push({\n        start: _startTime,\n        end: _endTime,\n        text: _text,\n      });\n    }\n    const lastTime = timeTicks[i];\n    if (ASRText[`${lastTime}`].length > 0) {\n      const newEndTime = 2 * timeTicks[i] - timeTicks[i - 1];\n      videoASRText.push({\n        start: lastTime,\n        end: newEndTime,\n        text: ASRText[`${lastTime}`],\n      });\n    }\n    return videoASRText;\n  }\n  if (videoAlgJson.hasOwnProperty(\"ASR文本\")) {\n    videoASRText = videoAlgJson[\"ASR文本\"];\n  }\n  return videoASRText;\n}\n\nfunction getRiskLabelTree(videoRiskTS: VideoRiskTS) {\n  const rawRiskLabels = Object.keys(videoRiskTS);\n  const riskLabelTree = {};\n  for (let i = 0, len = rawRiskLabels.length; i < len; i++) {\n    const riskLabel = rawRiskLabels[i];\n    const riskValue = videoRiskTS[riskLabel];\n    if (aggregateArr(Object.values(riskValue)) > 0) {\n      riskDataProtocV1(riskLabelTree, riskLabel, riskValue);\n    }\n  }\n  return riskLabelTree;\n}\n\nfunction aggregateArr(arr) {\n  const reducer = (accumulator, currentValue) => accumulator + currentValue;\n  return arr.reduce(reducer);\n}\n\n// 采用风险数据协议v1\nfunction riskDataProtocV1(riskLabelTree, riskLabel, riskValue) {\n  let riskLabelTags = riskLabel\n    .split(\"_\")\n    .filter((tag) => tag !== \"Det\" && tag !== \"v0\");\n  if (riskLabelTags[1] === \"情趣品\") {\n    riskLabelTags = [aggregateArr(riskLabelTags)];\n  }\n  switch (riskLabelTags.length) {\n    case 1:\n      if (!riskLabelTree.hasOwnProperty(\"低俗色情\")) {\n        riskLabelTree[\"低俗色情\"] = {};\n      }\n      riskLabelTree[\"低俗色情\"][riskLabelTags[0]] = riskValue;\n      break;\n    case 2:\n      if (!riskLabelTree.hasOwnProperty(riskLabelTags[0])) {\n        riskLabelTree[riskLabelTags[0]] = {};\n      }\n      riskLabelTree[riskLabelTags[0]][riskLabelTags[1]] = riskValue;\n      break;\n    default:\n      break;\n  }\n}\n\nconst colorScheme = [\n  {\n    risk: \"FA\",\n    policy: \"Flase Advertising\",\n    color: \"#fb8072\",\n  },\n  {\n    risk: \"PP\",\n    policy: \"Protected Products\",\n    color: \"#80b1d3\",\n  },\n  {\n    risk: \"IB\",\n    policy: \"Inappropriate Business\",\n    color: \"#fdb462\",\n  },\n  {\n    risk: \"SC\",\n    policy: \"Sensitive content\",\n    color: \"#8dd3c7\",\n  },\n  {\n    risk: \"NM\",\n    policy: \"Normal\",\n    color: \"white\",\n  },\n];\n\nfunction getRiskColorMap(riskLabelTree: RiskLabelTree) {\n  // const riskCategories = Object.keys(riskLabelTree);\n  // const riskColorMap = new Map();\n  // riskCategories.forEach((riskType, idx) => {\n  //   riskColorMap.set(riskType, colorScheme[idx]);\n  // });\n  const riskColorMap = new Map();\n  colorScheme.forEach((item) => {\n    riskColorMap.set(item.risk, item.color);\n  });\n  return riskColorMap;\n}\n","import { IActionType, StudyState } from \"../../types\";\n\nconst participantCount = 12;\nconst testUserOrder = [\n  [11, 1, 3, 8, 12, 13, 17, 5, 15],\n  [9, 11, 0, 10, 6, 2, 8, 17, 7],\n  [13, 12, 6, 9, 16, 4, 1, 3, 5],\n  [16, 4, 10, 11, 17, 0, 2, 3, 14],\n  [2, 12, 7, 14, 9, 15, 0, 4, 13],\n  [6, 14, 1, 10, 16, 15, 7, 8, 5],\n  [0, 8, 16, 1, 12, 11, 7, 6, 15],\n  [11, 4, 7, 17, 9, 0, 14, 3, 16],\n  [4, 14, 17, 15, 16, 10, 7, 2, 13],\n  [5, 8, 3, 6, 10, 12, 17, 13, 15],\n  [0, 1, 5, 9, 6, 13, 2, 3, 10],\n  [1, 14, 11, 5, 9, 12, 4, 8, 2],\n];\n\nconst initialState: StudyState = {\n  participants: generateParticipants(participantCount),\n  videoIds: generateVideoIds(),\n  videoOrders: generateVideoOrders(participantCount),\n  videoLabels: generateVideoLabels(),\n};\n\nfunction generateParticipants(num) {\n  return Array(num)\n    .fill(\"P\")\n    .map((_, idx) => `P${idx + 1}`);\n}\n\nfunction generateVideoOrders(num) {\n  const videoOrders = new Map();\n  const participants = generateParticipants(num);\n  participants.forEach((userId, idx) => {\n    videoOrders.set(userId, testUserOrder[idx]);\n  });\n  return videoOrders;\n}\n\nfunction generateVideoIds() {\n  return [\n    \"1001\",\n    \"1002\",\n    \"1003\",\n    \"2001\",\n    \"2002\",\n    \"2003\",\n    \"2004\",\n    \"2005\",\n    \"2006\",\n    \"2007\",\n    \"269800164357\",\n    \"269912885711\",\n    \"270107511749\",\n    \"270286443106\",\n    \"270490620874\",\n    \"270546866156\",\n    \"270600868101\",\n    \"270631231591\",\n  ];\n}\n\nfunction generateVideoLabels() {\n  return [\"正常\", \"虚假宣传\", \"低俗色情\", \"血腥暴力\", \"站外引流\", \"违禁品\"];\n}\n\nexport default (state = initialState, action: IActionType): StudyState => {\n  return state;\n};\n","import { IStateType, IActionType } from \"../../types\";\nimport { combineReducers } from \"redux\";\n\nimport videoState from \"./videoState\";\nimport studyState from \"./studyState\";\n\nexport default combineReducers<IStateType, IActionType>({\n  videoState: videoState,\n  studyState: studyState,\n});\n","import { createStore } from \"redux\";\nimport rootReducer from \"./reducers\";\n\nexport default createStore(rootReducer);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport \"antd/dist/antd.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport { Provider } from \"react-redux\";\nimport store from \"./store\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}